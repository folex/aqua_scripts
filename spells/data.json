{"script":"; This file is auto-generated. Do not edit manually: changes may be erased.\n; Generated by Aqua compiler: https://github.com/fluencelabs/aqua/.\n; If you find any bugs, please write an issue on GitHub: https://github.com/fluencelabs/aqua/issues\n; Aqua version: 0.10.4\n\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"getDataSrv\" \"-relay-\") [] -relay-)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id)\n)\n(call %init_peer_id% (\"getDataSrv\" \"ipfs\") [] ipfs)\n)\n(call %init_peer_id% (\"getDataSrv\" \"deal_id\") [] deal_id)\n)\n(call %init_peer_id% (\"getDataSrv\" \"worker_def_cid\") [] worker_def_cid)\n)\n(new $array-inline\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap \"worker\" $array-inline)\n(ap spell_id $array-inline)\n)\n(ap deal_id $array-inline)\n)\n(ap worker_def_cid $array-inline)\n)\n(ap ipfs $array-inline)\n)\n(canon %init_peer_id% $array-inline #array-inline-0)\n)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-0])\n)\n(new $subnet_id\n(new $worker_spell\n(new $reg_errs\n(new $cre_errs\n(seq\n(seq\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-1)\n(xor\n(call %init_peer_id% (\"srv\" \"resolve_alias\") [\"worker-spell\"] $worker_spell)\n(seq\n(ap spell_id-1 $worker_spell)\n(xor\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"srv\" \"add_alias\") [\"worker-spell\" spell_id-1])\n(new $array-inline-1\n(seq\n(seq\n(ap \"alias created 'worker-spell'\" $array-inline-1)\n(ap spell_id-1 $array-inline-1)\n)\n(canon %init_peer_id% $array-inline-1 #array-inline-1-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-2)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-1-0] str)\n)\n(par\n(call %init_peer_id% (spell_id-2 \"list_push_string\") [\"logs\" str])\n(seq\n(new $array-inline-2\n(seq\n(seq\n(ap spell_id-2 $array-inline-2)\n(ap #array-inline-1-0 $array-inline-2)\n)\n(canon %init_peer_id% $array-inline-2 #array-inline-2-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-2-0])\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-3\n(seq\n(seq\n(ap \"error creating alias\" $array-inline-3)\n(ap %last_error% $array-inline-3)\n)\n(canon %init_peer_id% $array-inline-3 #array-inline-3-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-3)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-3-0] str-0)\n)\n(par\n(call %init_peer_id% (spell_id-3 \"list_push_string\") [\"logs\" str-0])\n(seq\n(new $array-inline-4\n(seq\n(seq\n(ap spell_id-3 $array-inline-4)\n(ap #array-inline-3-0 $array-inline-4)\n)\n(canon %init_peer_id% $array-inline-4 #array-inline-4-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-4-0])\n)\n)\n)\n)\n)\n)\n)\n(xor\n(seq\n(new $worker_spell_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] worker_spell_incr)\n(fold $worker_spell worker_spell_fold_var\n(seq\n(seq\n(ap worker_spell_fold_var $worker_spell_test)\n(canon %init_peer_id% $worker_spell_test #worker_spell_iter_canon)\n)\n(xor\n(match #worker_spell_iter_canon.length worker_spell_incr\n(null)\n)\n(next worker_spell_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $worker_spell_test #worker_spell_result_canon)\n)\n(ap #worker_spell_result_canon worker_spell_gate)\n)\n)\n(mismatch worker_spell_gate.$.[0] spell_id-1\n(xor\n(seq\n(seq\n(seq\n(new $array-inline-5\n(seq\n(seq\n(seq\n(seq\n(ap \"Another worker spell is deployed on this worker (existing, current)\" $array-inline-5)\n(new $worker_spell_test-0\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] worker_spell_incr-0)\n(fold $worker_spell worker_spell_fold_var-0\n(seq\n(seq\n(ap worker_spell_fold_var-0 $worker_spell_test-0)\n(canon %init_peer_id% $worker_spell_test-0 #worker_spell_iter_canon-0)\n)\n(xor\n(match #worker_spell_iter_canon-0.length worker_spell_incr-0\n(null)\n)\n(next worker_spell_fold_var-0)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $worker_spell_test-0 #worker_spell_result_canon-0)\n)\n(ap #worker_spell_result_canon-0 worker_spell_gate-0)\n)\n)\n)\n(ap worker_spell_gate-0.$.[0] $array-inline-5)\n)\n(ap spell_id-1 $array-inline-5)\n)\n(canon %init_peer_id% $array-inline-5 #array-inline-5-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-4)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-5-0] str-1)\n)\n(par\n(call %init_peer_id% (spell_id-4 \"list_push_string\") [\"logs\" str-1])\n(seq\n(new $array-inline-6\n(seq\n(seq\n(ap spell_id-4 $array-inline-6)\n(ap #array-inline-5-0 $array-inline-6)\n)\n(canon %init_peer_id% $array-inline-6 #array-inline-6-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-6-0])\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 1])\n)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-7\n(seq\n(seq\n(ap \"Installing worker for deal\" $array-inline-7)\n(ap deal_id $array-inline-7)\n)\n(canon %init_peer_id% $array-inline-7 #array-inline-7-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-5)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-7-0] str-2)\n)\n(par\n(call %init_peer_id% (spell_id-5 \"list_push_string\") [\"logs\" str-2])\n(seq\n(new $array-inline-8\n(seq\n(seq\n(ap spell_id-5 $array-inline-8)\n(ap #array-inline-7-0 $array-inline-8)\n)\n(canon %init_peer_id% $array-inline-8 #array-inline-8-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-8-0])\n)\n)\n)\n(xor\n(seq\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [worker_def_cid ipfs] json)\n(xor\n(match json.$.success true\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"json\" \"parse\") [json.$.contents] worker_definition)\n(new $array-inline-9\n(seq\n(seq\n(seq\n(ap \"parsed worker definition\" $array-inline-9)\n(ap worker_def_cid $array-inline-9)\n)\n(ap worker_definition $array-inline-9)\n)\n(canon %init_peer_id% $array-inline-9 #array-inline-9-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-6)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-9-0] str-3)\n)\n(par\n(call %init_peer_id% (spell_id-6 \"list_push_string\") [\"logs\" str-3])\n(seq\n(new $array-inline-10\n(seq\n(seq\n(ap spell_id-6 $array-inline-10)\n(ap #array-inline-9-0 $array-inline-10)\n)\n(canon %init_peer_id% $array-inline-10 #array-inline-10-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-10-0])\n)\n)\n)\n(fold worker_definition.$.services s-0\n(seq\n(new $hashes\n(xor\n(seq\n(fold s-0.$.modules m-0\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"aqua-ipfs\" \"get_from\") [m-0.$.wasm ipfs] get_wasm)\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [m-0.$.config ipfs] json_cfg)\n)\n(null)\n)\n(new $res\n(seq\n(xor\n(match get_wasm.$.success true\n(ap json_cfg.$.success $res)\n)\n(ap false $res)\n)\n(new $res_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] res_incr)\n(fold $res res_fold_var\n(seq\n(seq\n(ap res_fold_var $res_test)\n(canon %init_peer_id% $res_test #res_iter_canon)\n)\n(xor\n(match #res_iter_canon.length res_incr\n(null)\n)\n(next res_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $res_test #res_result_canon)\n)\n(ap #res_result_canon res_gate)\n)\n)\n)\n)\n)\n(xor\n(match res_gate.$.[0] true\n(xor\n(seq\n(call %init_peer_id% (\"json\" \"parse\") [json_cfg.$.contents] cfg)\n(call %init_peer_id% (\"dist\" \"add_module_from_vault\") [get_wasm.$.path cfg] $hashes)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 2])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-11\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap s-0.$.name $array-inline-11)\n(ap \"error retrieving module\" $array-inline-11)\n)\n(new $array-inline-12\n(seq\n(seq\n(seq\n(ap \"wasm\" $array-inline-12)\n(ap m-0.$.wasm $array-inline-12)\n)\n(ap get_wasm $array-inline-12)\n)\n(canon %init_peer_id% $array-inline-12 #array-inline-12-0)\n)\n)\n)\n(ap #array-inline-12-0 $array-inline-11)\n)\n(new $array-inline-13\n(seq\n(seq\n(seq\n(ap \"config\" $array-inline-13)\n(ap m-0.$.config $array-inline-13)\n)\n(ap json_cfg $array-inline-13)\n)\n(canon %init_peer_id% $array-inline-13 #array-inline-13-0)\n)\n)\n)\n(ap #array-inline-13-0 $array-inline-11)\n)\n(canon %init_peer_id% $array-inline-11 #array-inline-11-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-7)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-11-0] str-4)\n)\n(par\n(call %init_peer_id% (spell_id-7 \"list_push_string\") [\"logs\" str-4])\n(seq\n(new $array-inline-14\n(seq\n(seq\n(ap spell_id-7 $array-inline-14)\n(ap #array-inline-11-0 $array-inline-14)\n)\n(canon %init_peer_id% $array-inline-14 #array-inline-14-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-14-0])\n)\n)\n)\n)\n)\n(next m-0)\n)\n)\n(xor\n(seq\n(par\n(seq\n(canon %init_peer_id% $hashes #hashes_to_functor)\n(ap #hashes_to_functor.length hashes_length)\n)\n(seq\n(seq\n(ap s-0.$.modules s-0_flat)\n(ap s-0_flat s-0_flat_to_functor)\n)\n(ap s-0_flat_to_functor.length s-0_flat_length)\n)\n)\n(match hashes_length s-0_flat_length\n(xor\n(seq\n(seq\n(seq\n(par\n(canon %init_peer_id% $hashes #hashes_canon)\n(null)\n)\n(call %init_peer_id% (\"dist\" \"make_blueprint\") [s-0.$.name #hashes_canon] blueprint)\n)\n(call %init_peer_id% (\"dist\" \"add_blueprint\") [blueprint] blueprint_id)\n)\n(xor\n(seq\n(new $result\n(seq\n(seq\n(call %init_peer_id% (\"worker-spell\" \"get_string\") [s-0.$.name] deployed)\n(xor\n(seq\n(seq\n(null)\n(new $res-0\n(seq\n(xor\n(match deployed.$.success true\n(ap deployed.$.absent $res-0)\n)\n(ap false $res-0)\n)\n(new $res-0_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] res-0_incr)\n(fold $res-0 res-0_fold_var\n(seq\n(seq\n(ap res-0_fold_var $res-0_test)\n(canon %init_peer_id% $res-0_test #res-0_iter_canon)\n)\n(xor\n(match #res-0_iter_canon.length res-0_incr\n(null)\n)\n(next res-0_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $res-0_test #res-0_result_canon)\n)\n(ap #res-0_result_canon res-0_gate)\n)\n)\n)\n)\n)\n(match res-0_gate.$.[0] true\n(ap false $result)\n)\n)\n(seq\n(seq\n(ap deployed.$.str deployed_flat)\n(call %init_peer_id% (\"srv\" \"info\") [deployed_flat] info)\n)\n(xor\n(match info.$.blueprint_id blueprint_id\n(ap true $result)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-15\n(seq\n(seq\n(ap s-0.$.name $array-inline-15)\n(ap \"blueprint changed, need to redeploy\" $array-inline-15)\n)\n(canon %init_peer_id% $array-inline-15 #array-inline-15-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-8)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-15-0] str-5)\n)\n(par\n(call %init_peer_id% (spell_id-8 \"list_push_string\") [\"logs\" str-5])\n(seq\n(new $array-inline-16\n(seq\n(seq\n(ap spell_id-8 $array-inline-16)\n(ap #array-inline-15-0 $array-inline-16)\n)\n(canon %init_peer_id% $array-inline-16 #array-inline-16-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-16-0])\n)\n)\n)\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-17\n(seq\n(seq\n(seq\n(ap s-0.$.name $array-inline-17)\n(ap \"removing old service\" $array-inline-17)\n)\n(ap deployed_flat $array-inline-17)\n)\n(canon %init_peer_id% $array-inline-17 #array-inline-17-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-9)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-17-0] str-6)\n)\n(par\n(call %init_peer_id% (spell_id-9 \"list_push_string\") [\"logs\" str-6])\n(seq\n(new $array-inline-18\n(seq\n(seq\n(ap spell_id-9 $array-inline-18)\n(ap #array-inline-17-0 $array-inline-18)\n)\n(canon %init_peer_id% $array-inline-18 #array-inline-18-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-18-0])\n)\n)\n)\n(call %init_peer_id% (\"srv\" \"remove\") [deployed_flat])\n)\n(new $array-inline-19\n(seq\n(seq\n(seq\n(ap s-0.$.name $array-inline-19)\n(ap \"old service successfully removed\" $array-inline-19)\n)\n(ap deployed_flat $array-inline-19)\n)\n(canon %init_peer_id% $array-inline-19 #array-inline-19-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-10)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-19-0] str-7)\n)\n(par\n(call %init_peer_id% (spell_id-10 \"list_push_string\") [\"logs\" str-7])\n(seq\n(new $array-inline-20\n(seq\n(seq\n(ap spell_id-10 $array-inline-20)\n(ap #array-inline-19-0 $array-inline-20)\n)\n(canon %init_peer_id% $array-inline-20 #array-inline-20-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-20-0])\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-21\n(seq\n(seq\n(seq\n(ap \"Error removing service\" $array-inline-21)\n(ap s-0.$.name $array-inline-21)\n)\n(ap %last_error% $array-inline-21)\n)\n(canon %init_peer_id% $array-inline-21 #array-inline-21-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-11)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-21-0] str-8)\n)\n(par\n(call %init_peer_id% (spell_id-11 \"list_push_string\") [\"logs\" str-8])\n(seq\n(new $array-inline-22\n(seq\n(seq\n(ap spell_id-11 $array-inline-22)\n(ap #array-inline-21-0 $array-inline-22)\n)\n(canon %init_peer_id% $array-inline-22 #array-inline-22-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-22-0])\n)\n)\n)\n)\n)\n(ap false $result)\n)\n)\n)\n)\n)\n(new $result_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] result_incr)\n(fold $result result_fold_var\n(seq\n(seq\n(ap result_fold_var $result_test)\n(canon %init_peer_id% $result_test #result_iter_canon)\n)\n(xor\n(match #result_iter_canon.length result_incr\n(null)\n)\n(next result_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $result_test #result_result_canon)\n)\n(ap #result_result_canon result_gate)\n)\n)\n)\n)\n(match result_gate.$.[0] false\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [\"status\" \"install in progress\"])\n(call %init_peer_id% (\"srv\" \"create\") [blueprint_id] service_id)\n)\n(new $array-inline-23\n(seq\n(seq\n(seq\n(ap \"Created service\" $array-inline-23)\n(ap s-0.$.name $array-inline-23)\n)\n(ap service_id $array-inline-23)\n)\n(canon %init_peer_id% $array-inline-23 #array-inline-23-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-12)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-23-0] str-9)\n)\n(par\n(call %init_peer_id% (spell_id-12 \"list_push_string\") [\"logs\" str-9])\n(seq\n(new $array-inline-24\n(seq\n(seq\n(ap spell_id-12 $array-inline-24)\n(ap #array-inline-23-0 $array-inline-24)\n)\n(canon %init_peer_id% $array-inline-24 #array-inline-24-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-24-0])\n)\n)\n)\n(xor\n(call %init_peer_id% (\"srv\" \"add_alias\") [s-0.$.name service_id])\n(seq\n(seq\n(seq\n(new $array-inline-25\n(seq\n(seq\n(seq\n(seq\n(ap \"Error creating alias for deployed service\" $array-inline-25)\n(ap s-0.$.name $array-inline-25)\n)\n(ap service_id $array-inline-25)\n)\n(ap %last_error% $array-inline-25)\n)\n(canon %init_peer_id% $array-inline-25 #array-inline-25-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-13)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-25-0] str-10)\n)\n(par\n(call %init_peer_id% (spell_id-13 \"list_push_string\") [\"logs\" str-10])\n(seq\n(new $array-inline-26\n(seq\n(seq\n(ap spell_id-13 $array-inline-26)\n(ap #array-inline-25-0 $array-inline-26)\n)\n(canon %init_peer_id% $array-inline-26 #array-inline-26-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-26-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [s-0.$.name service_id])\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"blueprint:\" s-0.$.name] concat_strings)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [concat_strings blueprint_id])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 3])\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-27\n(seq\n(seq\n(ap s-0.$.name $array-inline-27)\n(ap \"service is already deployed, doing nothing\" $array-inline-27)\n)\n(canon %init_peer_id% $array-inline-27 #array-inline-27-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-14)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-27-0] str-11)\n)\n(par\n(call %init_peer_id% (spell_id-14 \"list_push_string\") [\"logs\" str-11])\n(seq\n(new $array-inline-28\n(seq\n(seq\n(ap spell_id-14 $array-inline-28)\n(ap #array-inline-27-0 $array-inline-28)\n)\n(canon %init_peer_id% $array-inline-28 #array-inline-28-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-28-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 4])\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-29\n(seq\n(seq\n(ap s-0.$.name $array-inline-29)\n(ap \"error retrieving some of the modules, see above\" $array-inline-29)\n)\n(canon %init_peer_id% $array-inline-29 #array-inline-29-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-15)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-29-0] str-12)\n)\n(par\n(call %init_peer_id% (spell_id-15 \"list_push_string\") [\"logs\" str-12])\n(seq\n(new $array-inline-30\n(seq\n(seq\n(ap spell_id-15 $array-inline-30)\n(ap #array-inline-29-0 $array-inline-30)\n)\n(canon %init_peer_id% $array-inline-30 #array-inline-30-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-30-0])\n)\n)\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-31\n(seq\n(seq\n(seq\n(ap s-0.$.name $array-inline-31)\n(ap \"error deploying service\" $array-inline-31)\n)\n(ap %last_error% $array-inline-31)\n)\n(canon %init_peer_id% $array-inline-31 #array-inline-31-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-16)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-31-0] str-13)\n)\n(par\n(call %init_peer_id% (spell_id-16 \"list_push_string\") [\"logs\" str-13])\n(seq\n(new $array-inline-32\n(seq\n(seq\n(ap spell_id-16 $array-inline-32)\n(ap #array-inline-31-0 $array-inline-32)\n)\n(canon %init_peer_id% $array-inline-32 #array-inline-32-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-32-0])\n)\n)\n)\n)\n)\n(next s-0)\n)\n)\n)\n(fold worker_definition.$.spells sp-0\n(seq\n(xor\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-33\n(seq\n(seq\n(ap \"Deploying spell\" $array-inline-33)\n(ap sp-0.$.name $array-inline-33)\n)\n(canon %init_peer_id% $array-inline-33 #array-inline-33-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-17)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-33-0] str-14)\n)\n(par\n(call %init_peer_id% (spell_id-17 \"list_push_string\") [\"logs\" str-14])\n(seq\n(new $array-inline-34\n(seq\n(seq\n(ap spell_id-17 $array-inline-34)\n(ap #array-inline-33-0 $array-inline-34)\n)\n(canon %init_peer_id% $array-inline-34 #array-inline-34-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-34-0])\n)\n)\n)\n(xor\n(xor\n(seq\n(new $result-0\n(seq\n(xor\n(seq\n(call %init_peer_id% (\"worker-spell\" \"get_string\") [sp-0.$.name] deployed-0)\n(xor\n(seq\n(seq\n(null)\n(new $res-1\n(seq\n(xor\n(match deployed-0.$.success true\n(ap deployed-0.$.absent $res-1)\n)\n(ap false $res-1)\n)\n(new $res-1_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] res-1_incr)\n(fold $res-1 res-1_fold_var\n(seq\n(seq\n(ap res-1_fold_var $res-1_test)\n(canon %init_peer_id% $res-1_test #res-1_iter_canon)\n)\n(xor\n(match #res-1_iter_canon.length res-1_incr\n(null)\n)\n(next res-1_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $res-1_test #res-1_result_canon)\n)\n(ap #res-1_result_canon res-1_gate)\n)\n)\n)\n)\n)\n(match res-1_gate.$.[0] true\n(ap false $result-0)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap deployed-0.$.str deployed-0_flat)\n(call %init_peer_id% (\"srv\" \"info\") [deployed-0_flat])\n)\n(call %init_peer_id% (deployed-0_flat \"script_cid\") [] stored_script)\n)\n(new $array-inline-35\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap deployed-0_flat $array-inline-35)\n(ap \"script cid was:\" $array-inline-35)\n)\n(ap stored_script.$.v1_str $array-inline-35)\n)\n(ap \"new:\" $array-inline-35)\n)\n(ap sp-0.$.script $array-inline-35)\n)\n(canon %init_peer_id% $array-inline-35 #array-inline-35-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-19)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-35-0] str-15)\n)\n(par\n(call %init_peer_id% (spell_id-19 \"list_push_string\") [\"logs\" str-15])\n(seq\n(new $array-inline-36\n(seq\n(seq\n(ap spell_id-19 $array-inline-36)\n(ap #array-inline-35-0 $array-inline-36)\n)\n(canon %init_peer_id% $array-inline-36 #array-inline-36-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-36-0])\n)\n)\n)\n(xor\n(seq\n(null)\n(match stored_script.$.v1_str sp-0.$.script\n(ap true $result-0)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-37\n(seq\n(seq\n(ap sp-0.$.name $array-inline-37)\n(ap \"script changed, need to redeploy\" $array-inline-37)\n)\n(canon %init_peer_id% $array-inline-37 #array-inline-37-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-20)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-37-0] str-16)\n)\n(par\n(call %init_peer_id% (spell_id-20 \"list_push_string\") [\"logs\" str-16])\n(seq\n(new $array-inline-38\n(seq\n(seq\n(ap spell_id-20 $array-inline-38)\n(ap #array-inline-37-0 $array-inline-38)\n)\n(canon %init_peer_id% $array-inline-38 #array-inline-38-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-38-0])\n)\n)\n)\n(new $array-inline-39\n(seq\n(seq\n(seq\n(ap sp-0.$.name $array-inline-39)\n(ap \"removing old spell\" $array-inline-39)\n)\n(ap deployed-0_flat $array-inline-39)\n)\n(canon %init_peer_id% $array-inline-39 #array-inline-39-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-21)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-39-0] str-17)\n)\n(par\n(call %init_peer_id% (spell_id-21 \"list_push_string\") [\"logs\" str-17])\n(seq\n(new $array-inline-40\n(seq\n(seq\n(ap spell_id-21 $array-inline-40)\n(ap #array-inline-39-0 $array-inline-40)\n)\n(canon %init_peer_id% $array-inline-40 #array-inline-40-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-40-0])\n)\n)\n)\n(call %init_peer_id% (\"spell\" \"remove\") [deployed-0_flat])\n)\n(new $array-inline-41\n(seq\n(seq\n(seq\n(ap sp-0.$.name $array-inline-41)\n(ap \"old spell successfully removed\" $array-inline-41)\n)\n(ap deployed-0_flat $array-inline-41)\n)\n(canon %init_peer_id% $array-inline-41 #array-inline-41-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-22)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-41-0] str-18)\n)\n(par\n(call %init_peer_id% (spell_id-22 \"list_push_string\") [\"logs\" str-18])\n(seq\n(new $array-inline-42\n(seq\n(seq\n(ap spell_id-22 $array-inline-42)\n(ap #array-inline-41-0 $array-inline-42)\n)\n(canon %init_peer_id% $array-inline-42 #array-inline-42-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-42-0])\n)\n)\n)\n(ap false $result-0)\n)\n)\n)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-43\n(seq\n(seq\n(seq\n(ap \"Error check spell deployed\" $array-inline-43)\n(ap sp-0.$.name $array-inline-43)\n)\n(ap %last_error% $array-inline-43)\n)\n(canon %init_peer_id% $array-inline-43 #array-inline-43-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-23)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-43-0] str-19)\n)\n(par\n(call %init_peer_id% (spell_id-23 \"list_push_string\") [\"logs\" str-19])\n(seq\n(new $array-inline-44\n(seq\n(seq\n(ap spell_id-23 $array-inline-44)\n(ap #array-inline-43-0 $array-inline-44)\n)\n(canon %init_peer_id% $array-inline-44 #array-inline-44-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-44-0])\n)\n)\n)\n(ap false $result-0)\n)\n)\n(new $result-0_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] result-0_incr)\n(fold $result-0 result-0_fold_var\n(seq\n(seq\n(ap result-0_fold_var $result-0_test)\n(canon %init_peer_id% $result-0_test #result-0_iter_canon)\n)\n(xor\n(match #result-0_iter_canon.length result-0_incr\n(null)\n)\n(next result-0_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $result-0_test #result-0_result_canon)\n)\n(ap #result-0_result_canon result-0_gate)\n)\n)\n)\n)\n(match result-0_gate.$.[0] true\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-45\n(seq\n(seq\n(ap sp-0.$.name $array-inline-45)\n(ap \"spell is already deployed, checking config and init_args\" $array-inline-45)\n)\n(canon %init_peer_id% $array-inline-45 #array-inline-45-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-24)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-45-0] str-20)\n)\n(par\n(call %init_peer_id% (spell_id-24 \"list_push_string\") [\"logs\" str-20])\n(seq\n(new $array-inline-46\n(seq\n(seq\n(ap spell_id-24 $array-inline-46)\n(ap #array-inline-45-0 $array-inline-46)\n)\n(canon %init_peer_id% $array-inline-46 #array-inline-46-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-46-0])\n)\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"trigger_config:\" sp-0.$.name] concat_strings-0)\n)\n(call %init_peer_id% (\"worker-spell\" \"get_string\") [concat_strings-0] stored_config)\n)\n(xor\n(seq\n(null)\n(mismatch stored_config.$.str sp-0.$.config\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-47\n(seq\n(seq\n(ap sp-0.$.name $array-inline-47)\n(ap \"config mismath, updating config\" $array-inline-47)\n)\n(canon %init_peer_id% $array-inline-47 #array-inline-47-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-25)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-47-0] str-21)\n)\n(par\n(call %init_peer_id% (spell_id-25 \"list_push_string\") [\"logs\" str-21])\n(seq\n(new $array-inline-48\n(seq\n(seq\n(ap spell_id-25 $array-inline-48)\n(ap #array-inline-47-0 $array-inline-48)\n)\n(canon %init_peer_id% $array-inline-48 #array-inline-48-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-48-0])\n)\n)\n)\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [sp-0.$.config ipfs] config_json)\n)\n(xor\n(match config_json.$.success true\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"json\" \"parse\") [config_json.$.contents] config)\n(call %init_peer_id% (\"srv\" \"resolve_alias\") [sp-0.$.name] spell_id-18)\n)\n(call %init_peer_id% (\"spell\" \"update_trigger_config\") [spell_id-18 config])\n)\n(par\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"trigger_config:\" sp-0.$.name] concat_strings-1)\n(null)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [concat_strings-1 sp-0.$.config])\n)\n(new $array-inline-49\n(seq\n(seq\n(ap sp-0.$.name $array-inline-49)\n(ap \"config successfully updated\" $array-inline-49)\n)\n(canon %init_peer_id% $array-inline-49 #array-inline-49-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-26)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-49-0] str-22)\n)\n(par\n(call %init_peer_id% (spell_id-26 \"list_push_string\") [\"logs\" str-22])\n(seq\n(new $array-inline-50\n(seq\n(seq\n(ap spell_id-26 $array-inline-50)\n(ap #array-inline-49-0 $array-inline-50)\n)\n(canon %init_peer_id% $array-inline-50 #array-inline-50-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-50-0])\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 5])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-51\n(seq\n(seq\n(seq\n(seq\n(ap sp-0.$.name $array-inline-51)\n(ap \"error retrieving config\" $array-inline-51)\n)\n(ap sp-0.$.config $array-inline-51)\n)\n(ap config_json.$.error $array-inline-51)\n)\n(canon %init_peer_id% $array-inline-51 #array-inline-51-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-27)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-51-0] str-23)\n)\n(par\n(call %init_peer_id% (spell_id-27 \"list_push_string\") [\"logs\" str-23])\n(seq\n(new $array-inline-52\n(seq\n(seq\n(ap spell_id-27 $array-inline-52)\n(ap #array-inline-51-0 $array-inline-52)\n)\n(canon %init_peer_id% $array-inline-52 #array-inline-52-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-52-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 6])\n)\n)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n)\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"init_args:\" sp-0.$.name] concat_strings-2)\n)\n(call %init_peer_id% (\"worker-spell\" \"get_string\") [concat_strings-2] stored_init_args)\n)\n(xor\n(seq\n(null)\n(mismatch stored_init_args.$.str sp-0.$.init_args\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-53\n(seq\n(seq\n(ap sp-0.$.name $array-inline-53)\n(ap \"init_args changed, updating\" $array-inline-53)\n)\n(canon %init_peer_id% $array-inline-53 #array-inline-53-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-28)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-53-0] str-24)\n)\n(par\n(call %init_peer_id% (spell_id-28 \"list_push_string\") [\"logs\" str-24])\n(seq\n(new $array-inline-54\n(seq\n(seq\n(ap spell_id-28 $array-inline-54)\n(ap #array-inline-53-0 $array-inline-54)\n)\n(canon %init_peer_id% $array-inline-54 #array-inline-54-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-54-0])\n)\n)\n)\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [sp-0.$.init_args ipfs] new_init_args)\n)\n(xor\n(match new_init_args.$.success true\n(xor\n(call %init_peer_id% (sp-0.$.name \"set_json_fields\") [new_init_args.$.contents])\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 7])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-55\n(seq\n(seq\n(seq\n(seq\n(ap sp-0.$.name $array-inline-55)\n(ap \"error retrieving init_args\" $array-inline-55)\n)\n(ap sp-0.$.init_args $array-inline-55)\n)\n(ap new_init_args.$.error $array-inline-55)\n)\n(canon %init_peer_id% $array-inline-55 #array-inline-55-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-29)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-55-0] str-25)\n)\n(par\n(call %init_peer_id% (spell_id-29 \"list_push_string\") [\"logs\" str-25])\n(seq\n(new $array-inline-56\n(seq\n(seq\n(ap spell_id-29 $array-inline-56)\n(ap #array-inline-55-0 $array-inline-56)\n)\n(canon %init_peer_id% $array-inline-56 #array-inline-56-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-56-0])\n)\n)\n)\n)\n)\n(par\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"init_args:\" sp-0.$.name] concat_strings-3)\n(null)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [concat_strings-3 sp-0.$.init_args])\n)\n(new $array-inline-57\n(seq\n(seq\n(ap sp-0.$.name $array-inline-57)\n(ap \"init_args successfully updated\" $array-inline-57)\n)\n(canon %init_peer_id% $array-inline-57 #array-inline-57-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-30)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-57-0] str-26)\n)\n(par\n(call %init_peer_id% (spell_id-30 \"list_push_string\") [\"logs\" str-26])\n(seq\n(new $array-inline-58\n(seq\n(seq\n(ap spell_id-30 $array-inline-58)\n(ap #array-inline-57-0 $array-inline-58)\n)\n(canon %init_peer_id% $array-inline-58 #array-inline-58-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-58-0])\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 8])\n)\n)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 9])\n)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [\"status\" \"install in progress\"])\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [sp-0.$.script ipfs] script)\n)\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [sp-0.$.config ipfs] cfg_json)\n)\n(call %init_peer_id% (\"aqua-ipfs\" \"cat_from\") [sp-0.$.init_args ipfs] init_args_str)\n)\n(par\n(seq\n(null)\n(new $res-2\n(seq\n(xor\n(match script.$.success true\n(ap cfg_json.$.success $res-2)\n)\n(ap false $res-2)\n)\n(new $res-2_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] res-2_incr)\n(fold $res-2 res-2_fold_var\n(seq\n(seq\n(ap res-2_fold_var $res-2_test)\n(canon %init_peer_id% $res-2_test #res-2_iter_canon)\n)\n(xor\n(match #res-2_iter_canon.length res-2_incr\n(null)\n)\n(next res-2_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $res-2_test #res-2_result_canon)\n)\n(ap #res-2_result_canon res-2_gate)\n)\n)\n)\n)\n)\n(null)\n)\n)\n(new $res-3\n(seq\n(xor\n(match res-2_gate.$.[0] true\n(ap init_args_str.$.success $res-3)\n)\n(ap false $res-3)\n)\n(new $res-3_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] res-3_incr)\n(fold $res-3 res-3_fold_var\n(seq\n(seq\n(ap res-3_fold_var $res-3_test)\n(canon %init_peer_id% $res-3_test #res-3_iter_canon)\n)\n(xor\n(match #res-3_iter_canon.length res-3_incr\n(null)\n)\n(next res-3_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $res-3_test #res-3_result_canon)\n)\n(ap #res-3_result_canon res-3_gate)\n)\n)\n)\n)\n)\n(xor\n(match res-3_gate.$.[0] true\n(xor\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"json\" \"parse\") [cfg_json.$.contents] cfg-0)\n(call %init_peer_id% (\"json\" \"parse\") [init_args_str.$.contents] init_args)\n)\n(call %init_peer_id% (\"spell\" \"install\") [script.$.contents init_args cfg-0] sp_id)\n)\n(new $array-inline-59\n(seq\n(seq\n(seq\n(ap \"Installed spell\" $array-inline-59)\n(ap sp-0.$.name $array-inline-59)\n)\n(ap sp_id $array-inline-59)\n)\n(canon %init_peer_id% $array-inline-59 #array-inline-59-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-31)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-59-0] str-27)\n)\n(par\n(call %init_peer_id% (spell_id-31 \"list_push_string\") [\"logs\" str-27])\n(seq\n(new $array-inline-60\n(seq\n(seq\n(ap spell_id-31 $array-inline-60)\n(ap #array-inline-59-0 $array-inline-60)\n)\n(canon %init_peer_id% $array-inline-60 #array-inline-60-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-60-0])\n)\n)\n)\n(xor\n(call %init_peer_id% (\"srv\" \"add_alias\") [sp-0.$.name sp_id])\n(seq\n(seq\n(seq\n(new $array-inline-61\n(seq\n(seq\n(seq\n(seq\n(ap \"Error creating alias for deployed spell\" $array-inline-61)\n(ap sp-0.$.name $array-inline-61)\n)\n(ap sp_id $array-inline-61)\n)\n(ap %last_error% $array-inline-61)\n)\n(canon %init_peer_id% $array-inline-61 #array-inline-61-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-32)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-61-0] str-28)\n)\n(par\n(call %init_peer_id% (spell_id-32 \"list_push_string\") [\"logs\" str-28])\n(seq\n(new $array-inline-62\n(seq\n(seq\n(ap spell_id-32 $array-inline-62)\n(ap #array-inline-61-0 $array-inline-62)\n)\n(canon %init_peer_id% $array-inline-62 #array-inline-62-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-62-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [sp-0.$.name sp_id])\n)\n(par\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"trigger_config:\" sp-0.$.name] concat_strings-4)\n(null)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [concat_strings-4 sp-0.$.config])\n)\n(par\n(call %init_peer_id% (\"op\" \"concat_strings\") [\"init_args:\" sp-0.$.name] concat_strings-5)\n(null)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [concat_strings-5 sp-0.$.init_args])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 10])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-63\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap sp-0.$.name $array-inline-63)\n(ap \"error retrieving from IPFS\" $array-inline-63)\n)\n(new $array-inline-64\n(seq\n(seq\n(seq\n(ap \"script\" $array-inline-64)\n(ap sp-0.$.script $array-inline-64)\n)\n(ap script $array-inline-64)\n)\n(canon %init_peer_id% $array-inline-64 #array-inline-64-0)\n)\n)\n)\n(ap #array-inline-64-0 $array-inline-63)\n)\n(new $array-inline-65\n(seq\n(seq\n(seq\n(ap \"cfg_json\" $array-inline-65)\n(ap sp-0.$.config $array-inline-65)\n)\n(ap cfg_json $array-inline-65)\n)\n(canon %init_peer_id% $array-inline-65 #array-inline-65-0)\n)\n)\n)\n(ap #array-inline-65-0 $array-inline-63)\n)\n(new $array-inline-66\n(seq\n(seq\n(seq\n(ap \"init_args_str\" $array-inline-66)\n(ap sp-0.$.init_args $array-inline-66)\n)\n(ap init_args_str $array-inline-66)\n)\n(canon %init_peer_id% $array-inline-66 #array-inline-66-0)\n)\n)\n)\n(ap #array-inline-66-0 $array-inline-63)\n)\n(canon %init_peer_id% $array-inline-63 #array-inline-63-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-33)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-63-0] str-29)\n)\n(par\n(call %init_peer_id% (spell_id-33 \"list_push_string\") [\"logs\" str-29])\n(seq\n(new $array-inline-67\n(seq\n(seq\n(ap spell_id-33 $array-inline-67)\n(ap #array-inline-63-0 $array-inline-67)\n)\n(canon %init_peer_id% $array-inline-67 #array-inline-67-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-67-0])\n)\n)\n)\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-68\n(seq\n(seq\n(seq\n(ap \"Error deploy spell\" $array-inline-68)\n(ap sp-0.$.name $array-inline-68)\n)\n(ap %last_error% $array-inline-68)\n)\n(canon %init_peer_id% $array-inline-68 #array-inline-68-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-34)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-68-0] str-30)\n)\n(par\n(call %init_peer_id% (spell_id-34 \"list_push_string\") [\"logs\" str-30])\n(seq\n(new $array-inline-69\n(seq\n(seq\n(ap spell_id-34 $array-inline-69)\n(ap #array-inline-68-0 $array-inline-69)\n)\n(canon %init_peer_id% $array-inline-69 #array-inline-69-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-69-0])\n)\n)\n)\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-70\n(seq\n(seq\n(seq\n(ap \"Error deploying spell\" $array-inline-70)\n(ap sp-0.$.name $array-inline-70)\n)\n(ap %last_error% $array-inline-70)\n)\n(canon %init_peer_id% $array-inline-70 #array-inline-70-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-35)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-70-0] str-31)\n)\n(par\n(call %init_peer_id% (spell_id-35 \"list_push_string\") [\"logs\" str-31])\n(seq\n(new $array-inline-71\n(seq\n(seq\n(ap spell_id-35 $array-inline-71)\n(ap #array-inline-70-0 $array-inline-71)\n)\n(canon %init_peer_id% $array-inline-71 #array-inline-71-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-71-0])\n)\n)\n)\n)\n(next sp-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-36)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [\"Installation finished\"] str-32)\n)\n(par\n(call %init_peer_id% (spell_id-36 \"list_push_string\") [\"logs\" str-32])\n(seq\n(new $array-inline-72\n(seq\n(seq\n(ap spell_id-36 $array-inline-72)\n(ap \"Installation finished\" $array-inline-72)\n)\n(canon %init_peer_id% $array-inline-72 #array-inline-72-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-72-0])\n)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [\"status\" \"install finished\"])\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 11])\n)\n)\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-73\n(seq\n(seq\n(seq\n(seq\n(ap \"Error downloading worker definition from IPFS\" $array-inline-73)\n(ap ipfs $array-inline-73)\n)\n(ap worker_def_cid $array-inline-73)\n)\n(ap json $array-inline-73)\n)\n(canon %init_peer_id% $array-inline-73 #array-inline-73-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-37)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-73-0] str-33)\n)\n(par\n(call %init_peer_id% (spell_id-37 \"list_push_string\") [\"logs\" str-33])\n(seq\n(new $array-inline-74\n(seq\n(seq\n(ap spell_id-37 $array-inline-74)\n(ap #array-inline-73-0 $array-inline-74)\n)\n(canon %init_peer_id% $array-inline-74 #array-inline-74-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-74-0])\n)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [\"status\" \"install error\"])\n)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-75\n(seq\n(seq\n(ap \"Error installing worker\" $array-inline-75)\n(ap %last_error% $array-inline-75)\n)\n(canon %init_peer_id% $array-inline-75 #array-inline-75-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-38)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-75-0] str-34)\n)\n(par\n(call %init_peer_id% (spell_id-38 \"list_push_string\") [\"logs\" str-34])\n(seq\n(new $array-inline-76\n(seq\n(seq\n(ap spell_id-38 $array-inline-76)\n(ap #array-inline-75-0 $array-inline-76)\n)\n(canon %init_peer_id% $array-inline-76 #array-inline-76-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-76-0])\n)\n)\n)\n(call %init_peer_id% (\"worker-spell\" \"set_string\") [\"status\" \"install error\"])\n)\n)\n)\n(call %init_peer_id% (spell_id-1 \"get_string\") [\"status\"] status)\n)\n(new $array-inline-77\n(seq\n(seq\n(ap \"Worker installation finished with status\" $array-inline-77)\n(ap status.$.str $array-inline-77)\n)\n(canon %init_peer_id% $array-inline-77 #array-inline-77-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-39)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-77-0] str-35)\n)\n(par\n(call %init_peer_id% (spell_id-39 \"list_push_string\") [\"logs\" str-35])\n(seq\n(new $array-inline-78\n(seq\n(seq\n(ap spell_id-39 $array-inline-78)\n(ap #array-inline-77-0 $array-inline-78)\n)\n(canon %init_peer_id% $array-inline-78 #array-inline-78-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-78-0])\n)\n)\n)\n(xor\n(match status.$.str \"install finished\"\n(xor\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"peer\" \"timestamp_sec\") [] now)\n(call %init_peer_id% (spell_id-1 \"get_u32\") [\"subnet_created\"] created)\n)\n(call %init_peer_id% (spell_id-1 \"get_u32\") [\"worker_registered\"] registered)\n)\n(xor\n(match created.$.success true\n(xor\n(xor\n(match registered.$.success true\n(xor\n(xor\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"sub\") [now created.$.num] sub)\n(call %init_peer_id% (\"cmp\" \"gt\") [sub 43200] gt)\n)\n(match gt true\n(xor\n(seq\n(new $successful\n(new $subnetwork_id\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"peer\" \"timestamp_sec\") [] t)\n(xor\n(seq\n(seq\n(seq\n(seq\n(call -relay- (\"insecure_sig\" \"get_peer_id\") [] peer_id)\n(new $option-inline\n(seq\n(xor\n(ap peer_id $option-inline)\n(null)\n)\n(canon -relay- $option-inline #option-inline-0)\n)\n)\n)\n(call -relay- (\"registry\" \"get_key_bytes\") [deal_id #option-inline-0 t [] \"\"] bytes)\n)\n(call -relay- (\"insecure_sig\" \"sign\") [bytes] result-1)\n)\n(xor\n(match result-1.$.success false\n(ap result-1.$.error.[0] $error)\n)\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(ap result-1.$.signature result-1_flat)\n(call -relay- (\"registry\" \"get_key_id\") [deal_id peer_id] id)\n)\n(call -relay- (\"op\" \"string_to_b58\") [id] k)\n)\n(call -relay- (\"kad\" \"neighborhood\") [k [] []] nodes)\n)\n(xor\n(par\n(fold nodes n-0\n(par\n(seq\n(xor\n(xor\n(seq\n(seq\n(seq\n(seq\n(call n-0 (\"peer\" \"timestamp_sec\") [] t-0)\n(call n-0 (\"trust-graph\" \"get_weight\") [peer_id t-0] weight)\n)\n(new $option-inline-1\n(seq\n(xor\n(ap peer_id $option-inline-1)\n(null)\n)\n(canon n-0 $option-inline-1 #option-inline-1-0)\n)\n)\n)\n(call n-0 (\"registry\" \"register_key\") [deal_id #option-inline-1-0 t [] \"\" result-1_flat.$.[0] weight t-0] result-2)\n)\n(xor\n(match result-2.$.success true\n(ap true $successful)\n)\n(ap result-2.$.error $error)\n)\n)\n(call n-0 (\"op\" \"noop\") [])\n)\n(seq\n(call -relay- (\"op\" \"noop\") [])\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 12])\n)\n)\n(call -relay- (\"op\" \"noop\") [])\n)\n(next n-0)\n)\n(never)\n)\n(null)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 13])\n)\n)\n(new $status-0\n(new $result-3\n(seq\n(seq\n(seq\n(par\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"sub\") [1 1] sub-0)\n(new $successful_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [sub-0 1] successful_incr)\n(fold $successful successful_fold_var\n(seq\n(seq\n(ap successful_fold_var $successful_test)\n(canon -relay- $successful_test #successful_iter_canon)\n)\n(xor\n(match #successful_iter_canon.length successful_incr\n(null)\n)\n(next successful_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $successful_test #successful_result_canon)\n)\n(ap #successful_result_canon successful_gate)\n)\n)\n)\n(call -relay- (\"math\" \"sub\") [1 1] sub-1)\n)\n(ap \"ok\" $status-0)\n)\n(call -relay- (\"peer\" \"timeout\") [6000 \"timeout\"] $status-0)\n)\n(new $status-0_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] status-0_incr)\n(fold $status-0 status-0_fold_var\n(seq\n(seq\n(ap status-0_fold_var $status-0_test)\n(canon -relay- $status-0_test #status-0_iter_canon)\n)\n(xor\n(match #status-0_iter_canon.length status-0_incr\n(null)\n)\n(next status-0_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $status-0_test #status-0_result_canon)\n)\n(ap #status-0_result_canon status-0_gate)\n)\n)\n)\n(xor\n(match status-0_gate.$.[0] \"ok\"\n(ap true $result-3)\n)\n(ap false $result-3)\n)\n)\n(new $result-3_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] result-3_incr)\n(fold $result-3 result-3_fold_var\n(seq\n(seq\n(ap result-3_fold_var $result-3_test)\n(canon -relay- $result-3_test #result-3_iter_canon)\n)\n(xor\n(match #result-3_iter_canon.length result-3_incr\n(null)\n)\n(next result-3_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $result-3_test #result-3_result_canon)\n)\n(ap #result-3_result_canon result-3_gate)\n)\n)\n)\n)\n)\n)\n(xor\n(match result-3_gate.$.[0] false\n(ap \"key wasn't created: timeout exceeded\" $error)\n)\n(ap id $subnetwork_id)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 14])\n)\n)\n(canon %init_peer_id% $subnetwork_id #-subnetwork_id-fix-0)\n)\n(ap #-subnetwork_id-fix-0 -subnetwork_id-flat-0)\n)\n)\n)\n(xor\n(mismatch -subnetwork_id-flat-0 []\n(xor\n(seq\n(seq\n(seq\n(seq\n(new $array-inline-79\n(seq\n(seq\n(ap \"Subnet created\" $array-inline-79)\n(ap -subnetwork_id-flat-0.$.[0] $array-inline-79)\n)\n(canon %init_peer_id% $array-inline-79 #array-inline-79-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-40)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-79-0] str-36)\n)\n(par\n(call %init_peer_id% (spell_id-40 \"list_push_string\") [\"logs\" str-36])\n(seq\n(new $array-inline-80\n(seq\n(seq\n(ap spell_id-40 $array-inline-80)\n(ap #array-inline-79-0 $array-inline-80)\n)\n(canon %init_peer_id% $array-inline-80 #array-inline-80-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-80-0])\n)\n)\n)\n(ap -subnetwork_id-flat-0.$.[0] $subnet_id)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 15])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-81\n(seq\n(seq\n(seq\n(ap \"error creating subnetwork\" $array-inline-81)\n(canon %init_peer_id% $error #push-to-stream-1287)\n)\n(ap #push-to-stream-1287 $array-inline-81)\n)\n(canon %init_peer_id% $array-inline-81 #array-inline-81-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-41)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-81-0] str-37)\n)\n(par\n(call %init_peer_id% (spell_id-41 \"list_push_string\") [\"logs\" str-37])\n(seq\n(new $array-inline-82\n(seq\n(seq\n(ap spell_id-41 $array-inline-82)\n(ap #array-inline-81-0 $array-inline-82)\n)\n(canon %init_peer_id% $array-inline-82 #array-inline-82-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-82-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 16])\n)\n)\n)\n(xor\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"sub\") [now registered.$.num] sub-2)\n(call %init_peer_id% (\"cmp\" \"gt\") [sub-2 43200] gt-0)\n)\n(match gt-0 true\n(xor\n(seq\n(call %init_peer_id% (spell_id-1 \"get_string\") [\"subnet_id\"] sid)\n(xor\n(match sid.$.success true\n(ap sid.$.str $subnet_id)\n)\n(seq\n(seq\n(seq\n(new $array-inline-83\n(seq\n(seq\n(ap \"error reading subnet_id\" $array-inline-83)\n(ap sid $array-inline-83)\n)\n(canon %init_peer_id% $array-inline-83 #array-inline-83-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-42)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-83-0] str-38)\n)\n(par\n(call %init_peer_id% (spell_id-42 \"list_push_string\") [\"logs\" str-38])\n(seq\n(new $array-inline-84\n(seq\n(seq\n(ap spell_id-42 $array-inline-84)\n(ap #array-inline-83-0 $array-inline-84)\n)\n(canon %init_peer_id% $array-inline-84 #array-inline-84-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-84-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 17])\n)\n)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 18])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-85\n(seq\n(seq\n(ap \"error reading worker_registered\" $array-inline-85)\n(ap registered $array-inline-85)\n)\n(canon %init_peer_id% $array-inline-85 #array-inline-85-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-43)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-85-0] str-39)\n)\n(par\n(call %init_peer_id% (spell_id-43 \"list_push_string\") [\"logs\" str-39])\n(seq\n(new $array-inline-86\n(seq\n(seq\n(ap spell_id-43 $array-inline-86)\n(ap #array-inline-85-0 $array-inline-86)\n)\n(canon %init_peer_id% $array-inline-86 #array-inline-86-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-86-0])\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 19])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-87\n(seq\n(seq\n(ap \"error reading subnet_created\" $array-inline-87)\n(ap created $array-inline-87)\n)\n(canon %init_peer_id% $array-inline-87 #array-inline-87-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-44)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-87-0] str-40)\n)\n(par\n(call %init_peer_id% (spell_id-44 \"list_push_string\") [\"logs\" str-40])\n(seq\n(new $array-inline-88\n(seq\n(seq\n(ap spell_id-44 $array-inline-88)\n(ap #array-inline-87-0 $array-inline-88)\n)\n(canon %init_peer_id% $array-inline-88 #array-inline-88-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-88-0])\n)\n)\n)\n)\n)\n(xor\n(seq\n(canon %init_peer_id% $subnet_id #subnet_id_canon)\n(mismatch #subnet_id_canon []\n(xor\n(seq\n(seq\n(seq\n(seq\n(new $subnet_id_test\n(seq\n(seq\n(seq\n(call %init_peer_id% (\"math\" \"add\") [0 1] subnet_id_incr)\n(fold $subnet_id subnet_id_fold_var\n(seq\n(seq\n(ap subnet_id_fold_var $subnet_id_test)\n(canon %init_peer_id% $subnet_id_test #subnet_id_iter_canon)\n)\n(xor\n(match #subnet_id_iter_canon.length subnet_id_incr\n(null)\n)\n(next subnet_id_fold_var)\n)\n)\n(never)\n)\n)\n(canon %init_peer_id% $subnet_id_test #subnet_id_result_canon)\n)\n(ap #subnet_id_result_canon subnet_id_gate)\n)\n)\n(call %init_peer_id% (spell_id-1 \"set_string\") [\"subnet_id\" subnet_id_gate.$.[0]])\n)\n(call %init_peer_id% (spell_id-1 \"set_u32\") [\"subnet_created\" now])\n)\n(xor\n(seq\n(new $subnet_id_test-0\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] subnet_id_incr-0)\n(fold $subnet_id subnet_id_fold_var-0\n(seq\n(seq\n(ap subnet_id_fold_var-0 $subnet_id_test-0)\n(canon -relay- $subnet_id_test-0 #subnet_id_iter_canon-0)\n)\n(xor\n(match #subnet_id_iter_canon-0.length subnet_id_incr-0\n(null)\n)\n(next subnet_id_fold_var-0)\n)\n)\n(never)\n)\n)\n(canon -relay- $subnet_id_test-0 #subnet_id_result_canon-0)\n)\n(ap #subnet_id_result_canon-0 subnet_id_gate-0)\n)\n)\n(new $successful-0\n(new $error_get\n(new $success\n(seq\n(seq\n(seq\n(new $error-1\n(new $result-4\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call -relay- (\"peer\" \"timestamp_sec\") [] t-2)\n(new $option-inline-2\n(seq\n(xor\n(ap -relay- $option-inline-2)\n(null)\n)\n(canon -relay- $option-inline-2 #option-inline-2-0)\n)\n)\n)\n(call -relay- (\"registry\" \"get_record_metadata_bytes\") [subnet_id_gate-0.$.[0] %init_peer_id% t-2 \"\" %init_peer_id% #option-inline-2-0 [] []] bytes-0)\n)\n(xor\n(call %init_peer_id% (\"sig\" \"sign\") [bytes-0] sig_result-0)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 20])\n)\n)\n(xor\n(match sig_result-0.$.success true\n(xor\n(call -relay- (\"registry\" \"create_record_metadata\") [subnet_id_gate-0.$.[0] %init_peer_id% t-2 \"\" %init_peer_id% #option-inline-2-0 [] [] sig_result-0.$.signature.[0]] $result-4)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 21])\n)\n)\n(ap sig_result-0.$.error.[0] $error-1)\n)\n)\n(canon -relay- $result-4 #-result-fix-0)\n)\n(ap #-result-fix-0 -result-flat-0)\n)\n(canon -relay- $error-1 #-error-fix-1)\n)\n(ap #-error-fix-1 -error-flat-1)\n)\n)\n)\n(xor\n(match -result-flat-0 []\n(seq\n(ap false $success)\n(ap -error-flat-1.$.[0] $error-0)\n)\n)\n(seq\n(seq\n(call -relay- (\"peer\" \"timestamp_sec\") [] t-1)\n(new $signature\n(seq\n(seq\n(call -relay- (\"registry\" \"get_record_bytes\") [-result-flat-0.$.[0] t-1] bytes-1)\n(xor\n(call %init_peer_id% (\"sig\" \"sign\") [bytes-1] $signature)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 22])\n)\n)\n(new $signature_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] signature_incr)\n(fold $signature signature_fold_var\n(seq\n(seq\n(ap signature_fold_var $signature_test)\n(canon -relay- $signature_test #signature_iter_canon)\n)\n(xor\n(match #signature_iter_canon.length signature_incr\n(null)\n)\n(next signature_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $signature_test #signature_result_canon)\n)\n(ap #signature_result_canon signature_gate)\n)\n)\n)\n)\n)\n(xor\n(match signature_gate.$.[0].success false\n(seq\n(ap signature_gate.$.[0].error.[0] $error-0)\n(ap false $success)\n)\n)\n(seq\n(new $resources\n(new $successful-1\n(new $result-5\n(seq\n(seq\n(seq\n(seq\n(seq\n(seq\n(call -relay- (\"op\" \"string_to_b58\") [subnet_id_gate-0.$.[0]] k-0)\n(call -relay- (\"kad\" \"neighborhood\") [k-0 [] []] nodes-2)\n)\n(par\n(fold nodes-2 n-2-0\n(par\n(seq\n(xor\n(xor\n(seq\n(call n-2-0 (\"registry\" \"get_key_metadata\") [subnet_id_gate-0.$.[0]] get_result)\n(xor\n(match get_result.$.success true\n(seq\n(ap get_result.$.key $resources)\n(ap true $successful-1)\n)\n)\n(seq\n(call n-2-0 (\"op\" \"concat_strings\") [get_result.$.error \" on \"] e)\n(call n-2-0 (\"op\" \"concat_strings\") [e n-2-0] $error-2)\n)\n)\n)\n(call n-2-0 (\"op\" \"noop\") [])\n)\n(seq\n(call -relay- (\"op\" \"noop\") [])\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 23])\n)\n)\n(call -relay- (\"op\" \"noop\") [])\n)\n(next n-2-0)\n)\n(never)\n)\n(null)\n)\n)\n(new $status-1\n(new $result-6\n(seq\n(seq\n(seq\n(par\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"sub\") [1 1] sub-3)\n(new $successful-1_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [sub-3 1] successful-1_incr)\n(fold $successful-1 successful-1_fold_var\n(seq\n(seq\n(ap successful-1_fold_var $successful-1_test)\n(canon -relay- $successful-1_test #successful-1_iter_canon)\n)\n(xor\n(match #successful-1_iter_canon.length successful-1_incr\n(null)\n)\n(next successful-1_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $successful-1_test #successful-1_result_canon)\n)\n(ap #successful-1_result_canon successful-1_gate)\n)\n)\n)\n(call -relay- (\"math\" \"sub\") [1 1] sub-4)\n)\n(ap \"ok\" $status-1)\n)\n(call -relay- (\"peer\" \"timeout\") [6000 \"timeout\"] $status-1)\n)\n(new $status-1_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] status-1_incr)\n(fold $status-1 status-1_fold_var\n(seq\n(seq\n(ap status-1_fold_var $status-1_test)\n(canon -relay- $status-1_test #status-1_iter_canon)\n)\n(xor\n(match #status-1_iter_canon.length status-1_incr\n(null)\n)\n(next status-1_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $status-1_test #status-1_result_canon)\n)\n(ap #status-1_result_canon status-1_gate)\n)\n)\n)\n(xor\n(match status-1_gate.$.[0] \"ok\"\n(ap true $result-6)\n)\n(ap false $result-6)\n)\n)\n(new $result-6_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] result-6_incr)\n(fold $result-6 result-6_fold_var\n(seq\n(seq\n(ap result-6_fold_var $result-6_test)\n(canon -relay- $result-6_test #result-6_iter_canon)\n)\n(xor\n(match #result-6_iter_canon.length result-6_incr\n(null)\n)\n(next result-6_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $result-6_test #result-6_result_canon)\n)\n(ap #result-6_result_canon result-6_gate)\n)\n)\n)\n)\n)\n)\n(xor\n(match result-6_gate.$.[0] false\n(ap \"resource not found: timeout exceeded\" $error-2)\n)\n(seq\n(seq\n(canon -relay- $resources #resources_canon)\n(call -relay- (\"registry\" \"merge_keys\") [#resources_canon] merge_result)\n)\n(xor\n(match merge_result.$.success true\n(ap merge_result.$.key $result-5)\n)\n(ap merge_result.$.error $error-2)\n)\n)\n)\n)\n(canon -relay- $result-5 #-result-fix-0-0)\n)\n(ap #-result-fix-0-0 -result-flat-0-0)\n)\n)\n)\n)\n(xor\n(match -result-flat-0-0 []\n(xor\n(seq\n(seq\n(canon -relay- $error-2 #error-2_canon)\n(fold #error-2_canon e-0-0\n(seq\n(ap e-0-0 $error-0)\n(next e-0-0)\n)\n)\n)\n(ap false $success)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 24])\n)\n)\n(seq\n(seq\n(seq\n(call -relay- (\"peer\" \"timestamp_sec\") [] t-3)\n(call -relay- (\"trust-graph\" \"get_weight\") [-result-flat-0-0.$.[0].owner_peer_id t-3] weight-0)\n)\n(call -relay- (\"registry\" \"republish_key\") [-result-flat-0-0.$.[0] weight-0 t-3] result-7)\n)\n(xor\n(match result-7.$.success false\n(seq\n(ap result-7.$.error $error-0)\n(ap false $success)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(null)\n(call -relay- (\"peer\" \"timestamp_sec\") [] t-4)\n)\n(call -relay- (\"trust-graph\" \"get_weight\") [-result-flat-0.$.[0].issued_by t-4] weight-1)\n)\n(call -relay- (\"registry\" \"put_record\") [-result-flat-0.$.[0] t-1 signature_gate.$.[0].signature.[0] weight-1 t-4] result-8)\n)\n(xor\n(match result-8.$.success false\n(seq\n(ap result-8.$.error $error-0)\n(ap false $success)\n)\n)\n(seq\n(seq\n(seq\n(seq\n(call -relay- (\"op\" \"string_to_b58\") [subnet_id_gate-0.$.[0]] k-1)\n(call -relay- (\"kad\" \"neighborhood\") [k-1 [] []] nodes-3)\n)\n(par\n(fold nodes-3 n-1-0\n(par\n(seq\n(xor\n(xor\n(seq\n(seq\n(seq\n(call n-1-0 (\"peer\" \"timestamp_sec\") [] t-5)\n(call n-1-0 (\"trust-graph\" \"get_weight\") [-result-flat-0-0.$.[0].owner_peer_id t-5] weight-2)\n)\n(call n-1-0 (\"registry\" \"republish_key\") [-result-flat-0-0.$.[0] weight-2 t-5] result-9)\n)\n(xor\n(match result-9.$.success false\n(ap result-9.$.error $error-0)\n)\n(seq\n(seq\n(seq\n(seq\n(null)\n(call n-1-0 (\"peer\" \"timestamp_sec\") [] t-6)\n)\n(call n-1-0 (\"trust-graph\" \"get_weight\") [-result-flat-0.$.[0].issued_by t-6] weight-3)\n)\n(call n-1-0 (\"registry\" \"put_record\") [-result-flat-0.$.[0] t-1 signature_gate.$.[0].signature.[0] weight-3 t-6] result-10)\n)\n(xor\n(match result-10.$.success true\n(ap true $successful-0)\n)\n(ap result-10.$.error $error-0)\n)\n)\n)\n)\n(call n-1-0 (\"op\" \"noop\") [])\n)\n(seq\n(call -relay- (\"op\" \"noop\") [])\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 25])\n)\n)\n(call -relay- (\"op\" \"noop\") [])\n)\n(next n-1-0)\n)\n(never)\n)\n(null)\n)\n)\n(new $status-2\n(new $result-11\n(seq\n(seq\n(seq\n(par\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"sub\") [1 1] sub-5)\n(new $successful-0_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [sub-5 1] successful-0_incr)\n(fold $successful-0 successful-0_fold_var\n(seq\n(seq\n(ap successful-0_fold_var $successful-0_test)\n(canon -relay- $successful-0_test #successful-0_iter_canon)\n)\n(xor\n(match #successful-0_iter_canon.length successful-0_incr\n(null)\n)\n(next successful-0_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $successful-0_test #successful-0_result_canon)\n)\n(ap #successful-0_result_canon successful-0_gate)\n)\n)\n)\n(call -relay- (\"math\" \"sub\") [1 1] sub-6)\n)\n(ap \"ok\" $status-2)\n)\n(call -relay- (\"peer\" \"timeout\") [6000 \"timeout\"] $status-2)\n)\n(new $status-2_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] status-2_incr)\n(fold $status-2 status-2_fold_var\n(seq\n(seq\n(ap status-2_fold_var $status-2_test)\n(canon -relay- $status-2_test #status-2_iter_canon)\n)\n(xor\n(match #status-2_iter_canon.length status-2_incr\n(null)\n)\n(next status-2_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $status-2_test #status-2_result_canon)\n)\n(ap #status-2_result_canon status-2_gate)\n)\n)\n)\n(xor\n(match status-2_gate.$.[0] \"ok\"\n(ap true $result-11)\n)\n(ap false $result-11)\n)\n)\n(new $result-11_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] result-11_incr)\n(fold $result-11 result-11_fold_var\n(seq\n(seq\n(ap result-11_fold_var $result-11_test)\n(canon -relay- $result-11_test #result-11_iter_canon)\n)\n(xor\n(match #result-11_iter_canon.length result-11_incr\n(null)\n)\n(next result-11_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $result-11_test #result-11_result_canon)\n)\n(ap #result-11_result_canon result-11_gate)\n)\n)\n)\n)\n)\n)\n(ap result-11_gate.$.[0] $success)\n)\n)\n)\n)\n)\n)\n)\n)\n)\n)\n)\n(new $success_test\n(seq\n(seq\n(seq\n(call -relay- (\"math\" \"add\") [0 1] success_incr)\n(fold $success success_fold_var\n(seq\n(seq\n(ap success_fold_var $success_test)\n(canon -relay- $success_test #success_iter_canon)\n)\n(xor\n(match #success_iter_canon.length success_incr\n(null)\n)\n(next success_fold_var)\n)\n)\n(never)\n)\n)\n(canon -relay- $success_test #success_result_canon)\n)\n(ap #success_result_canon success_gate)\n)\n)\n)\n(xor\n(match success_gate.$.[0] false\n(ap \"worker hasn't registered: timeout exceeded\" $error-0)\n)\n(call -relay- (\"op\" \"noop\") [])\n)\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 26])\n)\n)\n(xor\n(match success_gate.$.[0] true\n(xor\n(seq\n(seq\n(seq\n(seq\n(call %init_peer_id% (spell_id-1 \"set_u32\") [\"worker_registered\" now])\n(new $array-inline-89\n(seq\n(seq\n(ap \"worker successfully registered in registry\" $array-inline-89)\n(ap success_gate.$.[0] $array-inline-89)\n)\n(canon %init_peer_id% $array-inline-89 #array-inline-89-0)\n)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-45)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-89-0] str-41)\n)\n(par\n(call %init_peer_id% (spell_id-45 \"list_push_string\") [\"logs\" str-41])\n(seq\n(new $array-inline-90\n(seq\n(seq\n(ap spell_id-45 $array-inline-90)\n(ap #array-inline-89-0 $array-inline-90)\n)\n(canon %init_peer_id% $array-inline-90 #array-inline-90-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-90-0])\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 27])\n)\n)\n(seq\n(seq\n(seq\n(new $array-inline-91\n(seq\n(seq\n(seq\n(ap \"error registering worker\" $array-inline-91)\n(canon %init_peer_id% $error-0 #push-to-stream-1724)\n)\n(ap #push-to-stream-1724 $array-inline-91)\n)\n(canon %init_peer_id% $array-inline-91 #array-inline-91-0)\n)\n)\n(call %init_peer_id% (\"getDataSrv\" \"spell_id\") [] spell_id-46)\n)\n(call %init_peer_id% (\"debug\" \"stringify\") [#array-inline-91-0] str-42)\n)\n(par\n(call %init_peer_id% (spell_id-46 \"list_push_string\") [\"logs\" str-42])\n(seq\n(new $array-inline-92\n(seq\n(seq\n(ap spell_id-46 $array-inline-92)\n(ap #array-inline-91-0 $array-inline-92)\n)\n(canon %init_peer_id% $array-inline-92 #array-inline-92-0)\n)\n)\n(call %init_peer_id% (\"run-console\" \"print\") [#array-inline-92-0])\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 28])\n)\n)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 29])\n)\n)\n(call %init_peer_id% (\"op\" \"noop\") [])\n)\n)\n)\n)\n)\n)\n)\n)\n)\n(call %init_peer_id% (\"errorHandlingSrv\" \"error\") [%last_error% 30])\n)"}
