 (seq
  (seq
   (seq
    (seq
     (seq
      (seq
       (seq
        (seq
         (seq
          (seq
           (seq
            (seq
             (seq
              (seq
               (seq
                (seq
                 (call %init_peer_id% ("getDataSrv" "-relay-") [] -relay-)
                 (call %init_peer_id% ("getDataSrv" "spell_id") [] -spell_id-arg-)
                )
                (call %init_peer_id% ("getDataSrv" "ipfs") [] -ipfs-arg-)
               )
               (call %init_peer_id% ("getDataSrv" "deal_id") [] -deal_id-arg-)
              )
              (call %init_peer_id% ("getDataSrv" "worker_def_cid") [] -worker_def_cid-arg-)
             )
             (new $array-inline
              (seq
               (seq
                (seq
                 (seq
                  (seq
                   (ap "worker" $array-inline)
                   (ap -spell_id-arg- $array-inline)
                  )
                  (ap -deal_id-arg- $array-inline)
                 )
                 (ap -worker_def_cid-arg- $array-inline)
                )
                (ap -ipfs-arg- $array-inline)
               )
               (canon %init_peer_id% $array-inline  #array-inline-0)
              )
             )
            )
            (call %init_peer_id% ("run-console" "print") [#array-inline-0])
           )
           (new $array-inline-1
            (seq
             (seq
              (ap "Installing worker for deal" $array-inline-1)
              (ap -deal_id-arg- $array-inline-1)
             )
             (canon %init_peer_id% $array-inline-1  #array-inline-1-0)
            )
           )
          )
          (call %init_peer_id% ("debug" "stringify") [#array-inline-1-0] ret)
         )
         (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-0)
        )
        (par
         (call %init_peer_id% (ret-0 "store_log") [ret] ret-1)
         (seq
          (new $array-inline-2
           (seq
            (seq
             (ap ret-0 $array-inline-2)
             (ap #array-inline-1-0 $array-inline-2)
            )
            (canon %init_peer_id% $array-inline-2  #array-inline-2-0)
           )
          )
          (call %init_peer_id% ("run-console" "print") [#array-inline-2-0])
         )
        )
       )
       (xor
        (seq
         (call %init_peer_id% ("aqua-ipfs" "cat_from") [-worker_def_cid-arg- -ipfs-arg-] ret-2)
         (new -if-else-error-
          (new -else-error-
           (new -if-error-
            (xor
             (match ret-2.$.success true
              (seq
               (seq
                (seq
                 (seq
                  (seq
                   (seq
                    (seq
                     (seq
                      (seq
                       (seq
                        (seq
                         (call %init_peer_id% ("json" "parse") [ret-2.$.contents] ret-3)
                         (new $array-inline-3
                          (seq
                           (seq
                            (seq
                             (ap "parsed worker definition" $array-inline-3)
                             (ap -worker_def_cid-arg- $array-inline-3)
                            )
                            (ap ret-3 $array-inline-3)
                           )
                           (canon %init_peer_id% $array-inline-3  #array-inline-3-0)
                          )
                         )
                        )
                        (call %init_peer_id% ("debug" "stringify") [#array-inline-3-0] ret-4)
                       )
                       (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-5)
                      )
                      (par
                       (call %init_peer_id% (ret-5 "store_log") [ret-4] ret-6)
                       (seq
                        (new $array-inline-4
                         (seq
                          (seq
                           (ap ret-5 $array-inline-4)
                           (ap #array-inline-3-0 $array-inline-4)
                          )
                          (canon %init_peer_id% $array-inline-4  #array-inline-4-0)
                         )
                        )
                        (call %init_peer_id% ("run-console" "print") [#array-inline-4-0])
                       )
                      )
                     )
                     (fold ret-3.$.services s-0
                      (seq
                       (xor
                        (seq
                         (seq
                          (new $hashes-0
                           (seq
                            (seq
                             (fold s-0.$.modules m-0
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (call %init_peer_id% ("aqua-ipfs" "get_from") [m-0.$.wasm -ipfs-arg-] ret-7)
                                  (call %init_peer_id% ("aqua-ipfs" "cat_from") [m-0.$.config -ipfs-arg-] ret-8)
                                 )
                                 (xor
                                  (match ret-7.$.success false
                                   (ap ret-7.$.success and)
                                  )
                                  (ap ret-8.$.success and)
                                 )
                                )
                                (new -if-else-error-
                                 (new -else-error-
                                  (new -if-error-
                                   (xor
                                    (match and true
                                     (seq
                                      (seq
                                       (call %init_peer_id% ("json" "parse") [ret-8.$.contents] ret-9)
                                       (call %init_peer_id% ("dist" "add_module_from_vault") [ret-7.$.path ret-9] ret-10)
                                      )
                                      (ap ret-10 $hashes-0)
                                     )
                                    )
                                    (seq
                                     (ap :error: -if-error-)
                                     (xor
                                      (match :error:.$.error_code 10001
                                       (seq
                                        (seq
                                         (seq
                                          (new $array-inline-5
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (new $array-inline-6
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (ap "wasm" $array-inline-6)
                                                     (ap m-0.$.wasm $array-inline-6)
                                                    )
                                                    (ap ret-7 $array-inline-6)
                                                   )
                                                   (canon %init_peer_id% $array-inline-6  #array-inline-6-0)
                                                  )
                                                 )
                                                 (new $array-inline-7
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (ap "config" $array-inline-7)
                                                     (ap m-0.$.config $array-inline-7)
                                                    )
                                                    (ap ret-8 $array-inline-7)
                                                   )
                                                   (canon %init_peer_id% $array-inline-7  #array-inline-7-0)
                                                  )
                                                 )
                                                )
                                                (ap s-0.$.name $array-inline-5)
                                               )
                                               (ap "error retrieving module" $array-inline-5)
                                              )
                                              (ap #array-inline-6-0 $array-inline-5)
                                             )
                                             (ap #array-inline-7-0 $array-inline-5)
                                            )
                                            (canon %init_peer_id% $array-inline-5  #array-inline-5-0)
                                           )
                                          )
                                          (call %init_peer_id% ("debug" "stringify") [#array-inline-5-0] ret-11)
                                         )
                                         (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-12)
                                        )
                                        (par
                                         (call %init_peer_id% (ret-12 "store_log") [ret-11] ret-13)
                                         (seq
                                          (new $array-inline-8
                                           (seq
                                            (seq
                                             (ap ret-12 $array-inline-8)
                                             (ap #array-inline-5-0 $array-inline-8)
                                            )
                                            (canon %init_peer_id% $array-inline-8  #array-inline-8-0)
                                           )
                                          )
                                          (call %init_peer_id% ("run-console" "print") [#array-inline-8-0])
                                         )
                                        )
                                       )
                                      )
                                      (seq
                                       (seq
                                        (ap :error: -else-error-)
                                        (xor
                                         (match :error:.$.error_code 10001
                                          (ap -if-error- -if-else-error-)
                                         )
                                         (ap -else-error- -if-else-error-)
                                        )
                                       )
                                       (fail -if-else-error-)
                                      )
                                     )
                                    )
                                   )
                                  )
                                 )
                                )
                               )
                               (next m-0)
                              )
                             )
                             (canon %init_peer_id% $hashes-0  #-hashes-fix-0)
                            )
                            (ap #-hashes-fix-0 -hashes-flat-0)
                           )
                          )
                          (par
                           (seq
                            (ap -hashes-flat-0 -hashes-flat-0_to_functor)
                            (ap -hashes-flat-0_to_functor.length -hashes-flat-0_length)
                           )
                           (seq
                            (seq
                             (ap s-0.$.modules s-0_flat)
                             (ap s-0_flat s-0_flat_to_functor)
                            )
                            (ap s-0_flat_to_functor.length s-0_flat_length)
                           )
                          )
                         )
                         (new -if-else-error-
                          (new -else-error-
                           (new -if-error-
                            (xor
                             (match -hashes-flat-0_length s-0_flat_length
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (call %init_peer_id% ("dist" "make_blueprint") [s-0.$.name -hashes-flat-0] ret-14)
                                  (call %init_peer_id% ("dist" "add_blueprint") [ret-14] ret-15)
                                 )
                                 (new $result
                                  (seq
                                   (seq
                                    (seq
                                     (call %init_peer_id% ("worker-spell" "get_string") [s-0.$.name] ret-16)
                                     (xor
                                      (match ret-16.$.success false
                                       (ap ret-16.$.success and-0)
                                      )
                                      (ap ret-16.$.absent and-0)
                                     )
                                    )
                                    (new -if-else-error-
                                     (new -else-error-
                                      (new -if-error-
                                       (xor
                                        (match and-0 true
                                         (ap false $result)
                                        )
                                        (seq
                                         (ap :error: -if-error-)
                                         (xor
                                          (match :error:.$.error_code 10001
                                           (seq
                                            (seq
                                             (ap ret-16.$.value ret-16_flat)
                                             (call %init_peer_id% ("srv" "info") [ret-16_flat] ret-17)
                                            )
                                            (new -if-else-error-
                                             (new -else-error-
                                              (new -if-error-
                                               (xor
                                                (match ret-17.$.blueprint_id ret-15
                                                 (ap true $result)
                                                )
                                                (seq
                                                 (ap :error: -if-error-)
                                                 (xor
                                                  (match :error:.$.error_code 10001
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (new $array-inline-9
                                                         (seq
                                                          (seq
                                                           (ap s-0.$.name $array-inline-9)
                                                           (ap "blueprint changed, need to redeploy" $array-inline-9)
                                                          )
                                                          (canon %init_peer_id% $array-inline-9  #array-inline-9-0)
                                                         )
                                                        )
                                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-9-0] ret-18)
                                                       )
                                                       (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-19)
                                                      )
                                                      (par
                                                       (call %init_peer_id% (ret-19 "store_log") [ret-18] ret-20)
                                                       (seq
                                                        (new $array-inline-10
                                                         (seq
                                                          (seq
                                                           (ap ret-19 $array-inline-10)
                                                           (ap #array-inline-9-0 $array-inline-10)
                                                          )
                                                          (canon %init_peer_id% $array-inline-10  #array-inline-10-0)
                                                         )
                                                        )
                                                        (call %init_peer_id% ("run-console" "print") [#array-inline-10-0])
                                                       )
                                                      )
                                                     )
                                                     (xor
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (new $array-inline-11
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (ap s-0.$.name $array-inline-11)
                                                                  (ap "removing old service" $array-inline-11)
                                                                 )
                                                                 (ap ret-16_flat $array-inline-11)
                                                                )
                                                                (canon %init_peer_id% $array-inline-11  #array-inline-11-0)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("debug" "stringify") [#array-inline-11-0] ret-21)
                                                             )
                                                             (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-22)
                                                            )
                                                            (par
                                                             (call %init_peer_id% (ret-22 "store_log") [ret-21] ret-23)
                                                             (seq
                                                              (new $array-inline-12
                                                               (seq
                                                                (seq
                                                                 (ap ret-22 $array-inline-12)
                                                                 (ap #array-inline-11-0 $array-inline-12)
                                                                )
                                                                (canon %init_peer_id% $array-inline-12  #array-inline-12-0)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("run-console" "print") [#array-inline-12-0])
                                                             )
                                                            )
                                                           )
                                                           (call %init_peer_id% ("srv" "remove") [ret-16_flat])
                                                          )
                                                          (new $array-inline-13
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (ap s-0.$.name $array-inline-13)
                                                              (ap "old service successfully removed" $array-inline-13)
                                                             )
                                                             (ap ret-16_flat $array-inline-13)
                                                            )
                                                            (canon %init_peer_id% $array-inline-13  #array-inline-13-0)
                                                           )
                                                          )
                                                         )
                                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-13-0] ret-24)
                                                        )
                                                        (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-25)
                                                       )
                                                       (par
                                                        (call %init_peer_id% (ret-25 "store_log") [ret-24] ret-26)
                                                        (seq
                                                         (new $array-inline-14
                                                          (seq
                                                           (seq
                                                            (ap ret-25 $array-inline-14)
                                                            (ap #array-inline-13-0 $array-inline-14)
                                                           )
                                                           (canon %init_peer_id% $array-inline-14  #array-inline-14-0)
                                                          )
                                                         )
                                                         (call %init_peer_id% ("run-console" "print") [#array-inline-14-0])
                                                        )
                                                       )
                                                      )
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (new $array-inline-15
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (ap "Error removing service" $array-inline-15)
                                                             (ap s-0.$.name $array-inline-15)
                                                            )
                                                            (ap :error: $array-inline-15)
                                                           )
                                                           (canon %init_peer_id% $array-inline-15  #array-inline-15-0)
                                                          )
                                                         )
                                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-15-0] ret-27)
                                                        )
                                                        (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-28)
                                                       )
                                                       (par
                                                        (call %init_peer_id% (ret-28 "store_log") [ret-27] ret-29)
                                                        (seq
                                                         (new $array-inline-16
                                                          (seq
                                                           (seq
                                                            (ap ret-28 $array-inline-16)
                                                            (ap #array-inline-15-0 $array-inline-16)
                                                           )
                                                           (canon %init_peer_id% $array-inline-16  #array-inline-16-0)
                                                          )
                                                         )
                                                         (call %init_peer_id% ("run-console" "print") [#array-inline-16-0])
                                                        )
                                                       )
                                                      )
                                                     )
                                                    )
                                                    (ap false $result)
                                                   )
                                                  )
                                                  (seq
                                                   (seq
                                                    (ap :error: -else-error-)
                                                    (xor
                                                     (match :error:.$.error_code 10001
                                                      (ap -if-error- -if-else-error-)
                                                     )
                                                     (ap -else-error- -if-else-error-)
                                                    )
                                                   )
                                                   (fail -if-else-error-)
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                          )
                                          (seq
                                           (seq
                                            (ap :error: -else-error-)
                                            (xor
                                             (match :error:.$.error_code 10001
                                              (ap -if-error- -if-else-error-)
                                             )
                                             (ap -else-error- -if-else-error-)
                                            )
                                           )
                                           (fail -if-else-error-)
                                          )
                                         )
                                        )
                                       )
                                      )
                                     )
                                    )
                                   )
                                   (new $result_test
                                    (seq
                                     (seq
                                      (fold $result result_fold_var
                                       (seq
                                        (seq
                                         (ap result_fold_var $result_test)
                                         (canon %init_peer_id% $result_test  #result_iter_canon)
                                        )
                                        (xor
                                         (match #result_iter_canon.length 1
                                          (null)
                                         )
                                         (next result_fold_var)
                                        )
                                       )
                                       (never)
                                      )
                                      (canon %init_peer_id% $result_test  #result_result_canon)
                                     )
                                     (ap #result_result_canon result_gate)
                                    )
                                   )
                                  )
                                 )
                                )
                                (xor
                                 (match result_gate.$.[0] true
                                  (ap false not)
                                 )
                                 (ap true not)
                                )
                               )
                               (new -if-else-error-
                                (new -else-error-
                                 (new -if-error-
                                  (xor
                                   (match not true
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (call %init_peer_id% ("peer" "timestamp_sec") [] ret-30)
                                                (new %Status_obj_map
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (ap ("message" "") %Status_obj_map)
                                                    (ap ("state" "INSTALLATION_IN_PROGRESS") %Status_obj_map)
                                                   )
                                                   (ap ("timestamp" ret-30) %Status_obj_map)
                                                  )
                                                  (canon %init_peer_id% %Status_obj_map  Status_obj)
                                                 )
                                                )
                                               )
                                               (call %init_peer_id% ("json" "stringify") [Status_obj] ret-31)
                                              )
                                              (call %init_peer_id% ("worker-spell" "list_push_string") ["__installation_spell_status__" ret-31] ret-32)
                                             )
                                             (call %init_peer_id% ("srv" "create") [ret-15] ret-33)
                                            )
                                            (new $array-inline-17
                                             (seq
                                              (seq
                                               (seq
                                                (ap "Created service" $array-inline-17)
                                                (ap s-0.$.name $array-inline-17)
                                               )
                                               (ap ret-33 $array-inline-17)
                                              )
                                              (canon %init_peer_id% $array-inline-17  #array-inline-17-0)
                                             )
                                            )
                                           )
                                           (call %init_peer_id% ("debug" "stringify") [#array-inline-17-0] ret-34)
                                          )
                                          (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-35)
                                         )
                                         (par
                                          (call %init_peer_id% (ret-35 "store_log") [ret-34] ret-36)
                                          (seq
                                           (new $array-inline-18
                                            (seq
                                             (seq
                                              (ap ret-35 $array-inline-18)
                                              (ap #array-inline-17-0 $array-inline-18)
                                             )
                                             (canon %init_peer_id% $array-inline-18  #array-inline-18-0)
                                            )
                                           )
                                           (call %init_peer_id% ("run-console" "print") [#array-inline-18-0])
                                          )
                                         )
                                        )
                                        (xor
                                         (call %init_peer_id% ("srv" "add_alias") [s-0.$.name ret-33])
                                         (seq
                                          (seq
                                           (seq
                                            (new $array-inline-19
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (ap "Error creating alias for deployed service" $array-inline-19)
                                                 (ap s-0.$.name $array-inline-19)
                                                )
                                                (ap ret-33 $array-inline-19)
                                               )
                                               (ap :error: $array-inline-19)
                                              )
                                              (canon %init_peer_id% $array-inline-19  #array-inline-19-0)
                                             )
                                            )
                                            (call %init_peer_id% ("debug" "stringify") [#array-inline-19-0] ret-37)
                                           )
                                           (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-38)
                                          )
                                          (par
                                           (call %init_peer_id% (ret-38 "store_log") [ret-37] ret-39)
                                           (seq
                                            (new $array-inline-20
                                             (seq
                                              (seq
                                               (ap ret-38 $array-inline-20)
                                               (ap #array-inline-19-0 $array-inline-20)
                                              )
                                              (canon %init_peer_id% $array-inline-20  #array-inline-20-0)
                                             )
                                            )
                                            (call %init_peer_id% ("run-console" "print") [#array-inline-20-0])
                                           )
                                          )
                                         )
                                        )
                                       )
                                       (call %init_peer_id% ("worker-spell" "set_string") [s-0.$.name ret-33] ret-40)
                                      )
                                      (call %init_peer_id% ("op" "concat_strings") ["blueprint:" s-0.$.name] ret-41)
                                     )
                                     (call %init_peer_id% ("worker-spell" "set_string") [ret-41 ret-15] ret-42)
                                    )
                                   )
                                   (seq
                                    (ap :error: -if-error-)
                                    (xor
                                     (match :error:.$.error_code 10001
                                      (seq
                                       (seq
                                        (seq
                                         (new $array-inline-21
                                          (seq
                                           (seq
                                            (ap s-0.$.name $array-inline-21)
                                            (ap "service is already deployed, doing nothing" $array-inline-21)
                                           )
                                           (canon %init_peer_id% $array-inline-21  #array-inline-21-0)
                                          )
                                         )
                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-21-0] ret-43)
                                        )
                                        (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-44)
                                       )
                                       (par
                                        (call %init_peer_id% (ret-44 "store_log") [ret-43] ret-45)
                                        (seq
                                         (new $array-inline-22
                                          (seq
                                           (seq
                                            (ap ret-44 $array-inline-22)
                                            (ap #array-inline-21-0 $array-inline-22)
                                           )
                                           (canon %init_peer_id% $array-inline-22  #array-inline-22-0)
                                          )
                                         )
                                         (call %init_peer_id% ("run-console" "print") [#array-inline-22-0])
                                        )
                                       )
                                      )
                                     )
                                     (seq
                                      (seq
                                       (ap :error: -else-error-)
                                       (xor
                                        (match :error:.$.error_code 10001
                                         (ap -if-error- -if-else-error-)
                                        )
                                        (ap -else-error- -if-else-error-)
                                       )
                                      )
                                      (fail -if-else-error-)
                                     )
                                    )
                                   )
                                  )
                                 )
                                )
                               )
                              )
                             )
                             (seq
                              (ap :error: -if-error-)
                              (xor
                               (match :error:.$.error_code 10001
                                (seq
                                 (seq
                                  (seq
                                   (new $array-inline-23
                                    (seq
                                     (seq
                                      (ap s-0.$.name $array-inline-23)
                                      (ap "error retrieving some of the modules, see above" $array-inline-23)
                                     )
                                     (canon %init_peer_id% $array-inline-23  #array-inline-23-0)
                                    )
                                   )
                                   (call %init_peer_id% ("debug" "stringify") [#array-inline-23-0] ret-46)
                                  )
                                  (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-47)
                                 )
                                 (par
                                  (call %init_peer_id% (ret-47 "store_log") [ret-46] ret-48)
                                  (seq
                                   (new $array-inline-24
                                    (seq
                                     (seq
                                      (ap ret-47 $array-inline-24)
                                      (ap #array-inline-23-0 $array-inline-24)
                                     )
                                     (canon %init_peer_id% $array-inline-24  #array-inline-24-0)
                                    )
                                   )
                                   (call %init_peer_id% ("run-console" "print") [#array-inline-24-0])
                                  )
                                 )
                                )
                               )
                               (seq
                                (seq
                                 (ap :error: -else-error-)
                                 (xor
                                  (match :error:.$.error_code 10001
                                   (ap -if-error- -if-else-error-)
                                  )
                                  (ap -else-error- -if-else-error-)
                                 )
                                )
                                (fail -if-else-error-)
                               )
                              )
                             )
                            )
                           )
                          )
                         )
                        )
                        (seq
                         (seq
                          (seq
                           (new $array-inline-25
                            (seq
                             (seq
                              (seq
                               (ap s-0.$.name $array-inline-25)
                               (ap "error deploying service" $array-inline-25)
                              )
                              (ap :error: $array-inline-25)
                             )
                             (canon %init_peer_id% $array-inline-25  #array-inline-25-0)
                            )
                           )
                           (call %init_peer_id% ("debug" "stringify") [#array-inline-25-0] ret-49)
                          )
                          (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-50)
                         )
                         (par
                          (call %init_peer_id% (ret-50 "store_log") [ret-49] ret-51)
                          (seq
                           (new $array-inline-26
                            (seq
                             (seq
                              (ap ret-50 $array-inline-26)
                              (ap #array-inline-25-0 $array-inline-26)
                             )
                             (canon %init_peer_id% $array-inline-26  #array-inline-26-0)
                            )
                           )
                           (call %init_peer_id% ("run-console" "print") [#array-inline-26-0])
                          )
                         )
                        )
                       )
                       (next s-0)
                      )
                     )
                    )
                    (fold ret-3.$.spells sp-0
                     (seq
                      (xor
                       (seq
                        (seq
                         (seq
                          (seq
                           (new $array-inline-27
                            (seq
                             (seq
                              (ap "Deploying spell" $array-inline-27)
                              (ap sp-0.$.name $array-inline-27)
                             )
                             (canon %init_peer_id% $array-inline-27  #array-inline-27-0)
                            )
                           )
                           (call %init_peer_id% ("debug" "stringify") [#array-inline-27-0] ret-52)
                          )
                          (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-53)
                         )
                         (par
                          (call %init_peer_id% (ret-53 "store_log") [ret-52] ret-54)
                          (seq
                           (new $array-inline-28
                            (seq
                             (seq
                              (ap ret-53 $array-inline-28)
                              (ap #array-inline-27-0 $array-inline-28)
                             )
                             (canon %init_peer_id% $array-inline-28  #array-inline-28-0)
                            )
                           )
                           (call %init_peer_id% ("run-console" "print") [#array-inline-28-0])
                          )
                         )
                        )
                        (xor
                         (seq
                          (new $result-0
                           (seq
                            (xor
                             (seq
                              (seq
                               (call %init_peer_id% ("worker-spell" "get_string") [sp-0.$.name] ret-55)
                               (xor
                                (match ret-55.$.success false
                                 (ap ret-55.$.success and-1)
                                )
                                (ap ret-55.$.absent and-1)
                               )
                              )
                              (new -if-else-error-
                               (new -else-error-
                                (new -if-error-
                                 (xor
                                  (match and-1 true
                                   (ap false $result-0)
                                  )
                                  (seq
                                   (ap :error: -if-error-)
                                   (xor
                                    (match :error:.$.error_code 10001
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (ap ret-55.$.value ret-55_flat)
                                            (call %init_peer_id% ("srv" "info") [ret-55_flat] ret-56)
                                           )
                                           (call %init_peer_id% (ret-55_flat "script_cid") [] ret-57)
                                          )
                                          (new $array-inline-29
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (ap ret-55_flat $array-inline-29)
                                                (ap "script cid was:" $array-inline-29)
                                               )
                                               (ap ret-57.$.value $array-inline-29)
                                              )
                                              (ap "new:" $array-inline-29)
                                             )
                                             (ap sp-0.$.script $array-inline-29)
                                            )
                                            (canon %init_peer_id% $array-inline-29  #array-inline-29-0)
                                           )
                                          )
                                         )
                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-29-0] ret-58)
                                        )
                                        (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-59)
                                       )
                                       (par
                                        (call %init_peer_id% (ret-59 "store_log") [ret-58] ret-60)
                                        (seq
                                         (new $array-inline-30
                                          (seq
                                           (seq
                                            (ap ret-59 $array-inline-30)
                                            (ap #array-inline-29-0 $array-inline-30)
                                           )
                                           (canon %init_peer_id% $array-inline-30  #array-inline-30-0)
                                          )
                                         )
                                         (call %init_peer_id% ("run-console" "print") [#array-inline-30-0])
                                        )
                                       )
                                      )
                                      (new -if-else-error-
                                       (new -else-error-
                                        (new -if-error-
                                         (xor
                                          (match ret-57.$.value sp-0.$.script
                                           (ap true $result-0)
                                          )
                                          (seq
                                           (ap :error: -if-error-)
                                           (xor
                                            (match :error:.$.error_code 10001
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (new $array-inline-31
                                                           (seq
                                                            (seq
                                                             (ap sp-0.$.name $array-inline-31)
                                                             (ap "script changed, need to redeploy" $array-inline-31)
                                                            )
                                                            (canon %init_peer_id% $array-inline-31  #array-inline-31-0)
                                                           )
                                                          )
                                                          (call %init_peer_id% ("debug" "stringify") [#array-inline-31-0] ret-61)
                                                         )
                                                         (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-62)
                                                        )
                                                        (par
                                                         (call %init_peer_id% (ret-62 "store_log") [ret-61] ret-63)
                                                         (seq
                                                          (new $array-inline-32
                                                           (seq
                                                            (seq
                                                             (ap ret-62 $array-inline-32)
                                                             (ap #array-inline-31-0 $array-inline-32)
                                                            )
                                                            (canon %init_peer_id% $array-inline-32  #array-inline-32-0)
                                                           )
                                                          )
                                                          (call %init_peer_id% ("run-console" "print") [#array-inline-32-0])
                                                         )
                                                        )
                                                       )
                                                       (new $array-inline-33
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (ap sp-0.$.name $array-inline-33)
                                                           (ap "removing old spell" $array-inline-33)
                                                          )
                                                          (ap ret-55_flat $array-inline-33)
                                                         )
                                                         (canon %init_peer_id% $array-inline-33  #array-inline-33-0)
                                                        )
                                                       )
                                                      )
                                                      (call %init_peer_id% ("debug" "stringify") [#array-inline-33-0] ret-64)
                                                     )
                                                     (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-65)
                                                    )
                                                    (par
                                                     (call %init_peer_id% (ret-65 "store_log") [ret-64] ret-66)
                                                     (seq
                                                      (new $array-inline-34
                                                       (seq
                                                        (seq
                                                         (ap ret-65 $array-inline-34)
                                                         (ap #array-inline-33-0 $array-inline-34)
                                                        )
                                                        (canon %init_peer_id% $array-inline-34  #array-inline-34-0)
                                                       )
                                                      )
                                                      (call %init_peer_id% ("run-console" "print") [#array-inline-34-0])
                                                     )
                                                    )
                                                   )
                                                   (call %init_peer_id% ("spell" "remove") [ret-55_flat])
                                                  )
                                                  (new $array-inline-35
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (ap sp-0.$.name $array-inline-35)
                                                      (ap "old spell successfully removed" $array-inline-35)
                                                     )
                                                     (ap ret-55_flat $array-inline-35)
                                                    )
                                                    (canon %init_peer_id% $array-inline-35  #array-inline-35-0)
                                                   )
                                                  )
                                                 )
                                                 (call %init_peer_id% ("debug" "stringify") [#array-inline-35-0] ret-67)
                                                )
                                                (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-68)
                                               )
                                               (par
                                                (call %init_peer_id% (ret-68 "store_log") [ret-67] ret-69)
                                                (seq
                                                 (new $array-inline-36
                                                  (seq
                                                   (seq
                                                    (ap ret-68 $array-inline-36)
                                                    (ap #array-inline-35-0 $array-inline-36)
                                                   )
                                                   (canon %init_peer_id% $array-inline-36  #array-inline-36-0)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("run-console" "print") [#array-inline-36-0])
                                                )
                                               )
                                              )
                                              (ap false $result-0)
                                             )
                                            )
                                            (seq
                                             (seq
                                              (ap :error: -else-error-)
                                              (xor
                                               (match :error:.$.error_code 10001
                                                (ap -if-error- -if-else-error-)
                                               )
                                               (ap -else-error- -if-else-error-)
                                              )
                                             )
                                             (fail -if-else-error-)
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                     )
                                    )
                                    (seq
                                     (seq
                                      (ap :error: -else-error-)
                                      (xor
                                       (match :error:.$.error_code 10001
                                        (ap -if-error- -if-else-error-)
                                       )
                                       (ap -else-error- -if-else-error-)
                                      )
                                     )
                                     (fail -if-else-error-)
                                    )
                                   )
                                  )
                                 )
                                )
                               )
                              )
                             )
                             (seq
                              (seq
                               (seq
                                (seq
                                 (new $array-inline-37
                                  (seq
                                   (seq
                                    (seq
                                     (ap "Error check spell deployed" $array-inline-37)
                                     (ap sp-0.$.name $array-inline-37)
                                    )
                                    (ap :error: $array-inline-37)
                                   )
                                   (canon %init_peer_id% $array-inline-37  #array-inline-37-0)
                                  )
                                 )
                                 (call %init_peer_id% ("debug" "stringify") [#array-inline-37-0] ret-70)
                                )
                                (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-71)
                               )
                               (par
                                (call %init_peer_id% (ret-71 "store_log") [ret-70] ret-72)
                                (seq
                                 (new $array-inline-38
                                  (seq
                                   (seq
                                    (ap ret-71 $array-inline-38)
                                    (ap #array-inline-37-0 $array-inline-38)
                                   )
                                   (canon %init_peer_id% $array-inline-38  #array-inline-38-0)
                                  )
                                 )
                                 (call %init_peer_id% ("run-console" "print") [#array-inline-38-0])
                                )
                               )
                              )
                              (ap false $result-0)
                             )
                            )
                            (new $result-0_test
                             (seq
                              (seq
                               (fold $result-0 result-0_fold_var
                                (seq
                                 (seq
                                  (ap result-0_fold_var $result-0_test)
                                  (canon %init_peer_id% $result-0_test  #result-0_iter_canon)
                                 )
                                 (xor
                                  (match #result-0_iter_canon.length 1
                                   (null)
                                  )
                                  (next result-0_fold_var)
                                 )
                                )
                                (never)
                               )
                               (canon %init_peer_id% $result-0_test  #result-0_result_canon)
                              )
                              (ap #result-0_result_canon result-0_gate)
                             )
                            )
                           )
                          )
                          (new -if-else-error-
                           (new -else-error-
                            (new -if-error-
                             (xor
                              (match result-0_gate.$.[0] true
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (new $array-inline-39
                                         (seq
                                          (seq
                                           (ap sp-0.$.name $array-inline-39)
                                           (ap "spell is already deployed, checking config and init_args" $array-inline-39)
                                          )
                                          (canon %init_peer_id% $array-inline-39  #array-inline-39-0)
                                         )
                                        )
                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-39-0] ret-73)
                                       )
                                       (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-74)
                                      )
                                      (par
                                       (call %init_peer_id% (ret-74 "store_log") [ret-73] ret-75)
                                       (seq
                                        (new $array-inline-40
                                         (seq
                                          (seq
                                           (ap ret-74 $array-inline-40)
                                           (ap #array-inline-39-0 $array-inline-40)
                                          )
                                          (canon %init_peer_id% $array-inline-40  #array-inline-40-0)
                                         )
                                        )
                                        (call %init_peer_id% ("run-console" "print") [#array-inline-40-0])
                                       )
                                      )
                                     )
                                     (call %init_peer_id% ("op" "concat_strings") ["trigger_config:" sp-0.$.name] ret-76)
                                    )
                                    (call %init_peer_id% ("worker-spell" "get_string") [ret-76] ret-77)
                                   )
                                   (new -if-error-
                                    (xor
                                     (mismatch ret-77.$.value sp-0.$.config
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (new $array-inline-41
                                            (seq
                                             (seq
                                              (ap sp-0.$.name $array-inline-41)
                                              (ap "config mismath, updating config" $array-inline-41)
                                             )
                                             (canon %init_peer_id% $array-inline-41  #array-inline-41-0)
                                            )
                                           )
                                           (call %init_peer_id% ("debug" "stringify") [#array-inline-41-0] ret-78)
                                          )
                                          (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-79)
                                         )
                                         (par
                                          (call %init_peer_id% (ret-79 "store_log") [ret-78] ret-80)
                                          (seq
                                           (new $array-inline-42
                                            (seq
                                             (seq
                                              (ap ret-79 $array-inline-42)
                                              (ap #array-inline-41-0 $array-inline-42)
                                             )
                                             (canon %init_peer_id% $array-inline-42  #array-inline-42-0)
                                            )
                                           )
                                           (call %init_peer_id% ("run-console" "print") [#array-inline-42-0])
                                          )
                                         )
                                        )
                                        (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.config -ipfs-arg-] ret-81)
                                       )
                                       (new -if-else-error-
                                        (new -else-error-
                                         (new -if-error-
                                          (xor
                                           (match ret-81.$.success true
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (call %init_peer_id% ("json" "parse") [ret-81.$.contents] ret-82)
                                                    (call %init_peer_id% ("srv" "resolve_alias") [sp-0.$.name] ret-83)
                                                   )
                                                   (call %init_peer_id% ("spell" "update_trigger_config") [ret-83 ret-82])
                                                  )
                                                  (call %init_peer_id% ("op" "concat_strings") ["trigger_config:" sp-0.$.name] ret-84)
                                                 )
                                                 (call %init_peer_id% ("worker-spell" "set_string") [ret-84 sp-0.$.config] ret-85)
                                                )
                                                (new $array-inline-43
                                                 (seq
                                                  (seq
                                                   (ap sp-0.$.name $array-inline-43)
                                                   (ap "config successfully updated" $array-inline-43)
                                                  )
                                                  (canon %init_peer_id% $array-inline-43  #array-inline-43-0)
                                                 )
                                                )
                                               )
                                               (call %init_peer_id% ("debug" "stringify") [#array-inline-43-0] ret-86)
                                              )
                                              (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-87)
                                             )
                                             (par
                                              (call %init_peer_id% (ret-87 "store_log") [ret-86] ret-88)
                                              (seq
                                               (new $array-inline-44
                                                (seq
                                                 (seq
                                                  (ap ret-87 $array-inline-44)
                                                  (ap #array-inline-43-0 $array-inline-44)
                                                 )
                                                 (canon %init_peer_id% $array-inline-44  #array-inline-44-0)
                                                )
                                               )
                                               (call %init_peer_id% ("run-console" "print") [#array-inline-44-0])
                                              )
                                             )
                                            )
                                           )
                                           (seq
                                            (ap :error: -if-error-)
                                            (xor
                                             (match :error:.$.error_code 10001
                                              (seq
                                               (seq
                                                (seq
                                                 (new $array-inline-45
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (ap sp-0.$.name $array-inline-45)
                                                      (ap "error retrieving config" $array-inline-45)
                                                     )
                                                     (ap sp-0.$.config $array-inline-45)
                                                    )
                                                    (ap ret-81.$.error $array-inline-45)
                                                   )
                                                   (canon %init_peer_id% $array-inline-45  #array-inline-45-0)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("debug" "stringify") [#array-inline-45-0] ret-89)
                                                )
                                                (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-90)
                                               )
                                               (par
                                                (call %init_peer_id% (ret-90 "store_log") [ret-89] ret-91)
                                                (seq
                                                 (new $array-inline-46
                                                  (seq
                                                   (seq
                                                    (ap ret-90 $array-inline-46)
                                                    (ap #array-inline-45-0 $array-inline-46)
                                                   )
                                                   (canon %init_peer_id% $array-inline-46  #array-inline-46-0)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("run-console" "print") [#array-inline-46-0])
                                                )
                                               )
                                              )
                                             )
                                             (seq
                                              (seq
                                               (ap :error: -else-error-)
                                               (xor
                                                (match :error:.$.error_code 10001
                                                 (ap -if-error- -if-else-error-)
                                                )
                                                (ap -else-error- -if-else-error-)
                                               )
                                              )
                                              (fail -if-else-error-)
                                             )
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                     )
                                     (seq
                                      (ap :error: -if-error-)
                                      (xor
                                       (match :error:.$.error_code 10002
                                        (null)
                                       )
                                       (fail -if-error-)
                                      )
                                     )
                                    )
                                   )
                                  )
                                  (call %init_peer_id% ("op" "concat_strings") ["init_args:" sp-0.$.name] ret-92)
                                 )
                                 (call %init_peer_id% ("worker-spell" "get_string") [ret-92] ret-93)
                                )
                                (new -if-error-
                                 (xor
                                  (mismatch ret-93.$.value sp-0.$.init_args
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (new $array-inline-47
                                               (seq
                                                (seq
                                                 (ap sp-0.$.name $array-inline-47)
                                                 (ap "init_args changed, updating" $array-inline-47)
                                                )
                                                (canon %init_peer_id% $array-inline-47  #array-inline-47-0)
                                               )
                                              )
                                              (call %init_peer_id% ("debug" "stringify") [#array-inline-47-0] ret-94)
                                             )
                                             (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-95)
                                            )
                                            (par
                                             (call %init_peer_id% (ret-95 "store_log") [ret-94] ret-96)
                                             (seq
                                              (new $array-inline-48
                                               (seq
                                                (seq
                                                 (ap ret-95 $array-inline-48)
                                                 (ap #array-inline-47-0 $array-inline-48)
                                                )
                                                (canon %init_peer_id% $array-inline-48  #array-inline-48-0)
                                               )
                                              )
                                              (call %init_peer_id% ("run-console" "print") [#array-inline-48-0])
                                             )
                                            )
                                           )
                                           (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.init_args -ipfs-arg-] ret-97)
                                          )
                                          (new -if-else-error-
                                           (new -else-error-
                                            (new -if-error-
                                             (xor
                                              (match ret-97.$.success true
                                               (call %init_peer_id% (sp-0.$.name "set_json_fields") [ret-97.$.contents] ret-98)
                                              )
                                              (seq
                                               (ap :error: -if-error-)
                                               (xor
                                                (match :error:.$.error_code 10001
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (new $array-inline-49
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (ap sp-0.$.name $array-inline-49)
                                                         (ap "error retrieving init_args" $array-inline-49)
                                                        )
                                                        (ap sp-0.$.init_args $array-inline-49)
                                                       )
                                                       (ap ret-97.$.error $array-inline-49)
                                                      )
                                                      (canon %init_peer_id% $array-inline-49  #array-inline-49-0)
                                                     )
                                                    )
                                                    (call %init_peer_id% ("debug" "stringify") [#array-inline-49-0] ret-99)
                                                   )
                                                   (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-100)
                                                  )
                                                  (par
                                                   (call %init_peer_id% (ret-100 "store_log") [ret-99] ret-101)
                                                   (seq
                                                    (new $array-inline-50
                                                     (seq
                                                      (seq
                                                       (ap ret-100 $array-inline-50)
                                                       (ap #array-inline-49-0 $array-inline-50)
                                                      )
                                                      (canon %init_peer_id% $array-inline-50  #array-inline-50-0)
                                                     )
                                                    )
                                                    (call %init_peer_id% ("run-console" "print") [#array-inline-50-0])
                                                   )
                                                  )
                                                 )
                                                )
                                                (seq
                                                 (seq
                                                  (ap :error: -else-error-)
                                                  (xor
                                                   (match :error:.$.error_code 10001
                                                    (ap -if-error- -if-else-error-)
                                                   )
                                                   (ap -else-error- -if-else-error-)
                                                  )
                                                 )
                                                 (fail -if-else-error-)
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                         (call %init_peer_id% ("op" "concat_strings") ["init_args:" sp-0.$.name] ret-102)
                                        )
                                        (call %init_peer_id% ("worker-spell" "set_string") [ret-102 sp-0.$.init_args] ret-103)
                                       )
                                       (new $array-inline-51
                                        (seq
                                         (seq
                                          (ap sp-0.$.name $array-inline-51)
                                          (ap "init_args successfully updated" $array-inline-51)
                                         )
                                         (canon %init_peer_id% $array-inline-51  #array-inline-51-0)
                                        )
                                       )
                                      )
                                      (call %init_peer_id% ("debug" "stringify") [#array-inline-51-0] ret-104)
                                     )
                                     (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-105)
                                    )
                                    (par
                                     (call %init_peer_id% (ret-105 "store_log") [ret-104] ret-106)
                                     (seq
                                      (new $array-inline-52
                                       (seq
                                        (seq
                                         (ap ret-105 $array-inline-52)
                                         (ap #array-inline-51-0 $array-inline-52)
                                        )
                                        (canon %init_peer_id% $array-inline-52  #array-inline-52-0)
                                       )
                                      )
                                      (call %init_peer_id% ("run-console" "print") [#array-inline-52-0])
                                     )
                                    )
                                   )
                                  )
                                  (seq
                                   (ap :error: -if-error-)
                                   (xor
                                    (match :error:.$.error_code 10002
                                     (null)
                                    )
                                    (fail -if-error-)
                                   )
                                  )
                                 )
                                )
                               )
                              )
                              (seq
                               (ap :error: -if-error-)
                               (xor
                                (match :error:.$.error_code 10001
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (call %init_peer_id% ("peer" "timestamp_sec") [] ret-107)
                                          (new %Status_obj-0_map
                                           (seq
                                            (seq
                                             (seq
                                              (ap ("message" "") %Status_obj-0_map)
                                              (ap ("state" "INSTALLATION_IN_PROGRESS") %Status_obj-0_map)
                                             )
                                             (ap ("timestamp" ret-107) %Status_obj-0_map)
                                            )
                                            (canon %init_peer_id% %Status_obj-0_map  Status_obj-0)
                                           )
                                          )
                                         )
                                         (call %init_peer_id% ("json" "stringify") [Status_obj-0] ret-108)
                                        )
                                        (call %init_peer_id% ("worker-spell" "list_push_string") ["__installation_spell_status__" ret-108] ret-109)
                                       )
                                       (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.script -ipfs-arg-] ret-110)
                                      )
                                      (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.config -ipfs-arg-] ret-111)
                                     )
                                     (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.init_args -ipfs-arg-] ret-112)
                                    )
                                    (xor
                                     (match ret-110.$.success false
                                      (ap ret-110.$.success and-2)
                                     )
                                     (ap ret-111.$.success and-2)
                                    )
                                   )
                                   (xor
                                    (match and-2 false
                                     (ap and-2 and-3)
                                    )
                                    (ap ret-112.$.success and-3)
                                   )
                                  )
                                  (new -if-else-error-
                                   (new -else-error-
                                    (new -if-error-
                                     (xor
                                      (match and-3 true
                                       (seq
                                        (seq
                                         (call %init_peer_id% ("json" "parse") [ret-111.$.contents] ret-113)
                                         (call %init_peer_id% ("json" "parse") [ret-112.$.contents] ret-114)
                                        )
                                        (xor
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (call %init_peer_id% ("spell" "install") [ret-110.$.contents ret-114 ret-113 sp-0.$.name] ret-115)
                                                  (new $array-inline-53
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (ap "Installed spell" $array-inline-53)
                                                      (ap sp-0.$.name $array-inline-53)
                                                     )
                                                     (ap ret-115 $array-inline-53)
                                                    )
                                                    (canon %init_peer_id% $array-inline-53  #array-inline-53-0)
                                                   )
                                                  )
                                                 )
                                                 (call %init_peer_id% ("debug" "stringify") [#array-inline-53-0] ret-116)
                                                )
                                                (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-117)
                                               )
                                               (par
                                                (call %init_peer_id% (ret-117 "store_log") [ret-116] ret-118)
                                                (seq
                                                 (new $array-inline-54
                                                  (seq
                                                   (seq
                                                    (ap ret-117 $array-inline-54)
                                                    (ap #array-inline-53-0 $array-inline-54)
                                                   )
                                                   (canon %init_peer_id% $array-inline-54  #array-inline-54-0)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("run-console" "print") [#array-inline-54-0])
                                                )
                                               )
                                              )
                                              (call %init_peer_id% ("worker-spell" "set_string") [sp-0.$.name ret-115] ret-119)
                                             )
                                             (call %init_peer_id% ("op" "concat_strings") ["trigger_config:" sp-0.$.name] ret-120)
                                            )
                                            (call %init_peer_id% ("worker-spell" "set_string") [ret-120 sp-0.$.config] ret-121)
                                           )
                                           (call %init_peer_id% ("op" "concat_strings") ["init_args:" sp-0.$.name] ret-122)
                                          )
                                          (call %init_peer_id% ("worker-spell" "set_string") [ret-122 sp-0.$.init_args] ret-123)
                                         )
                                         (seq
                                          (seq
                                           (seq
                                            (new $array-inline-55
                                             (seq
                                              (seq
                                               (seq
                                                (ap "Error installing the spell" $array-inline-55)
                                                (ap sp-0.$.name $array-inline-55)
                                               )
                                               (ap :error: $array-inline-55)
                                              )
                                              (canon %init_peer_id% $array-inline-55  #array-inline-55-0)
                                             )
                                            )
                                            (call %init_peer_id% ("debug" "stringify") [#array-inline-55-0] ret-124)
                                           )
                                           (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-125)
                                          )
                                          (par
                                           (call %init_peer_id% (ret-125 "store_log") [ret-124] ret-126)
                                           (seq
                                            (new $array-inline-56
                                             (seq
                                              (seq
                                               (ap ret-125 $array-inline-56)
                                               (ap #array-inline-55-0 $array-inline-56)
                                              )
                                              (canon %init_peer_id% $array-inline-56  #array-inline-56-0)
                                             )
                                            )
                                            (call %init_peer_id% ("run-console" "print") [#array-inline-56-0])
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                      (seq
                                       (ap :error: -if-error-)
                                       (xor
                                        (match :error:.$.error_code 10001
                                         (seq
                                          (seq
                                           (seq
                                            (new $array-inline-57
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (new $array-inline-58
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (ap "script" $array-inline-58)
                                                         (ap sp-0.$.script $array-inline-58)
                                                        )
                                                        (ap ret-110 $array-inline-58)
                                                       )
                                                       (canon %init_peer_id% $array-inline-58  #array-inline-58-0)
                                                      )
                                                     )
                                                     (new $array-inline-59
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (ap "cfg_json" $array-inline-59)
                                                         (ap sp-0.$.config $array-inline-59)
                                                        )
                                                        (ap ret-111 $array-inline-59)
                                                       )
                                                       (canon %init_peer_id% $array-inline-59  #array-inline-59-0)
                                                      )
                                                     )
                                                    )
                                                    (new $array-inline-60
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (ap "init_args_str" $array-inline-60)
                                                        (ap sp-0.$.init_args $array-inline-60)
                                                       )
                                                       (ap ret-112 $array-inline-60)
                                                      )
                                                      (canon %init_peer_id% $array-inline-60  #array-inline-60-0)
                                                     )
                                                    )
                                                   )
                                                   (ap sp-0.$.name $array-inline-57)
                                                  )
                                                  (ap "error retrieving from IPFS" $array-inline-57)
                                                 )
                                                 (ap #array-inline-58-0 $array-inline-57)
                                                )
                                                (ap #array-inline-59-0 $array-inline-57)
                                               )
                                               (ap #array-inline-60-0 $array-inline-57)
                                              )
                                              (canon %init_peer_id% $array-inline-57  #array-inline-57-0)
                                             )
                                            )
                                            (call %init_peer_id% ("debug" "stringify") [#array-inline-57-0] ret-127)
                                           )
                                           (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-128)
                                          )
                                          (par
                                           (call %init_peer_id% (ret-128 "store_log") [ret-127] ret-129)
                                           (seq
                                            (new $array-inline-61
                                             (seq
                                              (seq
                                               (ap ret-128 $array-inline-61)
                                               (ap #array-inline-57-0 $array-inline-61)
                                              )
                                              (canon %init_peer_id% $array-inline-61  #array-inline-61-0)
                                             )
                                            )
                                            (call %init_peer_id% ("run-console" "print") [#array-inline-61-0])
                                           )
                                          )
                                         )
                                        )
                                        (seq
                                         (seq
                                          (ap :error: -else-error-)
                                          (xor
                                           (match :error:.$.error_code 10001
                                            (ap -if-error- -if-else-error-)
                                           )
                                           (ap -else-error- -if-else-error-)
                                          )
                                         )
                                         (fail -if-else-error-)
                                        )
                                       )
                                      )
                                     )
                                    )
                                   )
                                  )
                                 )
                                )
                                (seq
                                 (seq
                                  (ap :error: -else-error-)
                                  (xor
                                   (match :error:.$.error_code 10001
                                    (ap -if-error- -if-else-error-)
                                   )
                                   (ap -else-error- -if-else-error-)
                                  )
                                 )
                                 (fail -if-else-error-)
                                )
                               )
                              )
                             )
                            )
                           )
                          )
                         )
                         (seq
                          (seq
                           (seq
                            (new $array-inline-62
                             (seq
                              (seq
                               (seq
                                (ap "Error deploy spell" $array-inline-62)
                                (ap sp-0.$.name $array-inline-62)
                               )
                               (ap :error: $array-inline-62)
                              )
                              (canon %init_peer_id% $array-inline-62  #array-inline-62-0)
                             )
                            )
                            (call %init_peer_id% ("debug" "stringify") [#array-inline-62-0] ret-130)
                           )
                           (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-131)
                          )
                          (par
                           (call %init_peer_id% (ret-131 "store_log") [ret-130] ret-132)
                           (seq
                            (new $array-inline-63
                             (seq
                              (seq
                               (ap ret-131 $array-inline-63)
                               (ap #array-inline-62-0 $array-inline-63)
                              )
                              (canon %init_peer_id% $array-inline-63  #array-inline-63-0)
                             )
                            )
                            (call %init_peer_id% ("run-console" "print") [#array-inline-63-0])
                           )
                          )
                         )
                        )
                       )
                       (seq
                        (seq
                         (seq
                          (new $array-inline-64
                           (seq
                            (seq
                             (seq
                              (ap "Error deploying spell" $array-inline-64)
                              (ap sp-0.$.name $array-inline-64)
                             )
                             (ap :error: $array-inline-64)
                            )
                            (canon %init_peer_id% $array-inline-64  #array-inline-64-0)
                           )
                          )
                          (call %init_peer_id% ("debug" "stringify") [#array-inline-64-0] ret-133)
                         )
                         (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-134)
                        )
                        (par
                         (call %init_peer_id% (ret-134 "store_log") [ret-133] ret-135)
                         (seq
                          (new $array-inline-65
                           (seq
                            (seq
                             (ap ret-134 $array-inline-65)
                             (ap #array-inline-64-0 $array-inline-65)
                            )
                            (canon %init_peer_id% $array-inline-65  #array-inline-65-0)
                           )
                          )
                          (call %init_peer_id% ("run-console" "print") [#array-inline-65-0])
                         )
                        )
                       )
                      )
                      (next sp-0)
                     )
                    )
                   )
                   (call %init_peer_id% ("debug" "stringify") ["Installation finished"] ret-136)
                  )
                  (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-137)
                 )
                 (par
                  (call %init_peer_id% (ret-137 "store_log") [ret-136] ret-138)
                  (seq
                   (new $array-inline-66
                    (seq
                     (seq
                      (ap ret-137 $array-inline-66)
                      (ap "Installation finished" $array-inline-66)
                     )
                     (canon %init_peer_id% $array-inline-66  #array-inline-66-0)
                    )
                   )
                   (call %init_peer_id% ("run-console" "print") [#array-inline-66-0])
                  )
                 )
                )
                (new $status-2
                 (seq
                  (seq
                   (seq
                    (call %init_peer_id% ("worker-spell" "list_get_strings") ["__installation_spell_status__"] ret-139)
                    (xor
                     (match ret-139.$.success true
                      (ap false not-0)
                     )
                     (ap true not-0)
                    )
                   )
                   (new -if-else-error-
                    (new -else-error-
                     (new -if-error-
                      (xor
                       (match not-0 true
                        (seq
                         (new %Status_obj-1_map
                          (seq
                           (seq
                            (seq
                             (ap ("message" ret-139.$.error) %Status_obj-1_map)
                             (ap ("state" "STATUS_LOAD_ERROR") %Status_obj-1_map)
                            )
                            (ap ("timestamp" 0) %Status_obj-1_map)
                           )
                           (canon %init_peer_id% %Status_obj-1_map  Status_obj-1)
                          )
                         )
                         (ap Status_obj-1 $status-2)
                        )
                       )
                       (seq
                        (ap :error: -if-error-)
                        (xor
                         (match :error:.$.error_code 10001
                          (seq
                           (seq
                            (seq
                             (ap ret-139.$.value ret-139_flat)
                             (ap ret-139_flat ret-139_flat_to_functor)
                            )
                            (ap ret-139_flat_to_functor.length ret-139_flat_length)
                           )
                           (new -if-else-error-
                            (new -else-error-
                             (new -if-error-
                              (xor
                               (match ret-139_flat_length 0
                                (seq
                                 (new %Status_obj-2_map
                                  (seq
                                   (seq
                                    (seq
                                     (ap ("message" "Installation has not started yet") %Status_obj-2_map)
                                     (ap ("state" "NOT_STARTED") %Status_obj-2_map)
                                    )
                                    (ap ("timestamp" 0) %Status_obj-2_map)
                                   )
                                   (canon %init_peer_id% %Status_obj-2_map  Status_obj-2)
                                  )
                                 )
                                 (ap Status_obj-2 $status-2)
                                )
                               )
                               (seq
                                (ap :error: -if-error-)
                                (xor
                                 (match :error:.$.error_code 10001
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (ap ret-139.$.value ret-139_flat-0)
                                       (ap ret-139_flat-0 ret-139_flat-0_to_functor)
                                      )
                                      (ap ret-139_flat-0_to_functor.length ret-139_flat-0_length)
                                     )
                                     (call %init_peer_id% ("math" "sub") [ret-139_flat-0_length 1] sub)
                                    )
                                    (call %init_peer_id% ("json" "parse") [ret-139.$.value.[sub]] ret-140)
                                   )
                                   (ap ret-140 $status-2)
                                  )
                                 )
                                 (seq
                                  (seq
                                   (ap :error: -else-error-)
                                   (xor
                                    (match :error:.$.error_code 10001
                                     (ap -if-error- -if-else-error-)
                                    )
                                    (ap -else-error- -if-else-error-)
                                   )
                                  )
                                  (fail -if-else-error-)
                                 )
                                )
                               )
                              )
                             )
                            )
                           )
                          )
                         )
                         (seq
                          (seq
                           (ap :error: -else-error-)
                           (xor
                            (match :error:.$.error_code 10001
                             (ap -if-error- -if-else-error-)
                            )
                            (ap -else-error- -if-else-error-)
                           )
                          )
                          (fail -if-else-error-)
                         )
                        )
                       )
                      )
                     )
                    )
                   )
                  )
                  (new $status-2_test
                   (seq
                    (seq
                     (fold $status-2 status-2_fold_var
                      (seq
                       (seq
                        (ap status-2_fold_var $status-2_test)
                        (canon %init_peer_id% $status-2_test  #status-2_iter_canon)
                       )
                       (xor
                        (match #status-2_iter_canon.length 1
                         (null)
                        )
                        (next status-2_fold_var)
                       )
                      )
                      (never)
                     )
                     (canon %init_peer_id% $status-2_test  #status-2_result_canon)
                    )
                    (ap #status-2_result_canon status-2_gate)
                   )
                  )
                 )
                )
               )
               (new -if-error-
                (xor
                 (match status-2_gate.$.[0].state "INSTALLATION_IN_PROGRESS"
                  (seq
                   (seq
                    (seq
                     (call %init_peer_id% ("peer" "timestamp_sec") [] ret-141)
                     (new %Status_obj-3_map
                      (seq
                       (seq
                        (seq
                         (ap ("message" "") %Status_obj-3_map)
                         (ap ("state" "INSTALLATION_SUCCESSFUL") %Status_obj-3_map)
                        )
                        (ap ("timestamp" ret-141) %Status_obj-3_map)
                       )
                       (canon %init_peer_id% %Status_obj-3_map  Status_obj-3)
                      )
                     )
                    )
                    (call %init_peer_id% ("json" "stringify") [Status_obj-3] ret-142)
                   )
                   (call %init_peer_id% ("worker-spell" "list_push_string") ["__installation_spell_status__" ret-142] ret-143)
                  )
                 )
                 (seq
                  (ap :error: -if-error-)
                  (xor
                   (match :error:.$.error_code 10001
                    (null)
                   )
                   (fail -if-error-)
                  )
                 )
                )
               )
              )
             )
             (seq
              (ap :error: -if-error-)
              (xor
               (match :error:.$.error_code 10001
                (seq
                 (seq
                  (seq
                   (seq
                    (seq
                     (seq
                      (seq
                       (seq
                        (new $array-inline-67
                         (seq
                          (seq
                           (seq
                            (seq
                             (ap "Error downloading worker definition from IPFS" $array-inline-67)
                             (ap -ipfs-arg- $array-inline-67)
                            )
                            (ap -worker_def_cid-arg- $array-inline-67)
                           )
                           (ap ret-2 $array-inline-67)
                          )
                          (canon %init_peer_id% $array-inline-67  #array-inline-67-0)
                         )
                        )
                        (call %init_peer_id% ("debug" "stringify") [#array-inline-67-0] ret-144)
                       )
                       (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-145)
                      )
                      (par
                       (call %init_peer_id% (ret-145 "store_log") [ret-144] ret-146)
                       (seq
                        (new $array-inline-68
                         (seq
                          (seq
                           (ap ret-145 $array-inline-68)
                           (ap #array-inline-67-0 $array-inline-68)
                          )
                          (canon %init_peer_id% $array-inline-68  #array-inline-68-0)
                         )
                        )
                        (call %init_peer_id% ("run-console" "print") [#array-inline-68-0])
                       )
                      )
                     )
                     (call %init_peer_id% ("debug" "stringify") [#array-inline-67-0] ret-147)
                    )
                    (call %init_peer_id% ("peer" "timestamp_sec") [] ret-148)
                   )
                   (new %Status_obj-4_map
                    (seq
                     (seq
                      (seq
                       (ap ("message" ret-147) %Status_obj-4_map)
                       (ap ("state" "INSTALLATION_FAILED") %Status_obj-4_map)
                      )
                      (ap ("timestamp" ret-148) %Status_obj-4_map)
                     )
                     (canon %init_peer_id% %Status_obj-4_map  Status_obj-4)
                    )
                   )
                  )
                  (call %init_peer_id% ("json" "stringify") [Status_obj-4] ret-149)
                 )
                 (call %init_peer_id% ("worker-spell" "list_push_string") ["__installation_spell_status__" ret-149] ret-150)
                )
               )
               (seq
                (seq
                 (ap :error: -else-error-)
                 (xor
                  (match :error:.$.error_code 10001
                   (ap -if-error- -if-else-error-)
                  )
                  (ap -else-error- -if-else-error-)
                 )
                )
                (fail -if-else-error-)
               )
              )
             )
            )
           )
          )
         )
        )
        (seq
         (seq
          (seq
           (seq
            (seq
             (seq
              (seq
               (seq
                (new $array-inline-69
                 (seq
                  (seq
                   (ap "Error installing worker" $array-inline-69)
                   (ap :error: $array-inline-69)
                  )
                  (canon %init_peer_id% $array-inline-69  #array-inline-69-0)
                 )
                )
                (call %init_peer_id% ("debug" "stringify") [#array-inline-69-0] ret-151)
               )
               (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-152)
              )
              (par
               (call %init_peer_id% (ret-152 "store_log") [ret-151] ret-153)
               (seq
                (new $array-inline-70
                 (seq
                  (seq
                   (ap ret-152 $array-inline-70)
                   (ap #array-inline-69-0 $array-inline-70)
                  )
                  (canon %init_peer_id% $array-inline-70  #array-inline-70-0)
                 )
                )
                (call %init_peer_id% ("run-console" "print") [#array-inline-70-0])
               )
              )
             )
             (call %init_peer_id% ("debug" "stringify") [#array-inline-69-0] ret-154)
            )
            (call %init_peer_id% ("peer" "timestamp_sec") [] ret-155)
           )
           (new %Status_obj-5_map
            (seq
             (seq
              (seq
               (ap ("message" ret-154) %Status_obj-5_map)
               (ap ("state" "INSTALLATION_FAILED") %Status_obj-5_map)
              )
              (ap ("timestamp" ret-155) %Status_obj-5_map)
             )
             (canon %init_peer_id% %Status_obj-5_map  Status_obj-5)
            )
           )
          )
          (call %init_peer_id% ("json" "stringify") [Status_obj-5] ret-156)
         )
         (call %init_peer_id% ("worker-spell" "list_push_string") ["__installation_spell_status__" ret-156] ret-157)
        )
       )
      )
      (new $status-6
       (seq
        (seq
         (seq
          (call %init_peer_id% ("worker-spell" "list_get_strings") ["__installation_spell_status__"] ret-158)
          (xor
           (match ret-158.$.success true
            (ap false not-1)
           )
           (ap true not-1)
          )
         )
         (new -if-else-error-
          (new -else-error-
           (new -if-error-
            (xor
             (match not-1 true
              (seq
               (new %Status_obj-6_map
                (seq
                 (seq
                  (seq
                   (ap ("message" ret-158.$.error) %Status_obj-6_map)
                   (ap ("state" "STATUS_LOAD_ERROR") %Status_obj-6_map)
                  )
                  (ap ("timestamp" 0) %Status_obj-6_map)
                 )
                 (canon %init_peer_id% %Status_obj-6_map  Status_obj-6)
                )
               )
               (ap Status_obj-6 $status-6)
              )
             )
             (seq
              (ap :error: -if-error-)
              (xor
               (match :error:.$.error_code 10001
                (seq
                 (seq
                  (seq
                   (ap ret-158.$.value ret-158_flat)
                   (ap ret-158_flat ret-158_flat_to_functor)
                  )
                  (ap ret-158_flat_to_functor.length ret-158_flat_length)
                 )
                 (new -if-else-error-
                  (new -else-error-
                   (new -if-error-
                    (xor
                     (match ret-158_flat_length 0
                      (seq
                       (new %Status_obj-7_map
                        (seq
                         (seq
                          (seq
                           (ap ("message" "Installation has not started yet") %Status_obj-7_map)
                           (ap ("state" "NOT_STARTED") %Status_obj-7_map)
                          )
                          (ap ("timestamp" 0) %Status_obj-7_map)
                         )
                         (canon %init_peer_id% %Status_obj-7_map  Status_obj-7)
                        )
                       )
                       (ap Status_obj-7 $status-6)
                      )
                     )
                     (seq
                      (ap :error: -if-error-)
                      (xor
                       (match :error:.$.error_code 10001
                        (seq
                         (seq
                          (seq
                           (seq
                            (seq
                             (ap ret-158.$.value ret-158_flat-0)
                             (ap ret-158_flat-0 ret-158_flat-0_to_functor)
                            )
                            (ap ret-158_flat-0_to_functor.length ret-158_flat-0_length)
                           )
                           (call %init_peer_id% ("math" "sub") [ret-158_flat-0_length 1] sub-0)
                          )
                          (call %init_peer_id% ("json" "parse") [ret-158.$.value.[sub-0]] ret-159)
                         )
                         (ap ret-159 $status-6)
                        )
                       )
                       (seq
                        (seq
                         (ap :error: -else-error-)
                         (xor
                          (match :error:.$.error_code 10001
                           (ap -if-error- -if-else-error-)
                          )
                          (ap -else-error- -if-else-error-)
                         )
                        )
                        (fail -if-else-error-)
                       )
                      )
                     )
                    )
                   )
                  )
                 )
                )
               )
               (seq
                (seq
                 (ap :error: -else-error-)
                 (xor
                  (match :error:.$.error_code 10001
                   (ap -if-error- -if-else-error-)
                  )
                  (ap -else-error- -if-else-error-)
                 )
                )
                (fail -if-else-error-)
               )
              )
             )
            )
           )
          )
         )
        )
        (new $status-6_test
         (seq
          (seq
           (fold $status-6 status-6_fold_var
            (seq
             (seq
              (ap status-6_fold_var $status-6_test)
              (canon %init_peer_id% $status-6_test  #status-6_iter_canon)
             )
             (xor
              (match #status-6_iter_canon.length 1
               (null)
              )
              (next status-6_fold_var)
             )
            )
            (never)
           )
           (canon %init_peer_id% $status-6_test  #status-6_result_canon)
          )
          (ap #status-6_result_canon status-6_gate)
         )
        )
       )
      )
     )
     (new $array-inline-71
      (seq
       (seq
        (ap "Worker installation finished with status" $array-inline-71)
        (ap status-6_gate.$.[0] $array-inline-71)
       )
       (canon %init_peer_id% $array-inline-71  #array-inline-71-0)
      )
     )
    )
    (call %init_peer_id% ("debug" "stringify") [#array-inline-71-0] ret-160)
   )
   (call %init_peer_id% ("srv" "resolve_alias") ["spell"] ret-161)
  (par
   (call %init_peer_id% (ret-161 "store_log") [ret-160] ret-162)
   (seq
    (new $array-inline-72
     (seq
      (seq
       (ap ret-161 $array-inline-72)
       (ap #array-inline-71-0 $array-inline-72)
      )
      (canon %init_peer_id% $array-inline-72  #array-inline-72-0)
     )
    )
    (call %init_peer_id% ("run-console" "print") [#array-inline-72-0])
   )
 (call %init_peer_id% ("errorHandlingSrv" "error") [:error: 0])
/home/ubuntu/.cargo/registry/src/index.crates.io-6f17d22bba15001f/decider-distro-0.5.9/src/lib.rsworker_settingsfrom_blockchainapi_endpointworkers_gaswallet_keynetwork_id(xor
 (seq
  (seq
   (seq
    (seq
     (seq
      (call %init_peer_id% ("getDataSrv" "-relay-") [] -relay-)
      (call %init_peer_id% ("getDataSrv" "spell_id") [] -spell_id-arg-)
     )
     (call %init_peer_id% ("getDataSrv" "chain") [] -chain-arg-)
    )
    (call %init_peer_id% ("getDataSrv" "worker_settings") [] -worker_settings-arg-)
   )
   (new $latest
    (seq
     (seq
      (seq
       (call %init_peer_id% ("chain_connector" "latest_block_number") [-chain-arg-.$.api_endpoint] ret)
       (new -if-else-error-
        (new -else-error-
         (new -if-error-
          (xor
           (match ret.$.success true
            (ap ret.$.number_hex $latest)
           )
           (seq
            (ap :error: -if-error-)
            (xor
             (match :error:.$.error_code 10001
              (seq
               (seq
                (seq
                 (new $array-inline
                  (seq
                   (seq
                    (ap "error retrieving latest block number" $array-inline)
                    (ap ret.$.error $array-inline)
                   )
                   (canon %init_peer_id% $array-inline  #array-inline-0)
                  )
                 )
                 (par
                  (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-0])
                  (null)
                 )
                )
                (call %init_peer_id% ("json" "stringify") [#array-inline-0] ret-0)
               )
               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-0] ret-1)
              )
             )
             (seq
              (seq
               (ap :error: -else-error-)
               (xor
                (match :error:.$.error_code 10001
                 (ap -if-error- -if-else-error-)
                )
                (ap -else-error- -if-else-error-)
               )
              )
              (fail -if-else-error-)
             )
            )
           )
          )
         )
        )
       )
      )
      (canon %init_peer_id% $latest  #-latest-fix-0)
     )
     (ap #-latest-fix-0 -latest-flat-0)
    )
   )
  (new -if-error-
   (xor
    (mismatch -latest-flat-0 []
     (seq
      (seq
       (seq
        (seq
         (seq
          (seq
           (seq
            (new $joined_deals-0
             (seq
              (seq
               (seq
                (seq
                 (call %init_peer_id% (-spell_id-arg- "list_get_strings") ["joined_deals"] ret-2)
                 (xor
                  (match ret-2.$.success true
                   (ap false not)
                  )
                  (ap true not)
                 )
                )
                (new -if-else-error-
                 (new -else-error-
                  (new -if-error-
                   (xor
                    (match not true
                     (seq
                      (seq
                       (seq
                        (new $array-inline-1
                         (seq
                          (seq
                           (ap "can't restrive joined deals" $array-inline-1)
                           (ap ret-2.$.error $array-inline-1)
                          )
                          (canon %init_peer_id% $array-inline-1  #array-inline-1-0)
                         )
                        )
                        (par
                         (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-1-0])
                         (null)
                        )
                       )
                       (call %init_peer_id% ("json" "stringify") [#array-inline-1-0] ret-3)
                      )
                      (call %init_peer_id% (-spell_id-arg- "store_log") [ret-3] ret-4)
                     )
                    )
                    (seq
                     (ap :error: -if-error-)
                     (xor
                      (match :error:.$.error_code 10001
                       (fold ret-2.$.value joined_deal_str-0
                        (seq
                         (xor
                          (seq
                           (call %init_peer_id% ("json" "parse") [joined_deal_str-0] ret-5)
                           (ap ret-5 $joined_deals-0)
                          )
                          (seq
                           (seq
                            (seq
                             (new $array-inline-2
                              (seq
                               (seq
                                (seq
                                 (ap "error parsing JoinedDeal" $array-inline-2)
                                 (ap joined_deal_str-0 $array-inline-2)
                                )
                                (ap :error: $array-inline-2)
                               )
                               (canon %init_peer_id% $array-inline-2  #array-inline-2-0)
                              )
                             )
                             (par
                              (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-2-0])
                              (null)
                             )
                            )
                            (call %init_peer_id% ("json" "stringify") [#array-inline-2-0] ret-6)
                           )
                           (call %init_peer_id% (-spell_id-arg- "store_log") [ret-6] ret-7)
                          )
                         )
                         (next joined_deal_str-0)
                        )
                       )
                      )
                      (seq
                       (seq
                        (ap :error: -else-error-)
                        (xor
                         (match :error:.$.error_code 10001
                          (ap -if-error- -if-else-error-)
                         )
                         (ap -else-error- -if-else-error-)
                        )
                       )
                       (fail -if-else-error-)
                      )
                     )
                    )
                   )
                  )
                 )
                )
               )
               (canon %init_peer_id% $joined_deals-0  #-joined_deals-fix-0)
              )
              (ap #-joined_deals-fix-0 -joined_deals-flat-0)
             )
            )
            (xor
             (seq
              (new $left-0
               (seq
                (seq
                 (seq
                  (seq
                   (seq
                    (seq
                     (seq
                      (seq
                       (seq
                        (seq
                         (seq
                          (new $result
                           (seq
                            (seq
                             (seq
                              (seq
                               (call %init_peer_id% (-spell_id-arg- "get_string") ["last_seen_block"] ret-8)
                               (xor
                                (match ret-8.$.success true
                                 (ap false not-0)
                                )
                                (ap true not-0)
                               )
                              )
                              (new -if-else-error-
                               (new -else-error-
                                (new -if-error-
                                 (xor
                                  (match not-0 true
                                   (seq
                                    (seq
                                     (seq
                                      (new $array-inline-3
                                       (seq
                                        (seq
                                         (seq
                                          (ap "get_string failed" $array-inline-3)
                                          (ap "last_seen_block" $array-inline-3)
                                         )
                                         (ap ret-8.$.error $array-inline-3)
                                        )
                                        (canon %init_peer_id% $array-inline-3  #array-inline-3-0)
                                       )
                                      )
                                      (par
                                       (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-3-0])
                                       (null)
                                      )
                                     )
                                     (call %init_peer_id% ("json" "stringify") [#array-inline-3-0] ret-9)
                                    )
                                    (call %init_peer_id% (-spell_id-arg- "store_log") [ret-9] ret-10)
                                   )
                                  )
                                  (seq
                                   (ap :error: -if-error-)
                                   (xor
                                    (match :error:.$.error_code 10001
                                     (seq
                                      (xor
                                       (match ret-8.$.absent true
                                        (ap false not-1)
                                       )
                                       (ap true not-1)
                                      )
                                      (new -if-error-
                                       (xor
                                        (match not-1 true
                                         (ap ret-8.$.value $result)
                                        )
                                        (seq
                                         (ap :error: -if-error-)
                                         (xor
                                          (match :error:.$.error_code 10001
                                           (null)
                                          )
                                          (fail -if-error-)
                                         )
                                        )
                                       )
                                      )
                                     )
                                    )
                                    (seq
                                     (seq
                                      (ap :error: -else-error-)
                                      (xor
                                       (match :error:.$.error_code 10001
                                        (ap -if-error- -if-else-error-)
                                       )
                                       (ap -else-error- -if-else-error-)
                                      )
                                     )
                                     (fail -if-else-error-)
                                    )
                                   )
                                  )
                                 )
                                )
                               )
                              )
                             )
                             (canon %init_peer_id% $result  #-result-fix-0)
                            )
                            (ap #-result-fix-0 -result-flat-0)
                           )
                          )
                          (new $array-inline-4
                           (seq
                            (seq
                             (ap "maybe_last_seen is" $array-inline-4)
                             (ap -result-flat-0 $array-inline-4)
                            )
                            (canon %init_peer_id% $array-inline-4  #array-inline-4-0)
                           )
                          )
                         )
                         (par
                          (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-4-0])
                          (null)
                         )
                        )
                        (call %init_peer_id% ("json" "stringify") [#array-inline-4-0] ret-11)
                       )
                       (call %init_peer_id% (-spell_id-arg- "store_log") [ret-11] ret-12)
                      )
                      (new -if-else-error-
                       (new -else-error-
                        (new -if-error-
                         (xor
                          (match -result-flat-0 []
                           (seq
                            (seq
                             (seq
                              (seq
                               (seq
                                (seq
                                 (new $left-1
                                  (seq
                                   (seq
                                    (seq
                                     (new $from_block-1
                                      (seq
                                       (seq
                                        (new $result-0
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (call %init_peer_id% (-spell_id-arg- "get_string") ["from_block"] ret-13)
                                             (xor
                                              (match ret-13.$.success true
                                               (ap false not-2)
                                              )
                                              (ap true not-2)
                                             )
                                            )
                                            (new -if-else-error-
                                             (new -else-error-
                                              (new -if-error-
                                               (xor
                                                (match not-2 true
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (new $array-inline-5
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (ap "get_string failed" $array-inline-5)
                                                        (ap "from_block" $array-inline-5)
                                                       )
                                                       (ap ret-13.$.error $array-inline-5)
                                                      )
                                                      (canon %init_peer_id% $array-inline-5  #array-inline-5-0)
                                                     )
                                                    )
                                                    (par
                                                     (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-5-0])
                                                     (null)
                                                    )
                                                   )
                                                   (call %init_peer_id% ("json" "stringify") [#array-inline-5-0] ret-14)
                                                  )
                                                  (call %init_peer_id% (-spell_id-arg- "store_log") [ret-14] ret-15)
                                                 )
                                                )
                                                (seq
                                                 (ap :error: -if-error-)
                                                 (xor
                                                  (match :error:.$.error_code 10001
                                                   (seq
                                                    (xor
                                                     (match ret-13.$.absent true
                                                      (ap false not-3)
                                                     )
                                                     (ap true not-3)
                                                    )
                                                    (new -if-error-
                                                     (xor
                                                      (match not-3 true
                                                       (ap ret-13.$.value $result-0)
                                                      )
                                                      (seq
                                                       (ap :error: -if-error-)
                                                       (xor
                                                        (match :error:.$.error_code 10001
                                                         (null)
                                                        )
                                                        (fail -if-error-)
                                                       )
                                                      )
                                                     )
                                                    )
                                                   )
                                                  )
                                                  (seq
                                                   (seq
                                                    (ap :error: -else-error-)
                                                    (xor
                                                     (match :error:.$.error_code 10001
                                                      (ap -if-error- -if-else-error-)
                                                     )
                                                     (ap -else-error- -if-else-error-)
                                                    )
                                                   )
                                                   (fail -if-else-error-)
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                           (canon %init_peer_id% $result-0  #-result-fix-0-0)
                                          )
                                          (ap #-result-fix-0-0 -result-flat-0-0)
                                         )
                                        )
                                        (new -if-else-error-
                                         (new -else-error-
                                          (new -if-error-
                                           (xor
                                            (match -result-flat-0-0 []
                                             (ap "latest" $from_block-1)
                                            )
                                            (seq
                                             (ap :error: -if-error-)
                                             (xor
                                              (match :error:.$.error_code 10001
                                               (seq
                                                (call %init_peer_id% ("json" "parse") [-result-flat-0-0.$.[0]] ret-16)
                                                (ap ret-16 $from_block-1)
                                               )
                                              )
                                              (seq
                                               (seq
                                                (ap :error: -else-error-)
                                                (xor
                                                 (match :error:.$.error_code 10001
                                                  (ap -if-error- -if-else-error-)
                                                 )
                                                 (ap -else-error- -if-else-error-)
                                                )
                                               )
                                               (fail -if-else-error-)
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                       (new $from_block-1_test
                                        (seq
                                         (seq
                                          (fold $from_block-1 from_block-1_fold_var
                                           (seq
                                            (seq
                                             (ap from_block-1_fold_var $from_block-1_test)
                                             (canon %init_peer_id% $from_block-1_test  #from_block-1_iter_canon)
                                            )
                                            (xor
                                             (match #from_block-1_iter_canon.length 1
                                              (null)
                                             )
                                             (next from_block-1_fold_var)
                                            )
                                           )
                                           (never)
                                          )
                                          (canon %init_peer_id% $from_block-1_test  #from_block-1_result_canon)
                                         )
                                         (ap #from_block-1_result_canon from_block-1_gate)
                                        )
                                       )
                                      )
                                     )
                                     (new -if-else-error-
                                      (new -else-error-
                                       (new -if-error-
                                        (xor
                                         (match from_block-1_gate.$.[0] "latest"
                                          (seq
                                           (new $latest-1
                                            (seq
                                             (seq
                                              (seq
                                               (call %init_peer_id% ("chain_connector" "latest_block_number") [-chain-arg-.$.api_endpoint] ret-17)
                                               (new -if-else-error-
                                                (new -else-error-
                                                 (new -if-error-
                                                  (xor
                                                   (match ret-17.$.success true
                                                    (ap ret-17.$.number_hex $latest-1)
                                                   )
                                                   (seq
                                                    (ap :error: -if-error-)
                                                    (xor
                                                     (match :error:.$.error_code 10001
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (new $array-inline-6
                                                          (seq
                                                           (seq
                                                            (ap "error retrieving latest block number" $array-inline-6)
                                                            (ap ret-17.$.error $array-inline-6)
                                                           )
                                                           (canon %init_peer_id% $array-inline-6  #array-inline-6-0)
                                                          )
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-6-0])
                                                          (null)
                                                         )
                                                        )
                                                        (call %init_peer_id% ("json" "stringify") [#array-inline-6-0] ret-18)
                                                       )
                                                       (call %init_peer_id% (-spell_id-arg- "store_log") [ret-18] ret-19)
                                                      )
                                                     )
                                                     (seq
                                                      (seq
                                                       (ap :error: -else-error-)
                                                       (xor
                                                        (match :error:.$.error_code 10001
                                                         (ap -if-error- -if-else-error-)
                                                        )
                                                        (ap -else-error- -if-else-error-)
                                                       )
                                                      )
                                                      (fail -if-else-error-)
                                                     )
                                                    )
                                                   )
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                              (canon %init_peer_id% $latest-1  #-latest-fix-0-0)
                                             )
                                             (ap #-latest-fix-0-0 -latest-flat-0-0)
                                            )
                                           )
                                           (new -if-error-
                                            (xor
                                             (mismatch -latest-flat-0-0 []
                                              (ap -latest-flat-0-0.$.[0] $left-1)
                                             )
                                             (seq
                                              (ap :error: -if-error-)
                                              (xor
                                               (match :error:.$.error_code 10002
                                                (null)
                                               )
                                               (fail -if-error-)
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                         (seq
                                          (ap :error: -if-error-)
                                          (xor
                                           (match :error:.$.error_code 10001
                                            (new -if-else-error-
                                             (new -else-error-
                                              (new -if-error-
                                               (xor
                                                (match from_block-1_gate.$.[0] "earliest"
                                                 (ap "0x0" $left-1)
                                                )
                                                (seq
                                                 (ap :error: -if-error-)
                                                 (xor
                                                  (match :error:.$.error_code 10001
                                                   (ap from_block-1_gate.$.[0] $left-1)
                                                  )
                                                  (seq
                                                   (seq
                                                    (ap :error: -else-error-)
                                                    (xor
                                                     (match :error:.$.error_code 10001
                                                      (ap -if-error- -if-else-error-)
                                                     )
                                                     (ap -else-error- -if-else-error-)
                                                    )
                                                   )
                                                   (fail -if-else-error-)
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                           (seq
                                            (seq
                                             (ap :error: -else-error-)
                                             (xor
                                              (match :error:.$.error_code 10001
                                               (ap -if-error- -if-else-error-)
                                              )
                                              (ap -else-error- -if-else-error-)
                                             )
                                            )
                                            (fail -if-else-error-)
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                     )
                                    )
                                    (canon %init_peer_id% $left-1  #-left-fix-0-0)
                                   )
                                   (ap #-left-fix-0-0 -left-flat-0-0)
                                  )
                                 )
                                 (new $array-inline-7
                                  (seq
                                   (seq
                                    (ap "init: will set last seen to" $array-inline-7)
                                    (ap -left-flat-0-0 $array-inline-7)
                                   )
                                   (canon %init_peer_id% $array-inline-7  #array-inline-7-0)
                                  )
                                 )
                                )
                                (par
                                 (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-7-0])
                                 (null)
                                )
                               )
                               (call %init_peer_id% ("json" "stringify") [#array-inline-7-0] ret-20)
                              )
                              (call %init_peer_id% (-spell_id-arg- "store_log") [ret-20] ret-21)
                             )
                             (new -if-error-
                              (xor
                               (mismatch -left-flat-0-0 []
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (new $array-inline-8
                                     (seq
                                      (seq
                                       (ap "will set last seen to" $array-inline-8)
                                       (ap -left-flat-0-0.$.[0] $array-inline-8)
                                      )
                                      (canon %init_peer_id% $array-inline-8  #array-inline-8-0)
                                     )
                                    )
                                    (par
                                     (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-8-0])
                                     (null)
                                    )
                                   )
                                   (call %init_peer_id% ("json" "stringify") [#array-inline-8-0] ret-22)
                                  )
                                  (call %init_peer_id% (-spell_id-arg- "store_log") [ret-22] ret-23)
                                 )
                                 (xor
                                  (seq
                                   (call %init_peer_id% (-spell_id-arg- "set_string") ["last_seen_block" -left-flat-0-0.$.[0]] ret-24)
                                   (new -if-else-error-
                                    (new -else-error-
                                     (new -if-error-
                                      (xor
                                       (match ret-24.$.success true
                                        (seq
                                         (seq
                                          (seq
                                           (new $array-inline-9
                                            (seq
                                             (seq
                                              (ap "saved last seen" $array-inline-9)
                                              (ap -left-flat-0-0.$.[0] $array-inline-9)
                                             )
                                             (canon %init_peer_id% $array-inline-9  #array-inline-9-0)
                                            )
                                           )
                                           (par
                                            (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-9-0])
                                            (null)
                                           )
                                          )
                                          (call %init_peer_id% ("json" "stringify") [#array-inline-9-0] ret-25)
                                         )
                                         (call %init_peer_id% (-spell_id-arg- "store_log") [ret-25] ret-26)
                                        )
                                       )
                                       (seq
                                        (ap :error: -if-error-)
                                        (xor
                                         (match :error:.$.error_code 10001
                                          (seq
                                           (seq
                                            (seq
                                             (new $array-inline-10
                                              (seq
                                               (seq
                                                (ap "error saving last_seen_block" $array-inline-10)
                                                (ap ret-24.$.error $array-inline-10)
                                               )
                                               (canon %init_peer_id% $array-inline-10  #array-inline-10-0)
                                              )
                                             )
                                             (par
                                              (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-10-0])
                                              (null)
                                             )
                                            )
                                            (call %init_peer_id% ("json" "stringify") [#array-inline-10-0] ret-27)
                                           )
                                           (call %init_peer_id% (-spell_id-arg- "store_log") [ret-27] ret-28)
                                          )
                                         )
                                         (seq
                                          (seq
                                           (ap :error: -else-error-)
                                           (xor
                                            (match :error:.$.error_code 10001
                                             (ap -if-error- -if-else-error-)
                                            )
                                            (ap -else-error- -if-else-error-)
                                           )
                                          )
                                          (fail -if-else-error-)
                                         )
                                        )
                                       )
                                      )
                                     )
                                    )
                                   )
                                  )
                                  (seq
                                   (seq
                                    (seq
                                     (new $array-inline-11
                                      (seq
                                       (seq
                                        (ap "error saving last_seen_block" $array-inline-11)
                                        (ap :error: $array-inline-11)
                                       )
                                       (canon %init_peer_id% $array-inline-11  #array-inline-11-0)
                                      )
                                     )
                                     (par
                                      (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-11-0])
                                      (null)
                                     )
                                    )
                                    (call %init_peer_id% ("json" "stringify") [#array-inline-11-0] ret-29)
                                   )
                                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-29] ret-30)
                                  )
                                 )
                                )
                               )
                               (seq
                                (ap :error: -if-error-)
                                (xor
                                 (match :error:.$.error_code 10002
                                  (null)
                                 )
                                 (fail -if-error-)
                                )
                               )
                              )
                             )
                            )
                            (new -if-error-
                             (xor
                              (mismatch -left-flat-0-0 []
                               (ap -left-flat-0-0.$.[0] $left-0)
                              )
                              (seq
                               (ap :error: -if-error-)
                               (xor
                                (match :error:.$.error_code 10002
                                 (null)
                                )
                                (fail -if-error-)
                               )
                              )
                             )
                            )
                           )
                          )
                          (seq
                           (ap :error: -if-error-)
                           (xor
                            (match :error:.$.error_code 10001
                             (seq
                              (seq
                               (seq
                                (seq
                                 (call %init_peer_id% ("chain_connector" "hex_add") [-result-flat-0.$.[0] 1] ret-31)
                                 (xor
                                  (match ret-31.$.success true
                                   (ap false not-4)
                                  )
                                  (ap true not-4)
                                 )
                                )
                                (new -if-error-
                                 (xor
                                  (match not-4 true
                                   (seq
                                    (seq
                                     (seq
                                      (new $array-inline-12
                                       (seq
                                        (seq
                                         (seq
                                          (ap "hex_add failed" $array-inline-12)
                                          (ap -result-flat-0.$.[0] $array-inline-12)
                                         )
                                         (ap 1 $array-inline-12)
                                        )
                                        (canon %init_peer_id% $array-inline-12  #array-inline-12-0)
                                       )
                                      )
                                      (par
                                       (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-12-0])
                                       (null)
                                      )
                                     )
                                     (call %init_peer_id% ("json" "stringify") [#array-inline-12-0] ret-32)
                                    )
                                    (call %init_peer_id% (-spell_id-arg- "store_log") [ret-32] ret-33)
                                   )
                                  )
                                  (seq
                                   (ap :error: -if-error-)
                                   (xor
                                    (match :error:.$.error_code 10001
                                     (null)
                                    )
                                    (fail -if-error-)
                                   )
                                  )
                                 )
                                )
                               )
                               (ap ret-31.$.hex ret-31_flat)
                              )
                              (new -if-else-error-
                               (new -else-error-
                                (new -if-error-
                                 (xor
                                  (mismatch ret-31_flat []
                                   (ap ret-31_flat.$.[0] $left-0)
                                  )
                                  (seq
                                   (ap :error: -if-error-)
                                   (xor
                                    (match :error:.$.error_code 10002
                                     (ap -result-flat-0.$.[0] $left-0)
                                    )
                                    (seq
                                     (seq
                                      (ap :error: -else-error-)
                                      (xor
                                       (match :error:.$.error_code 10001
                                        (ap -if-error- -if-else-error-)
                                       )
                                       (ap -else-error- -if-else-error-)
                                      )
                                     )
                                     (fail -if-else-error-)
                                    )
                                   )
                                  )
                                 )
                                )
                               )
                              )
                             )
                            )
                            (seq
                             (seq
                              (ap :error: -else-error-)
                              (xor
                               (match :error:.$.error_code 10001
                                (ap -if-error- -if-else-error-)
                               )
                               (ap -else-error- -if-else-error-)
                              )
                             )
                             (fail -if-else-error-)
                            )
                           )
                          )
                         )
                        )
                       )
                      )
                     )
                     (new $array-inline-13
                      (seq
                       (seq
                        (seq
                         (ap "left boundary will be" $array-inline-13)
                         (canon %init_peer_id% $left-0  #push-to-stream-521)
                        )
                        (ap #push-to-stream-521 $array-inline-13)
                       )
                       (canon %init_peer_id% $array-inline-13  #array-inline-13-0)
                      )
                     )
                    )
                    (par
                     (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-13-0])
                     (null)
                    )
                   )
                   (call %init_peer_id% ("json" "stringify") [#array-inline-13-0] ret-34)
                  )
                  (call %init_peer_id% (-spell_id-arg- "store_log") [ret-34] ret-35)
                 )
                 (canon %init_peer_id% $left-0  #-left-fix-0)
                )
                (ap #-left-fix-0 -left-flat-0)
               )
              )
              (new -if-else-error-
               (new -else-error-
                (new -if-error-
                 (xor
                  (mismatch -left-flat-0 []
                   (seq
                    (new $poll-0
                     (seq
                      (seq
                       (seq
                        (seq
                         (call %init_peer_id% ("chain_connector" "poll_deal_matches") [-chain-arg- -left-flat-0.$.[0]] ret-36)
                         (xor
                          (match ret-36.$.success true
                           (ap false not-5)
                          )
                          (ap true not-5)
                         )
                        )
                        (new -if-else-error-
                         (new -else-error-
                          (new -if-error-
                           (xor
                            (match not-5 true
                             (seq
                              (seq
                               (seq
                                (new $array-inline-14
                                 (seq
                                  (seq
                                   (ap "error polling deal created events" $array-inline-14)
                                   (ap ret-36.$.error $array-inline-14)
                                  )
                                  (canon %init_peer_id% $array-inline-14  #array-inline-14-0)
                                 )
                                )
                                (par
                                 (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-14-0])
                                 (null)
                                )
                               )
                               (call %init_peer_id% ("json" "stringify") [#array-inline-14-0] ret-37)
                              )
                              (call %init_peer_id% (-spell_id-arg- "store_log") [ret-37] ret-38)
                             )
                            )
                            (seq
                             (ap :error: -if-error-)
                             (xor
                              (match :error:.$.error_code 10001
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (ap ret-36.$.logs ret-36_flat)
                                     (new $array-inline-15
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (ap ret-36_flat ret-36_flat_to_functor)
                                            (ap ret-36_flat_to_functor.length ret-36_flat_length)
                                           )
                                           (ap "new deals from poll:" $array-inline-15)
                                          )
                                          (ap ret-36_flat_length $array-inline-15)
                                         )
                                         (ap "from block:" $array-inline-15)
                                        )
                                        (ap -left-flat-0.$.[0] $array-inline-15)
                                       )
                                       (canon %init_peer_id% $array-inline-15  #array-inline-15-0)
                                      )
                                     )
                                    )
                                    (par
                                     (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-15-0])
                                     (null)
                                    )
                                   )
                                   (call %init_peer_id% ("json" "stringify") [#array-inline-15-0] ret-39)
                                  )
                                  (call %init_peer_id% (-spell_id-arg- "store_log") [ret-39] ret-40)
                                 )
                                 (new %Poll_obj_map
                                  (seq
                                   (seq
                                    (ap ("logs" ret-36_flat) %Poll_obj_map)
                                    (ap ("right_boundary" ret-36.$.right_boundary) %Poll_obj_map)
                                   )
                                   (canon %init_peer_id% %Poll_obj_map  Poll_obj)
                                  )
                                 )
                                )
                                (ap Poll_obj $poll-0)
                               )
                              )
                              (seq
                               (seq
                                (ap :error: -else-error-)
                                (xor
                                 (match :error:.$.error_code 10001
                                  (ap -if-error- -if-else-error-)
                                 )
                                 (ap -else-error- -if-else-error-)
                                )
                               )
                               (fail -if-else-error-)
                              )
                             )
                            )
                           )
                          )
                         )
                        )
                       )
                       (canon %init_peer_id% $poll-0  #-poll-fix-0)
                      )
                      (ap #-poll-fix-0 -poll-flat-0)
                     )
                    )
                    (new -if-error-
                     (xor
                      (mismatch -poll-flat-0 []
                       (seq
                        (seq
                         (seq
                          (seq
                           (seq
                            (seq
                             (seq
                              (seq
                               (seq
                                (seq
                                 (new $new
                                  (seq
                                   (seq
                                    (fold -poll-flat-0.$.[0].logs match-0
                                     (seq
                                      (new $joined
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (ap match-0.$.info match-0_flat)
                                            (ap match-0_flat.$.deal_id match-0_flat_flat)
                                           )
                                           (new $created
                                            (seq
                                             (seq
                                              (call %init_peer_id% ("worker" "get_worker_id") [match-0_flat_flat] ret-41)
                                              (new -if-else-error-
                                               (new -else-error-
                                                (new -if-error-
                                                 (xor
                                                  (mismatch ret-41 []
                                                   (ap true $created)
                                                  )
                                                  (seq
                                                   (ap :error: -if-error-)
                                                   (xor
                                                    (match :error:.$.error_code 10002
                                                     (ap false $created)
                                                    )
                                                    (seq
                                                     (seq
                                                      (ap :error: -else-error-)
                                                      (xor
                                                       (match :error:.$.error_code 10001
                                                        (ap -if-error- -if-else-error-)
                                                       )
                                                       (ap -else-error- -if-else-error-)
                                                      )
                                                     )
                                                     (fail -if-else-error-)
                                                    )
                                                   )
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                             )
                                             (new $created_test
                                              (seq
                                               (seq
                                                (fold $created created_fold_var
                                                 (seq
                                                  (seq
                                                   (ap created_fold_var $created_test)
                                                   (canon %init_peer_id% $created_test  #created_iter_canon)
                                                  )
                                                  (xor
                                                   (match #created_iter_canon.length 1
                                                    (null)
                                                   )
                                                   (next created_fold_var)
                                                  )
                                                 )
                                                 (never)
                                                )
                                                (canon %init_peer_id% $created_test  #created_result_canon)
                                               )
                                               (ap #created_result_canon created_gate)
                                              )
                                             )
                                            )
                                           )
                                          )
                                          (new -if-error-
                                           (xor
                                            (match created_gate.$.[0] true
                                             (fold -joined_deals-flat-0 deal-0
                                              (seq
                                               (new -if-error-
                                                (xor
                                                 (match match-0_flat_flat deal-0.$.deal_id
                                                  (ap true $joined)
                                                 )
                                                 (seq
                                                  (ap :error: -if-error-)
                                                  (xor
                                                   (match :error:.$.error_code 10001
                                                    (null)
                                                   )
                                                   (fail -if-error-)
                                                  )
                                                 )
                                                )
                                               )
                                               (next deal-0)
                                              )
                                             )
                                            )
                                            (seq
                                             (ap :error: -if-error-)
                                             (xor
                                              (match :error:.$.error_code 10001
                                               (null)
                                              )
                                              (fail -if-error-)
                                             )
                                            )
                                           )
                                          )
                                         )
                                         (canon %init_peer_id% $joined  #joined_canon)
                                        )
                                        (new -if-else-error-
                                         (new -else-error-
                                          (new -if-error-
                                           (xor
                                            (match #joined_canon []
                                             (ap match-0 $new)
                                            )
                                            (seq
                                             (ap :error: -if-error-)
                                             (xor
                                              (match :error:.$.error_code 10001
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" match-0_flat_flat ": "] ret-42)
                                                   (par
                                                    (call %init_peer_id% ("run-console" "print") [ret-42 "deal is already joined"])
                                                    (null)
                                                   )
                                                  )
                                                  (call %init_peer_id% ("json" "stringify") ["deal is already joined"] ret-43)
                                                 )
                                                 (call %init_peer_id% ("op" "concat_strings") [ret-42 ret-43] ret-44)
                                                )
                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-44] ret-45)
                                               )
                                              )
                                              (seq
                                               (seq
                                                (ap :error: -else-error-)
                                                (xor
                                                 (match :error:.$.error_code 10001
                                                  (ap -if-error- -if-else-error-)
                                                 )
                                                 (ap -else-error- -if-else-error-)
                                                )
                                               )
                                               (fail -if-else-error-)
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                      (next match-0)
                                     )
                                    )
                                    (canon %init_peer_id% $new  #-new-fix-0)
                                   )
                                   (ap #-new-fix-0 -new-flat-0)
                                  )
                                 )
                                 (new $deal_ids
                                  (seq
                                   (seq
                                    (fold -new-flat-0 log-16-0
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (ap log-16-0.$.info log-16-0_flat)
                                         (ap log-16-0_flat.$.deal_id log-16-0_flat_flat)
                                        )
                                        (new $error-0
                                         (new $worker_id-0
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (new $array-inline-16
                                                     (seq
                                                      (seq
                                                       (ap "joining a deal from_block" $array-inline-16)
                                                       (ap log-16-0.$.block_number $array-inline-16)
                                                      )
                                                      (canon %init_peer_id% $array-inline-16  #array-inline-16-0)
                                                     )
                                                    )
                                                    (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-46)
                                                   )
                                                   (par
                                                    (call %init_peer_id% ("run-console" "print") [ret-46 #array-inline-16-0])
                                                    (null)
                                                   )
                                                  )
                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-16-0] ret-47)
                                                 )
                                                 (call %init_peer_id% ("op" "concat_strings") [ret-46 ret-47] ret-48)
                                                )
                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-48] ret-49)
                                               )
                                               (xor
                                                (seq
                                                 (new $worker_id-1
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (call %init_peer_id% ("worker" "get_worker_id") [log-16-0_flat_flat] ret-50)
                                                     (new -if-else-error-
                                                      (new -else-error-
                                                       (new -if-error-
                                                        (xor
                                                         (match ret-50 []
                                                          (xor
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (call %init_peer_id% ("worker" "create") [log-16-0_flat_flat] ret-51)
                                                                  (ap ret-51 $worker_id-1)
                                                                 )
                                                                 (new $array-inline-17
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (new $worker_id-1_test
                                                                      (seq
                                                                       (seq
                                                                        (fold $worker_id-1 worker_id-1_fold_var
                                                                         (seq
                                                                          (seq
                                                                           (ap worker_id-1_fold_var $worker_id-1_test)
                                                                           (canon %init_peer_id% $worker_id-1_test  #worker_id-1_iter_canon)
                                                                          )
                                                                          (xor
                                                                           (match #worker_id-1_iter_canon.length 1
                                                                            (null)
                                                                           )
                                                                           (next worker_id-1_fold_var)
                                                                          )
                                                                         )
                                                                         (never)
                                                                        )
                                                                        (canon %init_peer_id% $worker_id-1_test  #worker_id-1_result_canon)
                                                                       )
                                                                       (ap #worker_id-1_result_canon worker_id-1_gate)
                                                                      )
                                                                     )
                                                                     (ap "created worker for deal" $array-inline-17)
                                                                    )
                                                                    (ap worker_id-1_gate.$.[0] $array-inline-17)
                                                                   )
                                                                   (canon %init_peer_id% $array-inline-17  #array-inline-17-0)
                                                                  )
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-52)
                                                               )
                                                               (par
                                                                (call %init_peer_id% ("run-console" "print") [ret-52 #array-inline-17-0])
                                                                (null)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("json" "stringify") [#array-inline-17-0] ret-53)
                                                             )
                                                             (call %init_peer_id% ("op" "concat_strings") [ret-52 ret-53] ret-54)
                                                            )
                                                            (call %init_peer_id% (-spell_id-arg- "store_log") [ret-54] ret-55)
                                                           )
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (new $array-inline-18
                                                                 (seq
                                                                  (seq
                                                                   (ap "error creating worker" $array-inline-18)
                                                                   (ap :error:.$.message $array-inline-18)
                                                                  )
                                                                  (canon %init_peer_id% $array-inline-18  #array-inline-18-0)
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-56)
                                                               )
                                                               (par
                                                                (call %init_peer_id% ("run-console" "print") [ret-56 #array-inline-18-0])
                                                                (null)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("json" "stringify") [#array-inline-18-0] ret-57)
                                                             )
                                                             (call %init_peer_id% ("op" "concat_strings") [ret-56 ret-57] ret-58)
                                                            )
                                                            (call %init_peer_id% (-spell_id-arg- "store_log") [ret-58] ret-59)
                                                           )
                                                          )
                                                         )
                                                         (seq
                                                          (ap :error: -if-error-)
                                                          (xor
                                                           (match :error:.$.error_code 10001
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (new $array-inline-19
                                                                   (seq
                                                                    (seq
                                                                     (ap "found existing worker" $array-inline-19)
                                                                     (ap ret-50.$.[0] $array-inline-19)
                                                                    )
                                                                    (canon %init_peer_id% $array-inline-19  #array-inline-19-0)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-60)
                                                                 )
                                                                 (par
                                                                  (call %init_peer_id% ("run-console" "print") [ret-60 #array-inline-19-0])
                                                                  (null)
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("json" "stringify") [#array-inline-19-0] ret-61)
                                                               )
                                                               (call %init_peer_id% ("op" "concat_strings") [ret-60 ret-61] ret-62)
                                                              )
                                                              (call %init_peer_id% (-spell_id-arg- "store_log") [ret-62] ret-63)
                                                             )
                                                             (ap ret-50.$.[0] $worker_id-1)
                                                            )
                                                           )
                                                           (seq
                                                            (seq
                                                             (ap :error: -else-error-)
                                                             (xor
                                                              (match :error:.$.error_code 10001
                                                               (ap -if-error- -if-else-error-)
                                                              )
                                                              (ap -else-error- -if-else-error-)
                                                             )
                                                            )
                                                            (fail -if-else-error-)
                                                           )
                                                          )
                                                         )
                                                        )
                                                       )
                                                      )
                                                     )
                                                    )
                                                    (canon %init_peer_id% $worker_id-1  #-worker_id-fix-0-0)
                                                   )
                                                   (ap #-worker_id-fix-0-0 -worker_id-flat-0-0)
                                                  )
                                                 )
                                                 (new -if-error-
                                                  (xor
                                                   (mismatch -worker_id-flat-0-0 []
                                                    (ap -worker_id-flat-0-0.$.[0] $worker_id-0)
                                                   )
                                                   (seq
                                                    (ap :error: -if-error-)
                                                    (xor
                                                     (match :error:.$.error_code 10002
                                                      (null)
                                                     )
                                                     (fail -if-error-)
                                                    )
                                                   )
                                                  )
                                                 )
                                                )
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (new $array-inline-20
                                                         (seq
                                                          (seq
                                                           (ap "error creating worker" $array-inline-20)
                                                           (ap :error: $array-inline-20)
                                                          )
                                                          (canon %init_peer_id% $array-inline-20  #array-inline-20-0)
                                                         )
                                                        )
                                                        (call %init_peer_id% ("json" "stringify") [#array-inline-20-0] ret-64)
                                                       )
                                                       (ap ret-64 $error-0)
                                                      )
                                                      (new $array-inline-21
                                                       (seq
                                                        (seq
                                                         (ap "error creating worker" $array-inline-21)
                                                         (ap :error: $array-inline-21)
                                                        )
                                                        (canon %init_peer_id% $array-inline-21  #array-inline-21-0)
                                                       )
                                                      )
                                                     )
                                                     (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-65)
                                                    )
                                                    (par
                                                     (call %init_peer_id% ("run-console" "print") [ret-65 #array-inline-21-0])
                                                     (null)
                                                    )
                                                   )
                                                   (call %init_peer_id% ("json" "stringify") [#array-inline-21-0] ret-66)
                                                  )
                                                  (call %init_peer_id% ("op" "concat_strings") [ret-65 ret-66] ret-67)
                                                 )
                                                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-67] ret-68)
                                                )
                                               )
                                              )
                                              (canon %init_peer_id% $worker_id-0  #-worker_id-fix-0)
                                             )
                                             (ap #-worker_id-fix-0 -worker_id-flat-0)
                                            )
                                            (canon %init_peer_id% $error-0  #-error-fix-1)
                                           )
                                           (ap #-error-fix-1 -error-flat-1)
                                          )
                                         )
                                        )
                                       )
                                       (new -if-else-error-
                                        (new -else-error-
                                         (new -if-error-
                                          (xor
                                           (match -worker_id-flat-0 []
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (new %InstallationFailed_obj_map
                                                   (seq
                                                    (ap ("log" log-16-0) %InstallationFailed_obj_map)
                                                    (canon %init_peer_id% %InstallationFailed_obj_map  InstallationFailed_obj)
                                                   )
                                                  )
                                                  (new %FailedDealError_obj_map
                                                   (seq
                                                    (seq
                                                     (ap ("content" InstallationFailed_obj) %FailedDealError_obj_map)
                                                     (ap ("type" "InstallationFailed") %FailedDealError_obj_map)
                                                    )
                                                    (canon %init_peer_id% %FailedDealError_obj_map  FailedDealError_obj)
                                                   )
                                                  )
                                                 )
                                                 (new %FailedDeal_obj_map
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (ap ("deal_id" log-16-0_flat_flat) %FailedDeal_obj_map)
                                                     (ap ("message" -error-flat-1.$.[0]) %FailedDeal_obj_map)
                                                    )
                                                    (ap ("payload" FailedDealError_obj) %FailedDeal_obj_map)
                                                   )
                                                   (canon %init_peer_id% %FailedDeal_obj_map  FailedDeal_obj)
                                                  )
                                                 )
                                                )
                                                (call %init_peer_id% ("json" "stringify") [FailedDeal_obj] ret-69)
                                               )
                                               (call %init_peer_id% (-spell_id-arg- "list_push_string") ["failed_deals" ret-69] ret-70)
                                              )
                                              (xor
                                               (match ret-70.$.success true
                                                (ap false not-6)
                                               )
                                               (ap true not-6)
                                              )
                                             )
                                             (new -if-error-
                                              (xor
                                               (match not-6 true
                                                (seq
                                                 (seq
                                                  (seq
                                                   (new $array-inline-22
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (ap "can't store value in list by key" $array-inline-22)
                                                        (ap "failed_deals" $array-inline-22)
                                                       )
                                                       (ap "error:" $array-inline-22)
                                                      )
                                                      (ap ret-70.$.error $array-inline-22)
                                                     )
                                                     (canon %init_peer_id% $array-inline-22  #array-inline-22-0)
                                                    )
                                                   )
                                                   (par
                                                    (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-22-0])
                                                    (null)
                                                   )
                                                  )
                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-22-0] ret-71)
                                                 )
                                                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-71] ret-72)
                                                )
                                               )
                                               (seq
                                                (ap :error: -if-error-)
                                                (xor
                                                 (match :error:.$.error_code 10001
                                                  (null)
                                                 )
                                                 (fail -if-error-)
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                           (seq
                                            (ap :error: -if-error-)
                                            (xor
                                             (match :error:.$.error_code 10001
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (call %init_peer_id% ("chain_connector" "register_worker") [log-16-0.$.info.pat_id -worker_id-flat-0.$.[0] -chain-arg- log-16-0_flat_flat] ret-73)
                                                      (ap ret-73.$.success ret-73_flat)
                                                     )
                                                     (new -if-else-error-
                                                      (new -else-error-
                                                       (new -if-error-
                                                        (xor
                                                         (match ret-73.$.success true
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (new $array-inline-23
                                                                     (seq
                                                                      (seq
                                                                       (ap "registered worker tx_hash" $array-inline-23)
                                                                       (ap ret-73.$.tx_hash $array-inline-23)
                                                                      )
                                                                      (canon %init_peer_id% $array-inline-23  #array-inline-23-0)
                                                                     )
                                                                    )
                                                                    (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-74)
                                                                   )
                                                                   (par
                                                                    (call %init_peer_id% ("run-console" "print") [ret-74 #array-inline-23-0])
                                                                    (null)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-23-0] ret-75)
                                                                 )
                                                                 (call %init_peer_id% ("op" "concat_strings") [ret-74 ret-75] ret-76)
                                                                )
                                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-76] ret-77)
                                                               )
                                                               (new %WorkerTxInfo_obj_map
                                                                (seq
                                                                 (seq
                                                                  (ap ("deal_id" log-16-0_flat_flat) %WorkerTxInfo_obj_map)
                                                                  (ap ("tx_hash" ret-73.$.tx_hash.[0]) %WorkerTxInfo_obj_map)
                                                                 )
                                                                 (canon %init_peer_id% %WorkerTxInfo_obj_map  WorkerTxInfo_obj)
                                                                )
                                                               )
                                                              )
                                                              (call %init_peer_id% ("json" "stringify") [WorkerTxInfo_obj] ret-78)
                                                             )
                                                             (call %init_peer_id% (-spell_id-arg- "list_push_string") ["worker_registration_txs" ret-78] ret-79)
                                                            )
                                                            (xor
                                                             (match ret-79.$.success true
                                                              (ap false not-7)
                                                             )
                                                             (ap true not-7)
                                                            )
                                                           )
                                                           (new -if-error-
                                                            (xor
                                                             (match not-7 true
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (new $array-inline-24
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (ap "can't store value in list by key" $array-inline-24)
                                                                      (ap "worker_registration_txs" $array-inline-24)
                                                                     )
                                                                     (ap "error:" $array-inline-24)
                                                                    )
                                                                    (ap ret-79.$.error $array-inline-24)
                                                                   )
                                                                   (canon %init_peer_id% $array-inline-24  #array-inline-24-0)
                                                                  )
                                                                 )
                                                                 (par
                                                                  (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-24-0])
                                                                  (null)
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("json" "stringify") [#array-inline-24-0] ret-80)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-80] ret-81)
                                                              )
                                                             )
                                                             (seq
                                                              (ap :error: -if-error-)
                                                              (xor
                                                               (match :error:.$.error_code 10001
                                                                (null)
                                                               )
                                                               (fail -if-error-)
                                                              )
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                         (seq
                                                          (ap :error: -if-error-)
                                                          (xor
                                                           (match :error:.$.error_code 10001
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (new $array-inline-25
                                                                         (seq
                                                                          (seq
                                                                           (ap "error registering worker" $array-inline-25)
                                                                           (ap ret-73.$.error.[0] $array-inline-25)
                                                                          )
                                                                          (canon %init_peer_id% $array-inline-25  #array-inline-25-0)
                                                                         )
                                                                        )
                                                                        (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-82)
                                                                       )
                                                                       (par
                                                                        (call %init_peer_id% ("run-console" "print") [ret-82 #array-inline-25-0])
                                                                        (null)
                                                                       )
                                                                      )
                                                                      (call %init_peer_id% ("json" "stringify") [#array-inline-25-0] ret-83)
                                                                     )
                                                                     (call %init_peer_id% ("op" "concat_strings") [ret-82 ret-83] ret-84)
                                                                    )
                                                                    (call %init_peer_id% (-spell_id-arg- "store_log") [ret-84] ret-85)
                                                                   )
                                                                   (new %TxFailed_obj_map
                                                                    (seq
                                                                     (seq
                                                                      (ap ("block_number" []) %TxFailed_obj_map)
                                                                      (ap ("tx_hash" []) %TxFailed_obj_map)
                                                                     )
                                                                     (canon %init_peer_id% %TxFailed_obj_map  TxFailed_obj)
                                                                    )
                                                                   )
                                                                  )
                                                                  (new %FailedDealError_obj-0_map
                                                                   (seq
                                                                    (seq
                                                                     (ap ("content" TxFailed_obj) %FailedDealError_obj-0_map)
                                                                     (ap ("type" "TxFailed") %FailedDealError_obj-0_map)
                                                                    )
                                                                    (canon %init_peer_id% %FailedDealError_obj-0_map  FailedDealError_obj-0)
                                                                   )
                                                                  )
                                                                 )
                                                                 (new %FailedDeal_obj-0_map
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (ap ("deal_id" log-16-0_flat_flat) %FailedDeal_obj-0_map)
                                                                     (ap ("message" ret-73.$.error.[0]) %FailedDeal_obj-0_map)
                                                                    )
                                                                    (ap ("payload" FailedDealError_obj-0) %FailedDeal_obj-0_map)
                                                                   )
                                                                   (canon %init_peer_id% %FailedDeal_obj-0_map  FailedDeal_obj-0)
                                                                  )
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("json" "stringify") [FailedDeal_obj-0] ret-86)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "list_push_string") ["failed_deals" ret-86] ret-87)
                                                              )
                                                              (xor
                                                               (match ret-87.$.success true
                                                                (ap false not-8)
                                                               )
                                                               (ap true not-8)
                                                              )
                                                             )
                                                             (new -if-error-
                                                              (xor
                                                               (match not-8 true
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (new $array-inline-26
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (ap "can't store value in list by key" $array-inline-26)
                                                                        (ap "failed_deals" $array-inline-26)
                                                                       )
                                                                       (ap "error:" $array-inline-26)
                                                                      )
                                                                      (ap ret-87.$.error $array-inline-26)
                                                                     )
                                                                     (canon %init_peer_id% $array-inline-26  #array-inline-26-0)
                                                                    )
                                                                   )
                                                                   (par
                                                                    (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-26-0])
                                                                    (null)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-26-0] ret-88)
                                                                 )
                                                                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-88] ret-89)
                                                                )
                                                               )
                                                               (seq
                                                                (ap :error: -if-error-)
                                                                (xor
                                                                 (match :error:.$.error_code 10001
                                                                  (null)
                                                                 )
                                                                 (fail -if-error-)
                                                                )
                                                               )
                                                              )
                                                             )
                                                            )
                                                           )
                                                           (seq
                                                            (seq
                                                             (ap :error: -else-error-)
                                                             (xor
                                                              (match :error:.$.error_code 10001
                                                               (ap -if-error- -if-else-error-)
                                                              )
                                                              (ap -else-error- -if-else-error-)
                                                             )
                                                            )
                                                            (fail -if-else-error-)
                                                           )
                                                          )
                                                         )
                                                        )
                                                       )
                                                      )
                                                     )
                                                    )
                                                    (new -if-error-
                                                     (xor
                                                      (match ret-73_flat true
                                                       (seq
                                                        (xor
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (new %JoinedDeal_obj_map
                                                                    (seq
                                                                     (seq
                                                                      (ap ("deal_id" log-16-0_flat_flat) %JoinedDeal_obj_map)
                                                                      (ap ("worker_id" -worker_id-flat-0.$.[0]) %JoinedDeal_obj_map)
                                                                     )
                                                                     (canon %init_peer_id% %JoinedDeal_obj_map  JoinedDeal_obj)
                                                                    )
                                                                   )
                                                                   (call %init_peer_id% ("json" "stringify") [JoinedDeal_obj] ret-90)
                                                                  )
                                                                  (call %init_peer_id% (-spell_id-arg- "list_push_string") ["joined_deals" ret-90] ret-91)
                                                                 )
                                                                 (new %DealState_obj_map
                                                                  (seq
                                                                   (ap ("left_boundary" log-16-0.$.block_number) %DealState_obj_map)
                                                                   (canon %init_peer_id% %DealState_obj_map  DealState_obj)
                                                                  )
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("json" "stringify") [DealState_obj] ret-92)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "set_string") [log-16-0_flat_flat ret-92] ret-93)
                                                              )
                                                              (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-94)
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("run-console" "print") [ret-94 "deal state saved to kv"])
                                                              (null)
                                                             )
                                                            )
                                                            (call %init_peer_id% ("json" "stringify") ["deal state saved to kv"] ret-95)
                                                           )
                                                           (call %init_peer_id% ("op" "concat_strings") [ret-94 ret-95] ret-96)
                                                          )
                                                          (call %init_peer_id% (-spell_id-arg- "store_log") [ret-96] ret-97)
                                                         )
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (new $array-inline-27
                                                               (seq
                                                                (seq
                                                                 (ap "cannot store deal state, deal join failed" $array-inline-27)
                                                                 (ap :error:.$.message $array-inline-27)
                                                                )
                                                                (canon %init_peer_id% $array-inline-27  #array-inline-27-0)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" log-16-0_flat_flat ": "] ret-98)
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("run-console" "print") [ret-98 #array-inline-27-0])
                                                              (null)
                                                             )
                                                            )
                                                            (call %init_peer_id% ("json" "stringify") [#array-inline-27-0] ret-99)
                                                           )
                                                           (call %init_peer_id% ("op" "concat_strings") [ret-98 ret-99] ret-100)
                                                          )
                                                          (call %init_peer_id% (-spell_id-arg- "store_log") [ret-100] ret-101)
                                                         )
                                                        )
                                                        (ap log-16-0_flat_flat $deal_ids)
                                                       )
                                                      )
                                                      (seq
                                                       (ap :error: -if-error-)
                                                       (xor
                                                        (match :error:.$.error_code 10001
                                                         (null)
                                                        )
                                                        (fail -if-error-)
                                                       )
                                                      )
                                                     )
                                                    )
                                                   )
                                                   (call %init_peer_id% ("chain_connector" "hex_sub") [log-16-0.$.block_number 1] ret-102)
                                                  )
                                                  (xor
                                                   (match ret-102.$.success true
                                                    (ap false not-9)
                                                   )
                                                   (ap true not-9)
                                                  )
                                                 )
                                                 (new -if-error-
                                                  (xor
                                                   (match not-9 true
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (new $array-inline-28
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (ap "hex_sub failed" $array-inline-28)
                                                           (ap log-16-0.$.block_number $array-inline-28)
                                                          )
                                                          (ap 1 $array-inline-28)
                                                         )
                                                         (canon %init_peer_id% $array-inline-28  #array-inline-28-0)
                                                        )
                                                       )
                                                       (par
                                                        (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-28-0])
                                                        (null)
                                                       )
                                                      )
                                                      (call %init_peer_id% ("json" "stringify") [#array-inline-28-0] ret-103)
                                                     )
                                                     (call %init_peer_id% (-spell_id-arg- "store_log") [ret-103] ret-104)
                                                    )
                                                   )
                                                   (seq
                                                    (ap :error: -if-error-)
                                                    (xor
                                                     (match :error:.$.error_code 10001
                                                      (null)
                                                     )
                                                     (fail -if-error-)
                                                    )
                                                   )
                                                  )
                                                 )
                                                )
                                                (ap ret-102.$.diff ret-102_flat)
                                               )
                                               (new -if-error-
                                                (xor
                                                 (mismatch ret-102_flat []
                                                  (seq
                                                   (seq
                                                    (new $result-6
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (call %init_peer_id% ("chain_connector" "hex_cmp") [ret-102_flat.$.[0] -left-flat-0.$.[0]] ret-105)
                                                        (new -if-else-error-
                                                         (new -else-error-
                                                          (new -if-error-
                                                           (xor
                                                            (match ret-105.$.success true
                                                             (seq
                                                              (call %init_peer_id% ("cmp" "gt") [ret-105.$.ordering 0] gt)
                                                              (ap gt $result-6)
                                                             )
                                                            )
                                                            (seq
                                                             (ap :error: -if-error-)
                                                             (xor
                                                              (match :error:.$.error_code 10001
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (new $array-inline-29
                                                                   (seq
                                                                    (seq
                                                                     (ap "hex_cmp error" $array-inline-29)
                                                                     (ap ret-105.$.error $array-inline-29)
                                                                    )
                                                                    (canon %init_peer_id% $array-inline-29  #array-inline-29-0)
                                                                   )
                                                                  )
                                                                  (par
                                                                   (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-29-0])
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("json" "stringify") [#array-inline-29-0] ret-106)
                                                                )
                                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-106] ret-107)
                                                               )
                                                              )
                                                              (seq
                                                               (seq
                                                                (ap :error: -else-error-)
                                                                (xor
                                                                 (match :error:.$.error_code 10001
                                                                  (ap -if-error- -if-else-error-)
                                                                 )
                                                                 (ap -else-error- -if-else-error-)
                                                                )
                                                               )
                                                               (fail -if-else-error-)
                                                              )
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                        )
                                                       )
                                                       (canon %init_peer_id% $result-6  #-result-fix-0-1)
                                                      )
                                                      (ap #-result-fix-0-1 -result-flat-0-1)
                                                     )
                                                    )
                                                    (new $array-inline-30
                                                     (seq
                                                      (ap true $array-inline-30)
                                                      (canon %init_peer_id% $array-inline-30  #array-inline-30-0)
                                                     )
                                                    )
                                                   )
                                                   (new -if-error-
                                                    (xor
                                                     (match -result-flat-0-1 #array-inline-30-0
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (new $array-inline-31
                                                               (seq
                                                                (seq
                                                                 (ap "gt_set: will set last seen to" $array-inline-31)
                                                                 (ap ret-102_flat.$.[0] $array-inline-31)
                                                                )
                                                                (canon %init_peer_id% $array-inline-31  #array-inline-31-0)
                                                               )
                                                              )
                                                              (par
                                                               (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-31-0])
                                                               (null)
                                                              )
                                                             )
                                                             (call %init_peer_id% ("json" "stringify") [#array-inline-31-0] ret-108)
                                                            )
                                                            (call %init_peer_id% (-spell_id-arg- "store_log") [ret-108] ret-109)
                                                           )
                                                           (new $array-inline-32
                                                            (seq
                                                             (seq
                                                              (ap "will set last seen to" $array-inline-32)
                                                              (ap ret-102_flat.$.[0] $array-inline-32)
                                                             )
                                                             (canon %init_peer_id% $array-inline-32  #array-inline-32-0)
                                                            )
                                                           )
                                                          )
                                                          (par
                                                           (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-32-0])
                                                           (null)
                                                          )
                                                         )
                                                         (call %init_peer_id% ("json" "stringify") [#array-inline-32-0] ret-110)
                                                        )
                                                        (call %init_peer_id% (-spell_id-arg- "store_log") [ret-110] ret-111)
                                                       )
                                                       (xor
                                                        (seq
                                                         (call %init_peer_id% (-spell_id-arg- "set_string") ["last_seen_block" ret-102_flat.$.[0]] ret-112)
                                                         (new -if-else-error-
                                                          (new -else-error-
                                                           (new -if-error-
                                                            (xor
                                                             (match ret-112.$.success true
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (new $array-inline-33
                                                                  (seq
                                                                   (seq
                                                                    (ap "saved last seen" $array-inline-33)
                                                                    (ap ret-102_flat.$.[0] $array-inline-33)
                                                                   )
                                                                   (canon %init_peer_id% $array-inline-33  #array-inline-33-0)
                                                                  )
                                                                 )
                                                                 (par
                                                                  (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-33-0])
                                                                  (null)
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("json" "stringify") [#array-inline-33-0] ret-113)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-113] ret-114)
                                                              )
                                                             )
                                                             (seq
                                                              (ap :error: -if-error-)
                                                              (xor
                                                               (match :error:.$.error_code 10001
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (new $array-inline-34
                                                                    (seq
                                                                     (seq
                                                                      (ap "error saving last_seen_block" $array-inline-34)
                                                                      (ap ret-112.$.error $array-inline-34)
                                                                     )
                                                                     (canon %init_peer_id% $array-inline-34  #array-inline-34-0)
                                                                    )
                                                                   )
                                                                   (par
                                                                    (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-34-0])
                                                                    (null)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-34-0] ret-115)
                                                                 )
                                                                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-115] ret-116)
                                                                )
                                                               )
                                                               (seq
                                                                (seq
                                                                 (ap :error: -else-error-)
                                                                 (xor
                                                                  (match :error:.$.error_code 10001
                                                                   (ap -if-error- -if-else-error-)
                                                                  )
                                                                  (ap -else-error- -if-else-error-)
                                                                 )
                                                                )
                                                                (fail -if-else-error-)
                                                               )
                                                              )
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                        )
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (new $array-inline-35
                                                            (seq
                                                             (seq
                                                              (ap "error saving last_seen_block" $array-inline-35)
                                                              (ap :error: $array-inline-35)
                                                             )
                                                             (canon %init_peer_id% $array-inline-35  #array-inline-35-0)
                                                            )
                                                           )
                                                           (par
                                                            (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-35-0])
                                                            (null)
                                                           )
                                                          )
                                                          (call %init_peer_id% ("json" "stringify") [#array-inline-35-0] ret-117)
                                                         )
                                                         (call %init_peer_id% (-spell_id-arg- "store_log") [ret-117] ret-118)
                                                        )
                                                       )
                                                      )
                                                     )
                                                     (seq
                                                      (ap :error: -if-error-)
                                                      (xor
                                                       (match :error:.$.error_code 10001
                                                        (null)
                                                       )
                                                       (fail -if-error-)
                                                      )
                                                     )
                                                    )
                                                   )
                                                  )
                                                 )
                                                 (seq
                                                  (ap :error: -if-error-)
                                                  (xor
                                                   (match :error:.$.error_code 10002
                                                    (null)
                                                   )
                                                   (fail -if-error-)
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                             )
                                             (seq
                                              (seq
                                               (ap :error: -else-error-)
                                               (xor
                                                (match :error:.$.error_code 10001
                                                 (ap -if-error- -if-else-error-)
                                                )
                                                (ap -else-error- -if-else-error-)
                                               )
                                              )
                                              (fail -if-else-error-)
                                             )
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                      (next log-16-0)
                                     )
                                    )
                                    (canon %init_peer_id% $deal_ids  #deal_ids_canon)
                                   )
                                   (new -if-error-
                                    (xor
                                     (mismatch #deal_ids_canon []
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (new $array-inline-36
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (canon %init_peer_id% $deal_ids  #deal_ids_to_functor)
                                                   (ap #deal_ids_to_functor.length deal_ids_length)
                                                  )
                                                  (ap "polling statuses of " $array-inline-36)
                                                 )
                                                 (ap deal_ids_length $array-inline-36)
                                                )
                                                (ap "deals" $array-inline-36)
                                               )
                                               (canon %init_peer_id% $array-inline-36  #array-inline-36-0)
                                              )
                                             )
                                             (par
                                              (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-36-0])
                                              (null)
                                             )
                                            )
                                            (call %init_peer_id% ("json" "stringify") [#array-inline-36-0] ret-119)
                                           )
                                           (call %init_peer_id% (-spell_id-arg- "store_log") [ret-119] ret-120)
                                          )
                                          (canon %init_peer_id% $deal_ids  #deal_ids_canon-0)
                                         )
                                         (call %init_peer_id% ("chain_connector" "get_status_batch") [-chain-arg-.$.api_endpoint #deal_ids_canon-0] ret-121)
                                        )
                                        (xor
                                         (match ret-121.$.success true
                                          (ap false not-10)
                                         )
                                         (ap true not-10)
                                        )
                                       )
                                       (new -if-else-error-
                                        (new -else-error-
                                         (new -if-error-
                                          (xor
                                           (match not-10 true
                                            (seq
                                             (seq
                                              (seq
                                               (new $array-inline-37
                                                (seq
                                                 (seq
                                                  (ap "couldn't obtain deal statuses, error: " $array-inline-37)
                                                  (ap ret-121.$.error.[0] $array-inline-37)
                                                 )
                                                 (canon %init_peer_id% $array-inline-37  #array-inline-37-0)
                                                )
                                               )
                                               (par
                                                (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-37-0])
                                                (null)
                                               )
                                              )
                                              (call %init_peer_id% ("json" "stringify") [#array-inline-37-0] ret-122)
                                             )
                                             (call %init_peer_id% (-spell_id-arg- "store_log") [ret-122] ret-123)
                                            )
                                           )
                                           (seq
                                            (ap :error: -if-error-)
                                            (xor
                                             (match :error:.$.error_code 10001
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (new $array-inline-38
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (ap ret-121.$.statuses ret-121_flat)
                                                         (ap ret-121_flat ret-121_flat_to_functor)
                                                        )
                                                        (ap ret-121_flat_to_functor.length ret-121_flat_length)
                                                       )
                                                       (ap "found statuses for" $array-inline-38)
                                                      )
                                                      (ap ret-121_flat_length $array-inline-38)
                                                     )
                                                     (ap "deals" $array-inline-38)
                                                    )
                                                    (canon %init_peer_id% $array-inline-38  #array-inline-38-0)
                                                   )
                                                  )
                                                  (par
                                                   (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-38-0])
                                                   (null)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("json" "stringify") [#array-inline-38-0] ret-124)
                                                )
                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-124] ret-125)
                                               )
                                               (fold ret-121.$.statuses deal_status-0
                                                (seq
                                                 (seq
                                                  (xor
                                                   (match deal_status-0.$.success true
                                                    (ap false not-11)
                                                   )
                                                   (ap true not-11)
                                                  )
                                                  (new -if-else-error-
                                                   (new -else-error-
                                                    (new -if-error-
                                                     (xor
                                                      (match not-11 true
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (new $array-inline-39
                                                           (seq
                                                            (seq
                                                             (ap "couldn't obtain deal status, error:" $array-inline-39)
                                                             (ap deal_status-0.$.error.[0] $array-inline-39)
                                                            )
                                                            (canon %init_peer_id% $array-inline-39  #array-inline-39-0)
                                                           )
                                                          )
                                                          (par
                                                           (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-39-0])
                                                           (null)
                                                          )
                                                         )
                                                         (call %init_peer_id% ("json" "stringify") [#array-inline-39-0] ret-126)
                                                        )
                                                        (call %init_peer_id% (-spell_id-arg- "store_log") [ret-126] ret-127)
                                                       )
                                                      )
                                                      (seq
                                                       (ap :error: -if-error-)
                                                       (xor
                                                        (match :error:.$.error_code 10001
                                                         (new -if-else-error-
                                                          (new -else-error-
                                                           (new -if-error-
                                                            (xor
                                                             (match deal_status-0.$.status "ACTIVE"
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (new $array-inline-40
                                                                    (seq
                                                                     (seq
                                                                      (ap "couldn't activate a worker" $array-inline-40)
                                                                      (ap :error: $array-inline-40)
                                                                     )
                                                                     (canon %init_peer_id% $array-inline-40  #array-inline-40-0)
                                                                    )
                                                                   )
                                                                   (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-0.$.deal_id ": "] ret-128)
                                                                  )
                                                                  (par
                                                                   (call %init_peer_id% ("run-console" "print") [ret-128 #array-inline-40-0])
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("json" "stringify") [#array-inline-40-0] ret-129)
                                                                )
                                                                (call %init_peer_id% ("op" "concat_strings") [ret-128 ret-129] ret-130)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-130] ret-131)
                                                              )
                                                             )
                                                             (seq
                                                              (ap :error: -if-error-)
                                                              (xor
                                                               (match :error:.$.error_code 10001
                                                                (new -if-else-error-
                                                                 (new -else-error-
                                                                  (new -if-error-
                                                                   (xor
                                                                    (match deal_status-0.$.status "INACTIVE"
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (new $array-inline-41
                                                                           (seq
                                                                            (seq
                                                                             (ap "couldn't deactivate a worker" $array-inline-41)
                                                                             (ap :error: $array-inline-41)
                                                                            )
                                                                            (canon %init_peer_id% $array-inline-41  #array-inline-41-0)
                                                                           )
                                                                          )
                                                                          (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-0.$.deal_id ": "] ret-132)
                                                                         )
                                                                         (par
                                                                          (call %init_peer_id% ("run-console" "print") [ret-132 #array-inline-41-0])
                                                                          (null)
                                                                         )
                                                                        )
                                                                        (call %init_peer_id% ("json" "stringify") [#array-inline-41-0] ret-133)
                                                                       )
                                                                       (call %init_peer_id% ("op" "concat_strings") [ret-132 ret-133] ret-134)
                                                                      )
                                                                      (call %init_peer_id% (-spell_id-arg- "store_log") [ret-134] ret-135)
                                                                     )
                                                                    )
                                                                    (seq
                                                                     (ap :error: -if-error-)
                                                                     (xor
                                                                      (match :error:.$.error_code 10001
                                                                       (new -if-else-error-
                                                                        (new -else-error-
                                                                         (new -if-error-
                                                                          (xor
                                                                           (match deal_status-0.$.status "ENDED"
                                                                            (seq
                                                                             (call %init_peer_id% ("worker" "get_worker_id") [deal_status-0.$.deal_id] ret-136)
                                                                             (new -if-else-error-
                                                                              (new -else-error-
                                                                               (new -if-error-
                                                                                (xor
                                                                                 (mismatch ret-136 []
                                                                                  (seq
                                                                                   (seq
                                                                                    (seq
                                                                                     (seq
                                                                                      (seq
                                                                                       (seq
                                                                                        (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-0.$.deal_id ": "] ret-137)
                                                                                        (par
                                                                                         (call %init_peer_id% ("run-console" "print") [ret-137 "removing the worker and the deal state from kv"])
                                                                                         (null)
                                                                                        )
                                                                                       )
                                                                                       (call %init_peer_id% ("json" "stringify") ["removing the worker and the deal state from kv"] ret-138)
                                                                                      )
                                                                                      (call %init_peer_id% ("op" "concat_strings") [ret-137 ret-138] ret-139)
                                                                                     )
                                                                                     (call %init_peer_id% (-spell_id-arg- "store_log") [ret-139] ret-140)
                                                                                    )
                                                                                    (xor
                                                                                     (call %init_peer_id% ("worker" "remove") [ret-136.$.[0]])
                                                                                     (seq
                                                                                      (seq
                                                                                       (seq
                                                                                        (seq
                                                                                         (seq
                                                                                          (new $array-inline-42
                                                                                           (seq
                                                                                            (seq
                                                                                             (seq
                                                                                              (ap "couldn't remove a worker" $array-inline-42)
                                                                                              (ap ret-136.$.[0] $array-inline-42)
                                                                                             )
                                                                                             (ap :error: $array-inline-42)
                                                                                            )
                                                                                            (canon %init_peer_id% $array-inline-42  #array-inline-42-0)
                                                                                           )
                                                                                          )
                                                                                          (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-0.$.deal_id ": "] ret-141)
                                                                                         )
                                                                                         (par
                                                                                          (call %init_peer_id% ("run-console" "print") [ret-141 #array-inline-42-0])
                                                                                          (null)
                                                                                         )
                                                                                        )
                                                                                        (call %init_peer_id% ("json" "stringify") [#array-inline-42-0] ret-142)
                                                                                       )
                                                                                       (call %init_peer_id% ("op" "concat_strings") [ret-141 ret-142] ret-143)
                                                                                      )
                                                                                      (call %init_peer_id% (-spell_id-arg- "store_log") [ret-143] ret-144)
                                                                                     )
                                                                                    )
                                                                                   )
                                                                                   (xor
                                                                                    (seq
                                                                                     (seq
                                                                                      (seq
                                                                                       (seq
                                                                                        (seq
                                                                                         (new %JoinedDeal_obj-0_map
                                                                                          (seq
                                                                                           (seq
                                                                                            (ap ("deal_id" deal_status-0.$.deal_id) %JoinedDeal_obj-0_map)
                                                                                            (ap ("worker_id" ret-136.$.[0]) %JoinedDeal_obj-0_map)
                                                                                           )
                                                                                           (canon %init_peer_id% %JoinedDeal_obj-0_map  JoinedDeal_obj-0)
                                                                                          )
                                                                                         )
                                                                                         (call %init_peer_id% ("json" "stringify") [JoinedDeal_obj-0] ret-145)
                                                                                        )
                                                                                        (call %init_peer_id% (-spell_id-arg- "list_remove_string") ["joined_deals" ret-145] ret-146)
                                                                                       )
                                                                                       (call %init_peer_id% (-spell_id-arg- "remove_key") [deal_status-0.$.deal_id] ret-147)
                                                                                      )
                                                                                      (call %init_peer_id% ("op" "concat_strings") ["removed_state:" deal_status-0.$.deal_id] ret-148)
                                                                                     )
                                                                                     (call %init_peer_id% (-spell_id-arg- "remove_key") [ret-148] ret-149)
                                                                                    )
                                                                                    (seq
                                                                                     (seq
                                                                                      (seq
                                                                                       (seq
                                                                                        (seq
                                                                                         (new $array-inline-43
                                                                                          (seq
                                                                                           (seq
                                                                                            (ap "couldn't remove the deal" $array-inline-43)
                                                                                            (ap :error: $array-inline-43)
                                                                                           )
                                                                                           (canon %init_peer_id% $array-inline-43  #array-inline-43-0)
                                                                                          )
                                                                                         )
                                                                                         (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-0.$.deal_id ": "] ret-150)
                                                                                        )
                                                                                        (par
                                                                                         (call %init_peer_id% ("run-console" "print") [ret-150 #array-inline-43-0])
                                                                                         (null)
                                                                                        )
                                                                                       )
                                                                                       (call %init_peer_id% ("json" "stringify") [#array-inline-43-0] ret-151)
                                                                                      )
                                                                                      (call %init_peer_id% ("op" "concat_strings") [ret-150 ret-151] ret-152)
                                                                                     )
                                                                                     (call %init_peer_id% (-spell_id-arg- "store_log") [ret-152] ret-153)
                                                                                    )
                                                                                   )
                                                                                  )
                                                                                 )
                                                                                 (seq
                                                                                  (ap :error: -if-error-)
                                                                                  (xor
                                                                                   (match :error:.$.error_code 10002
                                                                                    (seq
                                                                                     (seq
                                                                                      (seq
                                                                                       (seq
                                                                                        (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-0.$.deal_id ": "] ret-154)
                                                                                        (par
                                                                                         (call %init_peer_id% ("run-console" "print") [ret-154 "deal doesn't have associated worker O.o"])
                                                                                         (null)
                                                                                        )
                                                                                       )
                                                                                       (call %init_peer_id% ("json" "stringify") ["deal doesn't have associated worker O.o"] ret-155)
                                                                                      )
                                                                                      (call %init_peer_id% ("op" "concat_strings") [ret-154 ret-155] ret-156)
                                                                                     )
                                                                                     (call %init_peer_id% (-spell_id-arg- "store_log") [ret-156] ret-157)
                                                                                    )
                                                                                   )
                                                                                   (seq
                                                                                    (seq
                                                                                     (ap :error: -else-error-)
                                                                                     (xor
                                                                                      (match :error:.$.error_code 10001
                                                                                       (ap -if-error- -if-else-error-)
                                                                                      )
                                                                                      (ap -else-error- -if-else-error-)
                                                                                     )
                                                                                    )
                                                                                    (fail -if-else-error-)
                                                                                   )
                                                                                  )
                                                                                 )
                                                                                )
                                                                               )
                                                                              )
                                                                             )
                                                                            )
                                                                           )
                                                                           (seq
                                                                            (ap :error: -if-error-)
                                                                            (xor
                                                                             (match :error:.$.error_code 10001
                                                                              (seq
                                                                               (seq
                                                                                (seq
                                                                                 (new $array-inline-44
                                                                                  (seq
                                                                                   (seq
                                                                                    (ap "unsupported deal status: " $array-inline-44)
                                                                                    (ap deal_status-0 $array-inline-44)
                                                                                   )
                                                                                   (canon %init_peer_id% $array-inline-44  #array-inline-44-0)
                                                                                  )
                                                                                 )
                                                                                 (par
                                                                                  (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-44-0])
                                                                                  (null)
                                                                                 )
                                                                                )
                                                                                (call %init_peer_id% ("json" "stringify") [#array-inline-44-0] ret-158)
                                                                               )
                                                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-158] ret-159)
                                                                              )
                                                                             )
                                                                             (seq
                                                                              (seq
                                                                               (ap :error: -else-error-)
                                                                               (xor
                                                                                (match :error:.$.error_code 10001
                                                                                 (ap -if-error- -if-else-error-)
                                                                                )
                                                                                (ap -else-error- -if-else-error-)
                                                                               )
                                                                              )
                                                                              (fail -if-else-error-)
                                                                             )
                                                                            )
                                                                           )
                                                                          )
                                                                         )
                                                                        )
                                                                       )
                                                                      )
                                                                      (seq
                                                                       (seq
                                                                        (ap :error: -else-error-)
                                                                        (xor
                                                                         (match :error:.$.error_code 10001
                                                                          (ap -if-error- -if-else-error-)
                                                                         )
                                                                         (ap -else-error- -if-else-error-)
                                                                        )
                                                                       )
                                                                       (fail -if-else-error-)
                                                                      )
                                                                     )
                                                                    )
                                                                   )
                                                                  )
                                                                 )
                                                                )
                                                               )
                                                               (seq
                                                                (seq
                                                                 (ap :error: -else-error-)
                                                                 (xor
                                                                  (match :error:.$.error_code 10001
                                                                   (ap -if-error- -if-else-error-)
                                                                  )
                                                                  (ap -else-error- -if-else-error-)
                                                                 )
                                                                )
                                                                (fail -if-else-error-)
                                                               )
                                                              )
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                        )
                                                        (seq
                                                         (seq
                                                          (ap :error: -else-error-)
                                                          (xor
                                                           (match :error:.$.error_code 10001
                                                            (ap -if-error- -if-else-error-)
                                                           )
                                                           (ap -else-error- -if-else-error-)
                                                          )
                                                         )
                                                         (fail -if-else-error-)
                                                        )
                                                       )
                                                      )
                                                     )
                                                    )
                                                   )
                                                  )
                                                 )
                                                 (next deal_status-0)
                                                )
                                               )
                                              )
                                             )
                                             (seq
                                              (seq
                                               (ap :error: -else-error-)
                                               (xor
                                                (match :error:.$.error_code 10001
                                                 (ap -if-error- -if-else-error-)
                                                )
                                                (ap -else-error- -if-else-error-)
                                               )
                                              )
                                              (fail -if-else-error-)
                                             )
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                     )
                                     (seq
                                      (ap :error: -if-error-)
                                      (xor
                                       (match :error:.$.error_code 10002
                                        (null)
                                       )
                                       (fail -if-error-)
                                      )
                                     )
                                    )
                                   )
                                  )
                                 )
                                )
                                (new $array-inline-45
                                 (seq
                                  (seq
                                   (seq
                                    (ap "poll_new_deals call Hex.min" $array-inline-45)
                                    (ap -latest-flat-0.$.[0] $array-inline-45)
                                   )
                                   (ap -poll-flat-0.$.[0].right_boundary $array-inline-45)
                                  )
                                  (canon %init_peer_id% $array-inline-45  #array-inline-45-0)
                                 )
                                )
                               )
                               (par
                                (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-45-0])
                                (null)
                               )
                              )
                              (call %init_peer_id% ("json" "stringify") [#array-inline-45-0] ret-160)
                             )
                             (call %init_peer_id% (-spell_id-arg- "store_log") [ret-160] ret-161)
                            )
                            (call %init_peer_id% ("chain_connector" "hex_min") [-latest-flat-0.$.[0] -poll-flat-0.$.[0].right_boundary] ret-162)
                           )
                           (xor
                            (match ret-162.$.success true
                             (ap false not-12)
                            )
                            (ap true not-12)
                           )
                          )
                          (new -if-error-
                           (xor
                            (match not-12 true
                             (seq
                              (seq
                               (seq
                                (new $array-inline-46
                                 (seq
                                  (seq
                                   (seq
                                    (ap "hex_min failed" $array-inline-46)
                                    (ap -latest-flat-0.$.[0] $array-inline-46)
                                   )
                                   (ap -poll-flat-0.$.[0].right_boundary $array-inline-46)
                                  )
                                  (canon %init_peer_id% $array-inline-46  #array-inline-46-0)
                                 )
                                )
                                (par
                                 (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-46-0])
                                 (null)
                                )
                               )
                               (call %init_peer_id% ("json" "stringify") [#array-inline-46-0] ret-163)
                              )
                              (call %init_peer_id% (-spell_id-arg- "store_log") [ret-163] ret-164)
                             )
                            )
                            (seq
                             (ap :error: -if-error-)
                             (xor
                              (match :error:.$.error_code 10001
                               (null)
                              )
                              (fail -if-error-)
                             )
                            )
                           )
                          )
                         )
                         (ap ret-162.$.hex ret-162_flat)
                        )
                        (new -if-error-
                         (xor
                          (mismatch ret-162_flat []
                           (seq
                            (new $result-8
                             (seq
                              (seq
                               (seq
                                (seq
                                 (call %init_peer_id% (-spell_id-arg- "get_string") ["last_seen_block"] ret-165)
                                 (xor
                                  (match ret-165.$.success true
                                   (ap false not-13)
                                  )
                                  (ap true not-13)
                                 )
                                )
                                (new -if-else-error-
                                 (new -else-error-
                                  (new -if-error-
                                   (xor
                                    (match not-13 true
                                     (seq
                                      (seq
                                       (seq
                                        (new $array-inline-47
                                         (seq
                                          (seq
                                           (seq
                                            (ap "get_string failed" $array-inline-47)
                                            (ap "last_seen_block" $array-inline-47)
                                           )
                                           (ap ret-165.$.error $array-inline-47)
                                          )
                                          (canon %init_peer_id% $array-inline-47  #array-inline-47-0)
                                         )
                                        )
                                        (par
                                         (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-47-0])
                                         (null)
                                        )
                                       )
                                       (call %init_peer_id% ("json" "stringify") [#array-inline-47-0] ret-166)
                                      )
                                      (call %init_peer_id% (-spell_id-arg- "store_log") [ret-166] ret-167)
                                     )
                                    )
                                    (seq
                                     (ap :error: -if-error-)
                                     (xor
                                      (match :error:.$.error_code 10001
                                       (seq
                                        (xor
                                         (match ret-165.$.absent true
                                          (ap false not-14)
                                         )
                                         (ap true not-14)
                                        )
                                        (new -if-error-
                                         (xor
                                          (match not-14 true
                                           (ap ret-165.$.value $result-8)
                                          )
                                          (seq
                                           (ap :error: -if-error-)
                                           (xor
                                            (match :error:.$.error_code 10001
                                             (null)
                                            )
                                            (fail -if-error-)
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                      (seq
                                       (seq
                                        (ap :error: -else-error-)
                                        (xor
                                         (match :error:.$.error_code 10001
                                          (ap -if-error- -if-else-error-)
                                         )
                                         (ap -else-error- -if-else-error-)
                                        )
                                       )
                                       (fail -if-else-error-)
                                      )
                                     )
                                    )
                                   )
                                  )
                                 )
                                )
                               )
                               (canon %init_peer_id% $result-8  #-result-fix-0-2)
                              )
                              (ap #-result-fix-0-2 -result-flat-0-2)
                             )
                            )
                            (new -if-else-error-
                             (new -else-error-
                              (new -if-error-
                               (xor
                                (mismatch -result-flat-0-2 []
                                 (seq
                                  (seq
                                   (new $result-9
                                    (seq
                                     (seq
                                      (seq
                                       (call %init_peer_id% ("chain_connector" "hex_cmp") [ret-162_flat.$.[0] -result-flat-0-2.$.[0]] ret-168)
                                       (new -if-else-error-
                                        (new -else-error-
                                         (new -if-error-
                                          (xor
                                           (match ret-168.$.success true
                                            (seq
                                             (call %init_peer_id% ("cmp" "gt") [ret-168.$.ordering 0] gt-0)
                                             (ap gt-0 $result-9)
                                            )
                                           )
                                           (seq
                                            (ap :error: -if-error-)
                                            (xor
                                             (match :error:.$.error_code 10001
                                              (seq
                                               (seq
                                                (seq
                                                 (new $array-inline-48
                                                  (seq
                                                   (seq
                                                    (ap "hex_cmp error" $array-inline-48)
                                                    (ap ret-168.$.error $array-inline-48)
                                                   )
                                                   (canon %init_peer_id% $array-inline-48  #array-inline-48-0)
                                                  )
                                                 )
                                                 (par
                                                  (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-48-0])
                                                  (null)
                                                 )
                                                )
                                                (call %init_peer_id% ("json" "stringify") [#array-inline-48-0] ret-169)
                                               )
                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-169] ret-170)
                                              )
                                             )
                                             (seq
                                              (seq
                                               (ap :error: -else-error-)
                                               (xor
                                                (match :error:.$.error_code 10001
                                                 (ap -if-error- -if-else-error-)
                                                )
                                                (ap -else-error- -if-else-error-)
                                               )
                                              )
                                              (fail -if-else-error-)
                                             )
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                      (canon %init_peer_id% $result-9  #-result-fix-0-3)
                                     )
                                     (ap #-result-fix-0-3 -result-flat-0-3)
                                    )
                                   )
                                   (new $array-inline-49
                                    (seq
                                     (ap true $array-inline-49)
                                     (canon %init_peer_id% $array-inline-49  #array-inline-49-0)
                                    )
                                   )
                                  )
                                  (new -if-error-
                                   (xor
                                    (match -result-flat-0-3 #array-inline-49-0
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (new $array-inline-50
                                              (seq
                                               (seq
                                                (ap "gt_set: will set last seen to" $array-inline-50)
                                                (ap ret-162_flat.$.[0] $array-inline-50)
                                               )
                                               (canon %init_peer_id% $array-inline-50  #array-inline-50-0)
                                              )
                                             )
                                             (par
                                              (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-50-0])
                                              (null)
                                             )
                                            )
                                            (call %init_peer_id% ("json" "stringify") [#array-inline-50-0] ret-171)
                                           )
                                           (call %init_peer_id% (-spell_id-arg- "store_log") [ret-171] ret-172)
                                          )
                                          (new $array-inline-51
                                           (seq
                                            (seq
                                             (ap "will set last seen to" $array-inline-51)
                                             (ap ret-162_flat.$.[0] $array-inline-51)
                                            )
                                            (canon %init_peer_id% $array-inline-51  #array-inline-51-0)
                                           )
                                          )
                                         )
                                         (par
                                          (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-51-0])
                                          (null)
                                         )
                                        )
                                        (call %init_peer_id% ("json" "stringify") [#array-inline-51-0] ret-173)
                                       )
                                       (call %init_peer_id% (-spell_id-arg- "store_log") [ret-173] ret-174)
                                      )
                                      (xor
                                       (seq
                                        (call %init_peer_id% (-spell_id-arg- "set_string") ["last_seen_block" ret-162_flat.$.[0]] ret-175)
                                        (new -if-else-error-
                                         (new -else-error-
                                          (new -if-error-
                                           (xor
                                            (match ret-175.$.success true
                                             (seq
                                              (seq
                                               (seq
                                                (new $array-inline-52
                                                 (seq
                                                  (seq
                                                   (ap "saved last seen" $array-inline-52)
                                                   (ap ret-162_flat.$.[0] $array-inline-52)
                                                  )
                                                  (canon %init_peer_id% $array-inline-52  #array-inline-52-0)
                                                 )
                                                )
                                                (par
                                                 (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-52-0])
                                                 (null)
                                                )
                                               )
                                               (call %init_peer_id% ("json" "stringify") [#array-inline-52-0] ret-176)
                                              )
                                              (call %init_peer_id% (-spell_id-arg- "store_log") [ret-176] ret-177)
                                             )
                                            )
                                            (seq
                                             (ap :error: -if-error-)
                                             (xor
                                              (match :error:.$.error_code 10001
                                               (seq
                                                (seq
                                                 (seq
                                                  (new $array-inline-53
                                                   (seq
                                                    (seq
                                                     (ap "error saving last_seen_block" $array-inline-53)
                                                     (ap ret-175.$.error $array-inline-53)
                                                    )
                                                    (canon %init_peer_id% $array-inline-53  #array-inline-53-0)
                                                   )
                                                  )
                                                  (par
                                                   (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-53-0])
                                                   (null)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("json" "stringify") [#array-inline-53-0] ret-178)
                                                )
                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-178] ret-179)
                                               )
                                              )
                                              (seq
                                               (seq
                                                (ap :error: -else-error-)
                                                (xor
                                                 (match :error:.$.error_code 10001
                                                  (ap -if-error- -if-else-error-)
                                                 )
                                                 (ap -else-error- -if-else-error-)
                                                )
                                               )
                                               (fail -if-else-error-)
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                       (seq
                                        (seq
                                         (seq
                                          (new $array-inline-54
                                           (seq
                                            (seq
                                             (ap "error saving last_seen_block" $array-inline-54)
                                             (ap :error: $array-inline-54)
                                            )
                                            (canon %init_peer_id% $array-inline-54  #array-inline-54-0)
                                           )
                                          )
                                          (par
                                           (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-54-0])
                                           (null)
                                          )
                                         )
                                         (call %init_peer_id% ("json" "stringify") [#array-inline-54-0] ret-180)
                                        )
                                        (call %init_peer_id% (-spell_id-arg- "store_log") [ret-180] ret-181)
                                       )
                                      )
                                     )
                                    )
                                    (seq
                                     (ap :error: -if-error-)
                                     (xor
                                      (match :error:.$.error_code 10001
                                       (null)
                                      )
                                      (fail -if-error-)
                                     )
                                    )
                                   )
                                  )
                                 )
                                )
                                (seq
                                 (ap :error: -if-error-)
                                 (xor
                                  (match :error:.$.error_code 10002
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (new $array-inline-55
                                            (seq
                                             (seq
                                              (ap "increase: will set last seen to" $array-inline-55)
                                              (ap ret-162_flat.$.[0] $array-inline-55)
                                             )
                                             (canon %init_peer_id% $array-inline-55  #array-inline-55-0)
                                            )
                                           )
                                           (par
                                            (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-55-0])
                                            (null)
                                           )
                                          )
                                          (call %init_peer_id% ("json" "stringify") [#array-inline-55-0] ret-182)
                                         )
                                         (call %init_peer_id% (-spell_id-arg- "store_log") [ret-182] ret-183)
                                        )
                                        (new $array-inline-56
                                         (seq
                                          (seq
                                           (ap "will set last seen to" $array-inline-56)
                                           (ap ret-162_flat.$.[0] $array-inline-56)
                                          )
                                          (canon %init_peer_id% $array-inline-56  #array-inline-56-0)
                                         )
                                        )
                                       )
                                       (par
                                        (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-56-0])
                                        (null)
                                       )
                                      )
                                      (call %init_peer_id% ("json" "stringify") [#array-inline-56-0] ret-184)
                                     )
                                     (call %init_peer_id% (-spell_id-arg- "store_log") [ret-184] ret-185)
                                    )
                                    (xor
                                     (seq
                                      (call %init_peer_id% (-spell_id-arg- "set_string") ["last_seen_block" ret-162_flat.$.[0]] ret-186)
                                      (new -if-else-error-
                                       (new -else-error-
                                        (new -if-error-
                                         (xor
                                          (match ret-186.$.success true
                                           (seq
                                            (seq
                                             (seq
                                              (new $array-inline-57
                                               (seq
                                                (seq
                                                 (ap "saved last seen" $array-inline-57)
                                                 (ap ret-162_flat.$.[0] $array-inline-57)
                                                )
                                                (canon %init_peer_id% $array-inline-57  #array-inline-57-0)
                                               )
                                              )
                                              (par
                                               (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-57-0])
                                               (null)
                                              )
                                             )
                                             (call %init_peer_id% ("json" "stringify") [#array-inline-57-0] ret-187)
                                            )
                                            (call %init_peer_id% (-spell_id-arg- "store_log") [ret-187] ret-188)
                                           )
                                          )
                                          (seq
                                           (ap :error: -if-error-)
                                           (xor
                                            (match :error:.$.error_code 10001
                                             (seq
                                              (seq
                                               (seq
                                                (new $array-inline-58
                                                 (seq
                                                  (seq
                                                   (ap "error saving last_seen_block" $array-inline-58)
                                                   (ap ret-186.$.error $array-inline-58)
                                                  )
                                                  (canon %init_peer_id% $array-inline-58  #array-inline-58-0)
                                                 )
                                                )
                                                (par
                                                 (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-58-0])
                                                 (null)
                                                )
                                               )
                                               (call %init_peer_id% ("json" "stringify") [#array-inline-58-0] ret-189)
                                              )
                                              (call %init_peer_id% (-spell_id-arg- "store_log") [ret-189] ret-190)
                                             )
                                            )
                                            (seq
                                             (seq
                                              (ap :error: -else-error-)
                                              (xor
                                               (match :error:.$.error_code 10001
                                                (ap -if-error- -if-else-error-)
                                               )
                                               (ap -else-error- -if-else-error-)
                                              )
                                             )
                                             (fail -if-else-error-)
                                            )
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                     )
                                     (seq
                                      (seq
                                       (seq
                                        (new $array-inline-59
                                         (seq
                                          (seq
                                           (ap "error saving last_seen_block" $array-inline-59)
                                           (ap :error: $array-inline-59)
                                          )
                                          (canon %init_peer_id% $array-inline-59  #array-inline-59-0)
                                         )
                                        )
                                        (par
                                         (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-59-0])
                                         (null)
                                        )
                                       )
                                       (call %init_peer_id% ("json" "stringify") [#array-inline-59-0] ret-191)
                                      )
                                      (call %init_peer_id% (-spell_id-arg- "store_log") [ret-191] ret-192)
                                     )
                                    )
                                   )
                                  )
                                  (seq
                                   (seq
                                    (ap :error: -else-error-)
                                    (xor
                                     (match :error:.$.error_code 10001
                                      (ap -if-error- -if-else-error-)
                                     )
                                     (ap -else-error- -if-else-error-)
                                    )
                                   )
                                   (fail -if-else-error-)
                                  )
                                 )
                                )
                               )
                              )
                             )
                            )
                           )
                          )
                          (seq
                           (ap :error: -if-error-)
                           (xor
                            (match :error:.$.error_code 10002
                             (null)
                            )
                            (fail -if-error-)
                           )
                          )
                         )
                        )
                       )
                      )
                      (seq
                       (ap :error: -if-error-)
                       (xor
                        (match :error:.$.error_code 10002
                         (null)
                        )
                        (fail -if-error-)
                       )
                      )
                     )
                    )
                   )
                  )
                  (seq
                   (ap :error: -if-error-)
                   (xor
                    (match :error:.$.error_code 10002
                     (seq
                      (seq
                       (seq
                        (new $array-inline-60
                         (seq
                          (ap "get_left_boundary returns nil, unable to proceed" $array-inline-60)
                          (canon %init_peer_id% $array-inline-60  #array-inline-60-0)
                         )
                        )
                        (par
                         (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-60-0])
                         (null)
                        )
                       )
                       (call %init_peer_id% ("json" "stringify") [#array-inline-60-0] ret-193)
                      )
                      (call %init_peer_id% (-spell_id-arg- "store_log") [ret-193] ret-194)
                     )
                    )
                    (seq
                     (seq
                      (ap :error: -else-error-)
                      (xor
                       (match :error:.$.error_code 10001
                        (ap -if-error- -if-else-error-)
                       )
                       (ap -else-error- -if-else-error-)
                      )
                     )
                     (fail -if-else-error-)
                    )
                   )
                  )
                 )
                )
               )
              )
             )
             (null)
            )
           )
           (xor
            (seq
             (new $changes-0
              (seq
               (seq
                (seq
                 (seq
                  (seq
                   (new $requests
                    (seq
                     (seq
                      (new -if-error-
                       (xor
                        (mismatch -joined_deals-flat-0 []
                         (new $deal_updates
                          (fold -joined_deals-flat-0 joined_deal-0-0
                           (seq
                            (seq
                             (seq
                              (ap joined_deal-0-0.$.deal_id joined_deal-0-0_flat)
                              (new $state-0
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (call %init_peer_id% (-spell_id-arg- "get_string") [joined_deal-0-0_flat] ret-195)
                                   (xor
                                    (match ret-195.$.success false
                                     (ap ret-195.$.success and)
                                    )
                                    (seq
                                     (xor
                                      (match ret-195.$.absent true
                                       (ap false not-15)
                                      )
                                      (ap true not-15)
                                     )
                                     (ap not-15 and)
                                    )
                                   )
                                  )
                                  (new -if-else-error-
                                   (new -else-error-
                                    (new -if-error-
                                     (xor
                                      (match and true
                                       (xor
                                        (seq
                                         (call %init_peer_id% ("json" "parse") [ret-195.$.value] ret-196)
                                         (ap ret-196 $state-0)
                                        )
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (new $array-inline-61
                                              (seq
                                               (seq
                                                (ap "failed to parse deal state from json" $array-inline-61)
                                                (ap :error: $array-inline-61)
                                               )
                                               (canon %init_peer_id% $array-inline-61  #array-inline-61-0)
                                              )
                                             )
                                             (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" joined_deal-0-0_flat ": "] ret-197)
                                            )
                                            (par
                                             (call %init_peer_id% ("run-console" "print") [ret-197 #array-inline-61-0])
                                             (null)
                                            )
                                           )
                                           (call %init_peer_id% ("json" "stringify") [#array-inline-61-0] ret-198)
                                          )
                                          (call %init_peer_id% ("op" "concat_strings") [ret-197 ret-198] ret-199)
                                         )
                                         (call %init_peer_id% (-spell_id-arg- "store_log") [ret-199] ret-200)
                                        )
                                       )
                                      )
                                      (seq
                                       (ap :error: -if-error-)
                                       (xor
                                        (match :error:.$.error_code 10001
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (new $array-inline-62
                                               (seq
                                                (seq
                                                 (ap "deal state not found:" $array-inline-62)
                                                 (ap ret-195.$.error $array-inline-62)
                                                )
                                                (canon %init_peer_id% $array-inline-62  #array-inline-62-0)
                                               )
                                              )
                                              (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" joined_deal-0-0_flat ": "] ret-201)
                                             )
                                             (par
                                              (call %init_peer_id% ("run-console" "print") [ret-201 #array-inline-62-0])
                                              (null)
                                             )
                                            )
                                            (call %init_peer_id% ("json" "stringify") [#array-inline-62-0] ret-202)
                                           )
                                           (call %init_peer_id% ("op" "concat_strings") [ret-201 ret-202] ret-203)
                                          )
                                          (call %init_peer_id% (-spell_id-arg- "store_log") [ret-203] ret-204)
                                         )
                                        )
                                        (seq
                                         (seq
                                          (ap :error: -else-error-)
                                          (xor
                                           (match :error:.$.error_code 10001
                                            (ap -if-error- -if-else-error-)
                                           )
                                           (ap -else-error- -if-else-error-)
                                          )
                                         )
                                         (fail -if-else-error-)
                                        )
                                       )
                                      )
                                     )
                                    )
                                   )
                                  )
                                 )
                                 (canon %init_peer_id% $state-0  #-state-fix-0)
                                )
                                (ap #-state-fix-0 -state-flat-0)
                               )
                              )
                             )
                             (new -if-error-
                              (xor
                               (mismatch -state-flat-0 []
                                (seq
                                 (seq
                                  (new %DealInfo_obj_map
                                   (seq
                                    (seq
                                     (ap ("deal_id" joined_deal-0-0_flat) %DealInfo_obj_map)
                                     (ap ("worker_id" joined_deal-0-0.$.worker_id) %DealInfo_obj_map)
                                    )
                                    (canon %init_peer_id% %DealInfo_obj_map  DealInfo_obj)
                                   )
                                  )
                                  (new %DealChangesReq_obj_map
                                   (seq
                                    (seq
                                     (ap ("deal_info" DealInfo_obj) %DealChangesReq_obj_map)
                                     (ap ("left_boundary" -state-flat-0.$.[0].left_boundary) %DealChangesReq_obj_map)
                                    )
                                    (canon %init_peer_id% %DealChangesReq_obj_map  DealChangesReq_obj)
                                   )
                                  )
                                 )
                                 (ap DealChangesReq_obj $requests)
                                )
                               )
                               (seq
                                (ap :error: -if-error-)
                                (xor
                                 (match :error:.$.error_code 10002
                                  (null)
                                 )
                                 (fail -if-error-)
                                )
                               )
                              )
                             )
                            )
                            (next joined_deal-0-0)
                           )
                          )
                         )
                        )
                        (seq
                         (ap :error: -if-error-)
                         (xor
                          (match :error:.$.error_code 10002
                           (null)
                          )
                          (fail -if-error-)
                         )
                        )
                       )
                      )
                      (canon %init_peer_id% $requests  #-requests-fix-0)
                     )
                     (ap #-requests-fix-0 -requests-flat-0)
                    )
                   )
                   (ap -requests-flat-0 -requests-flat-0_to_functor)
                  )
                  (ap -requests-flat-0_to_functor.length -requests-flat-0_length)
                 )
                 (new -if-error-
                  (xor
                   (mismatch -requests-flat-0_length 0
                    (seq
                     (seq
                      (seq
                       (seq
                        (seq
                         (new $array-inline-63
                          (seq
                           (seq
                            (seq
                             (seq
                              (seq
                               (ap -requests-flat-0 -requests-flat-0_to_functor-0)
                               (ap -requests-flat-0_to_functor-0.length -requests-flat-0_length-0)
                              )
                              (ap "try to find updates for" $array-inline-63)
                             )
                             (ap -requests-flat-0_length-0 $array-inline-63)
                            )
                            (ap "deals" $array-inline-63)
                           )
                           (canon %init_peer_id% $array-inline-63  #array-inline-63-0)
                          )
                         )
                         (par
                          (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-63-0])
                          (null)
                         )
                        )
                        (call %init_peer_id% ("json" "stringify") [#array-inline-63-0] ret-205)
                       )
                       (call %init_peer_id% (-spell_id-arg- "store_log") [ret-205] ret-206)
                      )
                      (call %init_peer_id% ("chain_connector" "poll_deal_changes") [-chain-arg-.$.api_endpoint -requests-flat-0] ret-207)
                     )
                     (new -if-else-error-
                      (new -else-error-
                       (new -if-error-
                        (xor
                         (match ret-207.$.success true
                          (ap ret-207.$.changes $changes-0)
                         )
                         (seq
                          (ap :error: -if-error-)
                          (xor
                           (match :error:.$.error_code 10001
                            (seq
                             (seq
                              (seq
                               (new $array-inline-64
                                (seq
                                 (seq
                                  (ap "error retrieving deal changes from chain" $array-inline-64)
                                  (ap ret-207.$.error.[0] $array-inline-64)
                                 )
                                 (canon %init_peer_id% $array-inline-64  #array-inline-64-0)
                                )
                               )
                               (par
                                (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-64-0])
                                (null)
                               )
                              )
                              (call %init_peer_id% ("json" "stringify") [#array-inline-64-0] ret-208)
                             )
                             (call %init_peer_id% (-spell_id-arg- "store_log") [ret-208] ret-209)
                            )
                           )
                           (seq
                            (seq
                             (ap :error: -else-error-)
                             (xor
                              (match :error:.$.error_code 10001
                               (ap -if-error- -if-else-error-)
                              )
                              (ap -else-error- -if-else-error-)
                             )
                            )
                            (fail -if-else-error-)
                           )
                          )
                         )
                        )
                       )
                      )
                     )
                    )
                   )
                   (seq
                    (ap :error: -if-error-)
                    (xor
                     (match :error:.$.error_code 10002
                      (null)
                     )
                     (fail -if-error-)
                    )
                   )
                  )
                 )
                )
                (canon %init_peer_id% $changes-0  #-changes-fix-0)
               )
               (ap #-changes-fix-0 -changes-flat-0)
              )
             )
             (new -if-error-
              (xor
               (mismatch -changes-flat-0 []
                (seq
                 (fold -changes-flat-0.$.[0] change-0
                  (seq
                   (seq
                    (seq
                     (ap change-0.$.deal_info change-0_flat)
                     (ap change-0_flat.$.deal_id change-0_flat_flat)
                    )
                    (new -if-else-error-
                     (new -else-error-
                      (new -if-error-
                       (xor
                        (match change-0.$.success true
                         (new -if-error-
                          (xor
                           (mismatch change-0.$.log []
                            (seq
                             (seq
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (new $array-inline-65
                                                 (seq
                                                  (seq
                                                   (ap "found a deal changed log on block" $array-inline-65)
                                                   (ap change-0.$.log.[0].block_number $array-inline-65)
                                                  )
                                                  (canon %init_peer_id% $array-inline-65  #array-inline-65-0)
                                                 )
                                                )
                                                (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" change-0_flat_flat ": "] ret-210)
                                               )
                                               (par
                                                (call %init_peer_id% ("run-console" "print") [ret-210 #array-inline-65-0])
                                                (null)
                                               )
                                              )
                                              (call %init_peer_id% ("json" "stringify") [#array-inline-65-0] ret-211)
                                             )
                                             (call %init_peer_id% ("op" "concat_strings") [ret-210 ret-211] ret-212)
                                            )
                                            (call %init_peer_id% (-spell_id-arg- "store_log") [ret-212] ret-213)
                                           )
                                           (ap change-0.$.deal_info.deal_id change-0_flat-0)
                                          )
                                          (ap change-0.$.deal_info.worker_id change-0_flat-1)
                                         )
                                         (call %init_peer_id% ("json" "stringify") [change-0.$.log.[0].info.app_cid] ret-214)
                                        )
                                        (new $array-inline-66
                                         (seq
                                          (seq
                                           (seq
                                            (ap "sending the latest update to the worker" $array-inline-66)
                                            (ap change-0_flat-1 $array-inline-66)
                                           )
                                           (ap ret-214 $array-inline-66)
                                          )
                                          (canon %init_peer_id% $array-inline-66  #array-inline-66-0)
                                         )
                                        )
                                       )
                                       (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" change-0_flat-0 ": "] ret-215)
                                      )
                                      (par
                                       (call %init_peer_id% ("run-console" "print") [ret-215 #array-inline-66-0])
                                       (null)
                                      )
                                     )
                                     (call %init_peer_id% ("json" "stringify") [#array-inline-66-0] ret-216)
                                    )
                                    (call %init_peer_id% ("op" "concat_strings") [ret-215 ret-216] ret-217)
                                   )
                                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-217] ret-218)
                                  )
                                  (xor
                                   (seq
                                    (seq
                                     (new $-ephemeral-stream-
                                      (new #-ephemeral-canon-
                                       (canon -relay- $-ephemeral-stream-  #-ephemeral-canon-)
                                      )
                                     )
                                     (call change-0_flat-1 ("worker-spell" "set_string") ["worker_def_cid" ret-214] ret-219)
                                    )
                                    (new $-ephemeral-stream-
                                     (new #-ephemeral-canon-
                                      (canon -relay- $-ephemeral-stream-  #-ephemeral-canon-)
                                     )
                                    )
                                   )
                                   (seq
                                    (seq
                                     (new $-ephemeral-stream-
                                      (new #-ephemeral-canon-
                                       (canon -relay- $-ephemeral-stream-  #-ephemeral-canon-)
                                      )
                                     )
                                     (new $-ephemeral-stream-
                                      (new #-ephemeral-canon-
                                       (canon %init_peer_id% $-ephemeral-stream-  #-ephemeral-canon-)
                                      )
                                     )
                                    )
                                    (fail :error:)
                                   )
                                  )
                                 )
                                 (ap change-0.$.log change-0_flat-2)
                                )
                                (ap change-0_flat-2.$.[0].block_number change-0_flat-2_flat)
                               )
                               (new %DealState_obj-0_map
                                (seq
                                 (ap ("left_boundary" change-0_flat-2_flat) %DealState_obj-0_map)
                                 (canon %init_peer_id% %DealState_obj-0_map  DealState_obj-0)
                                )
                               )
                              )
                              (call %init_peer_id% ("json" "stringify") [DealState_obj-0] ret-220)
                             )
                             (call %init_peer_id% (-spell_id-arg- "set_string") [change-0_flat_flat ret-220] ret-221)
                            )
                           )
                           (seq
                            (ap :error: -if-error-)
                            (xor
                             (match :error:.$.error_code 10002
                              (null)
                             )
                             (fail -if-error-)
                            )
                           )
                          )
                         )
                        )
                        (seq
                         (ap :error: -if-error-)
                         (xor
                          (match :error:.$.error_code 10001
                           (seq
                            (seq
                             (seq
                              (seq
                               (seq
                                (new $array-inline-67
                                 (seq
                                  (seq
                                   (ap "error retrieving deal change" $array-inline-67)
                                   (ap change-0.$.error $array-inline-67)
                                  )
                                  (canon %init_peer_id% $array-inline-67  #array-inline-67-0)
                                 )
                                )
                                (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" change-0_flat_flat ": "] ret-222)
                               )
                               (par
                                (call %init_peer_id% ("run-console" "print") [ret-222 #array-inline-67-0])
                                (null)
                               )
                              )
                              (call %init_peer_id% ("json" "stringify") [#array-inline-67-0] ret-223)
                             )
                             (call %init_peer_id% ("op" "concat_strings") [ret-222 ret-223] ret-224)
                            )
                            (call %init_peer_id% (-spell_id-arg- "store_log") [ret-224] ret-225)
                           )
                          )
                          (seq
                           (seq
                            (ap :error: -else-error-)
                            (xor
                             (match :error:.$.error_code 10001
                              (ap -if-error- -if-else-error-)
                             )
                             (ap -else-error- -if-else-error-)
                            )
                           )
                           (fail -if-else-error-)
                          )
                         )
                        )
                       )
                      )
                     )
                    )
                   )
                   (next change-0)
                  )
                 )
                 (par
                  (fold -changes-flat-0.$.[0] change-1
                   (par
                    (seq
                     (seq
                      (seq
                       (seq
                        (seq
                         (seq
                          (ap change-1.$.deal_info change-1_flat)
                          (ap change-1_flat.$.deal_id change-1_flat_flat)
                         )
                         (call %init_peer_id% ("chain_connector" "hex_min") [change-1.$.right_boundary -latest-flat-0.$.[0]] ret-226)
                        )
                        (xor
                         (match ret-226.$.success true
                          (ap false not-16)
                         )
                         (ap true not-16)
                        )
                       )
                       (new -if-error-
                        (xor
                         (match not-16 true
                          (seq
                           (seq
                            (seq
                             (new $array-inline-68
                              (seq
                               (seq
                                (seq
                                 (ap "hex_min failed" $array-inline-68)
                                 (ap change-1.$.right_boundary $array-inline-68)
                                )
                                (ap -latest-flat-0.$.[0] $array-inline-68)
                               )
                               (canon %init_peer_id% $array-inline-68  #array-inline-68-0)
                              )
                             )
                             (par
                              (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-68-0])
                              (null)
                             )
                            )
                            (call %init_peer_id% ("json" "stringify") [#array-inline-68-0] ret-227)
                           )
                           (call %init_peer_id% (-spell_id-arg- "store_log") [ret-227] ret-228)
                          )
                         )
                         (seq
                          (ap :error: -if-error-)
                          (xor
                           (match :error:.$.error_code 10001
                            (null)
                           )
                           (fail -if-error-)
                          )
                         )
                        )
                       )
                      )
                      (ap ret-226.$.hex ret-226_flat)
                     )
                     (new -if-error-
                      (xor
                       (mismatch ret-226_flat []
                        (seq
                         (seq
                          (seq
                           (seq
                            (call %init_peer_id% ("chain_connector" "hex_add") [ret-226_flat.$.[0] 1] ret-229)
                            (xor
                             (match ret-229.$.success true
                              (ap false not-17)
                             )
                             (ap true not-17)
                            )
                           )
                           (new -if-error-
                            (xor
                             (match not-17 true
                              (seq
                               (seq
                                (seq
                                 (new $array-inline-69
                                  (seq
                                   (seq
                                    (seq
                                     (ap "hex_add failed" $array-inline-69)
                                     (ap ret-226_flat.$.[0] $array-inline-69)
                                    )
                                    (ap 1 $array-inline-69)
                                   )
                                   (canon %init_peer_id% $array-inline-69  #array-inline-69-0)
                                  )
                                 )
                                 (par
                                  (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-69-0])
                                  (null)
                                 )
                                )
                                (call %init_peer_id% ("json" "stringify") [#array-inline-69-0] ret-230)
                               )
                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-230] ret-231)
                              )
                             )
                             (seq
                              (ap :error: -if-error-)
                              (xor
                               (match :error:.$.error_code 10001
                                (null)
                               )
                               (fail -if-error-)
                              )
                             )
                            )
                           )
                          )
                          (ap ret-229.$.hex ret-229_flat)
                         )
                         (new -if-error-
                          (xor
                           (mismatch ret-229_flat []
                            (seq
                             (seq
                              (new %DealState_obj-1_map
                               (seq
                                (ap ("left_boundary" ret-229_flat.$.[0]) %DealState_obj-1_map)
                                (canon %init_peer_id% %DealState_obj-1_map  DealState_obj-1)
                               )
                              )
                              (call %init_peer_id% ("json" "stringify") [DealState_obj-1] ret-232)
                             )
                             (call %init_peer_id% (-spell_id-arg- "set_string") [change-1_flat_flat ret-232] ret-233)
                            )
                           )
                           (seq
                            (ap :error: -if-error-)
                            (xor
                             (match :error:.$.error_code 10002
                              (null)
                             )
                             (fail -if-error-)
                            )
                           )
                          )
                         )
                        )
                       )
                       (seq
                        (ap :error: -if-error-)
                        (xor
                         (match :error:.$.error_code 10002
                          (null)
                         )
                         (fail -if-error-)
                        )
                       )
                      )
                     )
                    )
                    (next change-1)
                   )
                   (never)
                  )
                  (null)
                 )
                )
               )
               (seq
                (ap :error: -if-error-)
                (xor
                 (match :error:.$.error_code 10002
                  (null)
                 )
                 (fail -if-error-)
                )
               )
              )
             )
            )
            (null)
           )
          )
          (xor
           (new $deal_ids-0
            (seq
             (seq
              (fold -joined_deals-flat-0 joined_deal-1-0
               (seq
                (ap joined_deal-1-0.$.deal_id $deal_ids-0)
                (next joined_deal-1-0)
               )
              )
              (canon %init_peer_id% $deal_ids-0  #deal_ids-0_canon)
             )
             (new -if-error-
              (xor
               (mismatch #deal_ids-0_canon []
                (seq
                 (seq
                  (seq
                   (canon %init_peer_id% $deal_ids-0  #deal_ids-0_canon-0)
                   (call %init_peer_id% ("chain_connector" "get_status_batch") [-chain-arg-.$.api_endpoint #deal_ids-0_canon-0] ret-234)
                  )
                  (xor
                   (match ret-234.$.success true
                    (ap false not-18)
                   )
                   (ap true not-18)
                  )
                 )
                 (new -if-else-error-
                  (new -else-error-
                   (new -if-error-
                    (xor
                     (match not-18 true
                      (seq
                       (seq
                        (seq
                         (new $array-inline-70
                          (seq
                           (seq
                            (ap "couldn't obtain deal statuses, error: " $array-inline-70)
                            (ap ret-234.$.error.[0] $array-inline-70)
                           )
                           (canon %init_peer_id% $array-inline-70  #array-inline-70-0)
                          )
                         )
                         (par
                          (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-70-0])
                          (null)
                         )
                        )
                        (call %init_peer_id% ("json" "stringify") [#array-inline-70-0] ret-235)
                       )
                       (call %init_peer_id% (-spell_id-arg- "store_log") [ret-235] ret-236)
                      )
                     )
                     (seq
                      (ap :error: -if-error-)
                      (xor
                       (match :error:.$.error_code 10001
                        (seq
                         (seq
                          (seq
                           (seq
                            (new $array-inline-71
                             (seq
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (ap ret-234.$.statuses ret-234_flat)
                                   (ap ret-234_flat ret-234_flat_to_functor)
                                  )
                                  (ap ret-234_flat_to_functor.length ret-234_flat_length)
                                 )
                                 (ap "found statuses for" $array-inline-71)
                                )
                                (ap ret-234_flat_length $array-inline-71)
                               )
                               (ap "deals" $array-inline-71)
                              )
                              (canon %init_peer_id% $array-inline-71  #array-inline-71-0)
                             )
                            )
                            (par
                             (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-71-0])
                             (null)
                            )
                           )
                           (call %init_peer_id% ("json" "stringify") [#array-inline-71-0] ret-237)
                          )
                          (call %init_peer_id% (-spell_id-arg- "store_log") [ret-237] ret-238)
                         )
                         (fold ret-234.$.statuses deal_status-1-0
                          (seq
                           (seq
                            (xor
                             (match deal_status-1-0.$.success true
                              (ap false not-19)
                             )
                             (ap true not-19)
                            )
                            (new -if-else-error-
                             (new -else-error-
                              (new -if-error-
                               (xor
                                (match not-19 true
                                 (seq
                                  (seq
                                   (seq
                                    (new $array-inline-72
                                     (seq
                                      (seq
                                       (ap "couldn't obtain deal status, error:" $array-inline-72)
                                       (ap deal_status-1-0.$.error.[0] $array-inline-72)
                                      )
                                      (canon %init_peer_id% $array-inline-72  #array-inline-72-0)
                                     )
                                    )
                                    (par
                                     (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-72-0])
                                     (null)
                                    )
                                   )
                                   (call %init_peer_id% ("json" "stringify") [#array-inline-72-0] ret-239)
                                  )
                                  (call %init_peer_id% (-spell_id-arg- "store_log") [ret-239] ret-240)
                                 )
                                )
                                (seq
                                 (ap :error: -if-error-)
                                 (xor
                                  (match :error:.$.error_code 10001
                                   (new -if-else-error-
                                    (new -else-error-
                                     (new -if-error-
                                      (xor
                                       (match deal_status-1-0.$.status "ACTIVE"
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (new $array-inline-73
                                              (seq
                                               (seq
                                                (ap "couldn't activate a worker" $array-inline-73)
                                                (ap :error: $array-inline-73)
                                               )
                                               (canon %init_peer_id% $array-inline-73  #array-inline-73-0)
                                              )
                                             )
                                             (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-1-0.$.deal_id ": "] ret-241)
                                            )
                                            (par
                                             (call %init_peer_id% ("run-console" "print") [ret-241 #array-inline-73-0])
                                             (null)
                                            )
                                           )
                                           (call %init_peer_id% ("json" "stringify") [#array-inline-73-0] ret-242)
                                          )
                                          (call %init_peer_id% ("op" "concat_strings") [ret-241 ret-242] ret-243)
                                         )
                                         (call %init_peer_id% (-spell_id-arg- "store_log") [ret-243] ret-244)
                                        )
                                       )
                                       (seq
                                        (ap :error: -if-error-)
                                        (xor
                                         (match :error:.$.error_code 10001
                                          (new -if-else-error-
                                           (new -else-error-
                                            (new -if-error-
                                             (xor
                                              (match deal_status-1-0.$.status "INACTIVE"
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (new $array-inline-74
                                                     (seq
                                                      (seq
                                                       (ap "couldn't deactivate a worker" $array-inline-74)
                                                       (ap :error: $array-inline-74)
                                                      )
                                                      (canon %init_peer_id% $array-inline-74  #array-inline-74-0)
                                                     )
                                                    )
                                                    (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-1-0.$.deal_id ": "] ret-245)
                                                   )
                                                   (par
                                                    (call %init_peer_id% ("run-console" "print") [ret-245 #array-inline-74-0])
                                                    (null)
                                                   )
                                                  )
                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-74-0] ret-246)
                                                 )
                                                 (call %init_peer_id% ("op" "concat_strings") [ret-245 ret-246] ret-247)
                                                )
                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-247] ret-248)
                                               )
                                              )
                                              (seq
                                               (ap :error: -if-error-)
                                               (xor
                                                (match :error:.$.error_code 10001
                                                 (new -if-else-error-
                                                  (new -else-error-
                                                   (new -if-error-
                                                    (xor
                                                     (match deal_status-1-0.$.status "ENDED"
                                                      (seq
                                                       (call %init_peer_id% ("worker" "get_worker_id") [deal_status-1-0.$.deal_id] ret-249)
                                                       (new -if-else-error-
                                                        (new -else-error-
                                                         (new -if-error-
                                                          (xor
                                                           (mismatch ret-249 []
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-1-0.$.deal_id ": "] ret-250)
                                                                  (par
                                                                   (call %init_peer_id% ("run-console" "print") [ret-250 "removing the worker and the deal state from kv"])
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("json" "stringify") ["removing the worker and the deal state from kv"] ret-251)
                                                                )
                                                                (call %init_peer_id% ("op" "concat_strings") [ret-250 ret-251] ret-252)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-252] ret-253)
                                                              )
                                                              (xor
                                                               (call %init_peer_id% ("worker" "remove") [ret-249.$.[0]])
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (new $array-inline-75
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (ap "couldn't remove a worker" $array-inline-75)
                                                                        (ap ret-249.$.[0] $array-inline-75)
                                                                       )
                                                                       (ap :error: $array-inline-75)
                                                                      )
                                                                      (canon %init_peer_id% $array-inline-75  #array-inline-75-0)
                                                                     )
                                                                    )
                                                                    (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-1-0.$.deal_id ": "] ret-254)
                                                                   )
                                                                   (par
                                                                    (call %init_peer_id% ("run-console" "print") [ret-254 #array-inline-75-0])
                                                                    (null)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-75-0] ret-255)
                                                                 )
                                                                 (call %init_peer_id% ("op" "concat_strings") [ret-254 ret-255] ret-256)
                                                                )
                                                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-256] ret-257)
                                                               )
                                                              )
                                                             )
                                                             (xor
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (new %JoinedDeal_obj-1_map
                                                                    (seq
                                                                     (seq
                                                                      (ap ("deal_id" deal_status-1-0.$.deal_id) %JoinedDeal_obj-1_map)
                                                                      (ap ("worker_id" ret-249.$.[0]) %JoinedDeal_obj-1_map)
                                                                     )
                                                                     (canon %init_peer_id% %JoinedDeal_obj-1_map  JoinedDeal_obj-1)
                                                                    )
                                                                   )
                                                                   (call %init_peer_id% ("json" "stringify") [JoinedDeal_obj-1] ret-258)
                                                                  )
                                                                  (call %init_peer_id% (-spell_id-arg- "list_remove_string") ["joined_deals" ret-258] ret-259)
                                                                 )
                                                                 (call %init_peer_id% (-spell_id-arg- "remove_key") [deal_status-1-0.$.deal_id] ret-260)
                                                                )
                                                                (call %init_peer_id% ("op" "concat_strings") ["removed_state:" deal_status-1-0.$.deal_id] ret-261)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "remove_key") [ret-261] ret-262)
                                                              )
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (new $array-inline-76
                                                                    (seq
                                                                     (seq
                                                                      (ap "couldn't remove the deal" $array-inline-76)
                                                                      (ap :error: $array-inline-76)
                                                                     )
                                                                     (canon %init_peer_id% $array-inline-76  #array-inline-76-0)
                                                                    )
                                                                   )
                                                                   (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-1-0.$.deal_id ": "] ret-263)
                                                                  )
                                                                  (par
                                                                   (call %init_peer_id% ("run-console" "print") [ret-263 #array-inline-76-0])
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("json" "stringify") [#array-inline-76-0] ret-264)
                                                                )
                                                                (call %init_peer_id% ("op" "concat_strings") [ret-263 ret-264] ret-265)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-265] ret-266)
                                                              )
                                                             )
                                                            )
                                                           )
                                                           (seq
                                                            (ap :error: -if-error-)
                                                            (xor
                                                             (match :error:.$.error_code 10002
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" deal_status-1-0.$.deal_id ": "] ret-267)
                                                                  (par
                                                                   (call %init_peer_id% ("run-console" "print") [ret-267 "deal doesn't have associated worker O.o"])
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("json" "stringify") ["deal doesn't have associated worker O.o"] ret-268)
                                                                )
                                                                (call %init_peer_id% ("op" "concat_strings") [ret-267 ret-268] ret-269)
                                                               )
                                                               (call %init_peer_id% (-spell_id-arg- "store_log") [ret-269] ret-270)
                                                              )
                                                             )
                                                             (seq
                                                              (seq
                                                               (ap :error: -else-error-)
                                                               (xor
                                                                (match :error:.$.error_code 10001
                                                                 (ap -if-error- -if-else-error-)
                                                                )
                                                                (ap -else-error- -if-else-error-)
                                                               )
                                                              )
                                                              (fail -if-else-error-)
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                        )
                                                       )
                                                      )
                                                     )
                                                     (seq
                                                      (ap :error: -if-error-)
                                                      (xor
                                                       (match :error:.$.error_code 10001
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (new $array-inline-77
                                                            (seq
                                                             (seq
                                                              (ap "unsupported deal status: " $array-inline-77)
                                                              (ap deal_status-1-0 $array-inline-77)
                                                             )
                                                             (canon %init_peer_id% $array-inline-77  #array-inline-77-0)
                                                            )
                                                           )
                                                           (par
                                                            (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-77-0])
                                                            (null)
                                                           )
                                                          )
                                                          (call %init_peer_id% ("json" "stringify") [#array-inline-77-0] ret-271)
                                                         )
                                                         (call %init_peer_id% (-spell_id-arg- "store_log") [ret-271] ret-272)
                                                        )
                                                       )
                                                       (seq
                                                        (seq
                                                         (ap :error: -else-error-)
                                                         (xor
                                                          (match :error:.$.error_code 10001
                                                           (ap -if-error- -if-else-error-)
                                                          )
                                                          (ap -else-error- -if-else-error-)
                                                         )
                                                        )
                                                        (fail -if-else-error-)
                                                       )
                                                      )
                                                     )
                                                    )
                                                   )
                                                  )
                                                 )
                                                )
                                                (seq
                                                 (seq
                                                  (ap :error: -else-error-)
                                                  (xor
                                                   (match :error:.$.error_code 10001
                                                    (ap -if-error- -if-else-error-)
                                                   )
                                                   (ap -else-error- -if-else-error-)
                                                  )
                                                 )
                                                 (fail -if-else-error-)
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                         (seq
                                          (seq
                                           (ap :error: -else-error-)
                                           (xor
                                            (match :error:.$.error_code 10001
                                             (ap -if-error- -if-else-error-)
                                            )
                                            (ap -else-error- -if-else-error-)
                                           )
                                          )
                                          (fail -if-else-error-)
                                         )
                                        )
                                       )
                                      )
                                     )
                                    )
                                   )
                                  )
                                  (seq
                                   (seq
                                    (ap :error: -else-error-)
                                    (xor
                                     (match :error:.$.error_code 10001
                                      (ap -if-error- -if-else-error-)
                                     )
                                     (ap -else-error- -if-else-error-)
                                    )
                                   )
                                   (fail -if-else-error-)
                                  )
                                 )
                                )
                               )
                              )
                             )
                            )
                           )
                           (next deal_status-1-0)
                          )
                         )
                        )
                       )
                       (seq
                        (seq
                         (ap :error: -else-error-)
                         (xor
                          (match :error:.$.error_code 10001
                           (ap -if-error- -if-else-error-)
                          )
                          (ap -else-error- -if-else-error-)
                         )
                        )
                        (fail -if-else-error-)
                       )
                      )
                     )
                    )
                   )
                  )
                 )
                )
               )
               (seq
                (ap :error: -if-error-)
                (xor
                 (match :error:.$.error_code 10002
                  (null)
                 )
                 (fail -if-error-)
                )
               )
              )
             )
            )
           )
           (null)
          )
         )
         (xor
          (seq
           (seq
            (ap -joined_deals-flat-0 -joined_deals-flat-0_to_functor)
            (ap -joined_deals-flat-0_to_functor.length -joined_deals-flat-0_length)
           )
           (new -if-error-
            (xor
             (mismatch -joined_deals-flat-0_length 0
              (new $reqs
               (seq
                (seq
                 (fold -joined_deals-flat-0 joined_deal-3-0
                  (seq
                   (seq
                    (seq
                     (seq
                      (ap joined_deal-3-0.$.deal_id joined_deal-3-0_flat)
                      (call %init_peer_id% ("op" "concat_strings") ["removed_state:" joined_deal-3-0_flat] ret-273)
                     )
                     (new $state-4
                      (seq
                       (seq
                        (seq
                         (seq
                          (call %init_peer_id% (-spell_id-arg- "get_string") [joined_deal-3-0_flat] ret-274)
                          (xor
                           (match ret-274.$.success false
                            (ap ret-274.$.success and-0)
                           )
                           (seq
                            (xor
                             (match ret-274.$.absent true
                              (ap false not-20)
                             )
                             (ap true not-20)
                            )
                            (ap not-20 and-0)
                           )
                          )
                         )
                         (new -if-else-error-
                          (new -else-error-
                           (new -if-error-
                            (xor
                             (match and-0 true
                              (xor
                               (seq
                                (call %init_peer_id% ("json" "parse") [ret-274.$.value] ret-275)
                                (ap ret-275 $state-4)
                               )
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (new $array-inline-78
                                     (seq
                                      (seq
                                       (ap "failed to parse deal state from json" $array-inline-78)
                                       (ap :error: $array-inline-78)
                                      )
                                      (canon %init_peer_id% $array-inline-78  #array-inline-78-0)
                                     )
                                    )
                                    (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" joined_deal-3-0_flat ": "] ret-276)
                                   )
                                   (par
                                    (call %init_peer_id% ("run-console" "print") [ret-276 #array-inline-78-0])
                                    (null)
                                   )
                                  )
                                  (call %init_peer_id% ("json" "stringify") [#array-inline-78-0] ret-277)
                                 )
                                 (call %init_peer_id% ("op" "concat_strings") [ret-276 ret-277] ret-278)
                                )
                                (call %init_peer_id% (-spell_id-arg- "store_log") [ret-278] ret-279)
                               )
                              )
                             )
                             (seq
                              (ap :error: -if-error-)
                              (xor
                               (match :error:.$.error_code 10001
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (new $array-inline-79
                                      (seq
                                       (seq
                                        (ap "deal state not found:" $array-inline-79)
                                        (ap ret-274.$.error $array-inline-79)
                                       )
                                       (canon %init_peer_id% $array-inline-79  #array-inline-79-0)
                                      )
                                     )
                                     (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" joined_deal-3-0_flat ": "] ret-280)
                                    )
                                    (par
                                     (call %init_peer_id% ("run-console" "print") [ret-280 #array-inline-79-0])
                                     (null)
                                    )
                                   )
                                   (call %init_peer_id% ("json" "stringify") [#array-inline-79-0] ret-281)
                                  )
                                  (call %init_peer_id% ("op" "concat_strings") [ret-280 ret-281] ret-282)
                                 )
                                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-282] ret-283)
                                )
                               )
                               (seq
                                (seq
                                 (ap :error: -else-error-)
                                 (xor
                                  (match :error:.$.error_code 10001
                                   (ap -if-error- -if-else-error-)
                                  )
                                  (ap -else-error- -if-else-error-)
                                 )
                                )
                                (fail -if-else-error-)
                               )
                              )
                             )
                            )
                           )
                          )
                         )
                        )
                        (canon %init_peer_id% $state-4  #-state-fix-0-0)
                       )
                       (ap #-state-fix-0-0 -state-flat-0-0)
                      )
                     )
                    )
                    (new -if-error-
                     (xor
                      (mismatch -state-flat-0-0 []
                       (seq
                        (new %DealPeerRemovedReq_obj_map
                         (seq
                          (seq
                           (ap ("deal_id" joined_deal-3-0_flat) %DealPeerRemovedReq_obj_map)
                           (ap ("left_boundary" -state-flat-0-0.$.[0].left_boundary) %DealPeerRemovedReq_obj_map)
                          )
                          (canon %init_peer_id% %DealPeerRemovedReq_obj_map  DealPeerRemovedReq_obj)
                         )
                        )
                        (ap DealPeerRemovedReq_obj $reqs)
                       )
                      )
                      (seq
                       (ap :error: -if-error-)
                       (xor
                        (match :error:.$.error_code 10002
                         (null)
                        )
                        (fail -if-error-)
                       )
                      )
                     )
                    )
                   )
                   (next joined_deal-3-0)
                  )
                 )
                 (canon %init_peer_id% $reqs  #reqs_canon)
                )
                (new -if-error-
                 (xor
                  (mismatch #reqs_canon []
                   (seq
                    (seq
                     (seq
                      (canon %init_peer_id% $reqs  #reqs_canon-0)
                      (call %init_peer_id% ("chain_connector" "poll_deal_peer_removed_batch") [-chain-arg-.$.api_endpoint #reqs_canon-0] ret-284)
                     )
                     (xor
                      (match ret-284.$.success true
                       (ap false not-21)
                      )
                      (ap true not-21)
                     )
                    )
                    (new -if-else-error-
                     (new -else-error-
                      (new -if-error-
                       (xor
                        (match not-21 true
                         (seq
                          (seq
                           (seq
                            (new $array-inline-80
                             (seq
                              (seq
                               (ap "can't find if deals were removed from provider:" $array-inline-80)
                               (ap ret-284.$.error $array-inline-80)
                              )
                              (canon %init_peer_id% $array-inline-80  #array-inline-80-0)
                             )
                            )
                            (par
                             (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-80-0])
                             (null)
                            )
                           )
                           (call %init_peer_id% ("json" "stringify") [#array-inline-80-0] ret-285)
                          )
                          (call %init_peer_id% (-spell_id-arg- "store_log") [ret-285] ret-286)
                         )
                        )
                        (seq
                         (ap :error: -if-error-)
                         (xor
                          (match :error:.$.error_code 10001
                           (fold ret-284.$.result removed-0
                            (seq
                             (seq
                              (xor
                               (match removed-0.$.success true
                                (ap false not-22)
                               )
                               (ap true not-22)
                              )
                              (new -if-else-error-
                               (new -else-error-
                                (new -if-error-
                                 (xor
                                  (match not-22 true
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (new $array-inline-81
                                         (seq
                                          (seq
                                           (ap "can't find if the deal was removed from provider" $array-inline-81)
                                           (ap removed-0.$.error $array-inline-81)
                                          )
                                          (canon %init_peer_id% $array-inline-81  #array-inline-81-0)
                                         )
                                        )
                                        (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" removed-0.$.deal_id ": "] ret-287)
                                       )
                                       (par
                                        (call %init_peer_id% ("run-console" "print") [ret-287 #array-inline-81-0])
                                        (null)
                                       )
                                      )
                                      (call %init_peer_id% ("json" "stringify") [#array-inline-81-0] ret-288)
                                     )
                                     (call %init_peer_id% ("op" "concat_strings") [ret-287 ret-288] ret-289)
                                    )
                                    (call %init_peer_id% (-spell_id-arg- "store_log") [ret-289] ret-290)
                                   )
                                  )
                                  (seq
                                   (ap :error: -if-error-)
                                   (xor
                                    (match :error:.$.error_code 10001
                                     (new -if-else-error-
                                      (new -else-error-
                                       (new -if-error-
                                        (xor
                                         (match removed-0.$.is_removed true
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (new $array-inline-82
                                                  (seq
                                                   (ap "the deal is removed from the provider" $array-inline-82)
                                                   (canon %init_peer_id% $array-inline-82  #array-inline-82-0)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" removed-0.$.deal_id ": "] ret-291)
                                                )
                                                (par
                                                 (call %init_peer_id% ("run-console" "print") [ret-291 #array-inline-82-0])
                                                 (null)
                                                )
                                               )
                                               (call %init_peer_id% ("json" "stringify") [#array-inline-82-0] ret-292)
                                              )
                                              (call %init_peer_id% ("op" "concat_strings") [ret-291 ret-292] ret-293)
                                             )
                                             (call %init_peer_id% (-spell_id-arg- "store_log") [ret-293] ret-294)
                                            )
                                            (call %init_peer_id% ("worker" "get_worker_id") [removed-0.$.deal_id] ret-295)
                                           )
                                           (new -if-else-error-
                                            (new -else-error-
                                             (new -if-error-
                                              (xor
                                               (mismatch ret-295 []
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" removed-0.$.deal_id ": "] ret-296)
                                                      (par
                                                       (call %init_peer_id% ("run-console" "print") [ret-296 "removing the worker and the deal state from kv"])
                                                       (null)
                                                      )
                                                     )
                                                     (call %init_peer_id% ("json" "stringify") ["removing the worker and the deal state from kv"] ret-297)
                                                    )
                                                    (call %init_peer_id% ("op" "concat_strings") [ret-296 ret-297] ret-298)
                                                   )
                                                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-298] ret-299)
                                                  )
                                                  (xor
                                                   (call %init_peer_id% ("worker" "remove") [ret-295.$.[0]])
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (new $array-inline-83
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (ap "couldn't remove a worker" $array-inline-83)
                                                            (ap ret-295.$.[0] $array-inline-83)
                                                           )
                                                           (ap :error: $array-inline-83)
                                                          )
                                                          (canon %init_peer_id% $array-inline-83  #array-inline-83-0)
                                                         )
                                                        )
                                                        (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" removed-0.$.deal_id ": "] ret-300)
                                                       )
                                                       (par
                                                        (call %init_peer_id% ("run-console" "print") [ret-300 #array-inline-83-0])
                                                        (null)
                                                       )
                                                      )
                                                      (call %init_peer_id% ("json" "stringify") [#array-inline-83-0] ret-301)
                                                     )
                                                     (call %init_peer_id% ("op" "concat_strings") [ret-300 ret-301] ret-302)
                                                    )
                                                    (call %init_peer_id% (-spell_id-arg- "store_log") [ret-302] ret-303)
                                                   )
                                                  )
                                                 )
                                                 (xor
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (new %JoinedDeal_obj-2_map
                                                        (seq
                                                         (seq
                                                          (ap ("deal_id" removed-0.$.deal_id) %JoinedDeal_obj-2_map)
                                                          (ap ("worker_id" ret-295.$.[0]) %JoinedDeal_obj-2_map)
                                                         )
                                                         (canon %init_peer_id% %JoinedDeal_obj-2_map  JoinedDeal_obj-2)
                                                        )
                                                       )
                                                       (call %init_peer_id% ("json" "stringify") [JoinedDeal_obj-2] ret-304)
                                                      )
                                                      (call %init_peer_id% (-spell_id-arg- "list_remove_string") ["joined_deals" ret-304] ret-305)
                                                     )
                                                     (call %init_peer_id% (-spell_id-arg- "remove_key") [removed-0.$.deal_id] ret-306)
                                                    )
                                                    (call %init_peer_id% ("op" "concat_strings") ["removed_state:" removed-0.$.deal_id] ret-307)
                                                   )
                                                   (call %init_peer_id% (-spell_id-arg- "remove_key") [ret-307] ret-308)
                                                  )
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (new $array-inline-84
                                                        (seq
                                                         (seq
                                                          (ap "couldn't remove the deal" $array-inline-84)
                                                          (ap :error: $array-inline-84)
                                                         )
                                                         (canon %init_peer_id% $array-inline-84  #array-inline-84-0)
                                                        )
                                                       )
                                                       (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" removed-0.$.deal_id ": "] ret-309)
                                                      )
                                                      (par
                                                       (call %init_peer_id% ("run-console" "print") [ret-309 #array-inline-84-0])
                                                       (null)
                                                      )
                                                     )
                                                     (call %init_peer_id% ("json" "stringify") [#array-inline-84-0] ret-310)
                                                    )
                                                    (call %init_peer_id% ("op" "concat_strings") [ret-309 ret-310] ret-311)
                                                   )
                                                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-311] ret-312)
                                                  )
                                                 )
                                                )
                                               )
                                               (seq
                                                (ap :error: -if-error-)
                                                (xor
                                                 (match :error:.$.error_code 10002
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" removed-0.$.deal_id ": "] ret-313)
                                                      (par
                                                       (call %init_peer_id% ("run-console" "print") [ret-313 "deal doesn't have associated worker O.o"])
                                                       (null)
                                                      )
                                                     )
                                                     (call %init_peer_id% ("json" "stringify") ["deal doesn't have associated worker O.o"] ret-314)
                                                    )
                                                    (call %init_peer_id% ("op" "concat_strings") [ret-313 ret-314] ret-315)
                                                   )
                                                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-315] ret-316)
                                                  )
                                                 )
                                                 (seq
                                                  (seq
                                                   (ap :error: -else-error-)
                                                   (xor
                                                    (match :error:.$.error_code 10001
                                                     (ap -if-error- -if-else-error-)
                                                    )
                                                    (ap -else-error- -if-else-error-)
                                                   )
                                                  )
                                                  (fail -if-else-error-)
                                                 )
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                         (seq
                                          (ap :error: -if-error-)
                                          (xor
                                           (match :error:.$.error_code 10001
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (call %init_peer_id% ("chain_connector" "hex_min") [removed-0.$.right_boundary -latest-flat-0.$.[0]] ret-317)
                                                (xor
                                                 (match ret-317.$.success true
                                                  (ap false not-23)
                                                 )
                                                 (ap true not-23)
                                                )
                                               )
                                               (new -if-error-
                                                (xor
                                                 (match not-23 true
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (new $array-inline-85
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (ap "hex_min failed" $array-inline-85)
                                                         (ap removed-0.$.right_boundary $array-inline-85)
                                                        )
                                                        (ap -latest-flat-0.$.[0] $array-inline-85)
                                                       )
                                                       (canon %init_peer_id% $array-inline-85  #array-inline-85-0)
                                                      )
                                                     )
                                                     (par
                                                      (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-85-0])
                                                      (null)
                                                     )
                                                    )
                                                    (call %init_peer_id% ("json" "stringify") [#array-inline-85-0] ret-318)
                                                   )
                                                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-318] ret-319)
                                                  )
                                                 )
                                                 (seq
                                                  (ap :error: -if-error-)
                                                  (xor
                                                   (match :error:.$.error_code 10001
                                                    (null)
                                                   )
                                                   (fail -if-error-)
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                              (ap ret-317.$.hex ret-317_flat)
                                             )
                                             (new -if-error-
                                              (xor
                                               (mismatch ret-317_flat []
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (call %init_peer_id% ("chain_connector" "hex_add") [ret-317_flat.$.[0] 1] ret-320)
                                                    (xor
                                                     (match ret-320.$.success true
                                                      (ap false not-24)
                                                     )
                                                     (ap true not-24)
                                                    )
                                                   )
                                                   (new -if-error-
                                                    (xor
                                                     (match not-24 true
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (new $array-inline-86
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (ap "hex_add failed" $array-inline-86)
                                                             (ap ret-317_flat.$.[0] $array-inline-86)
                                                            )
                                                            (ap 1 $array-inline-86)
                                                           )
                                                           (canon %init_peer_id% $array-inline-86  #array-inline-86-0)
                                                          )
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-86-0])
                                                          (null)
                                                         )
                                                        )
                                                        (call %init_peer_id% ("json" "stringify") [#array-inline-86-0] ret-321)
                                                       )
                                                       (call %init_peer_id% (-spell_id-arg- "store_log") [ret-321] ret-322)
                                                      )
                                                     )
                                                     (seq
                                                      (ap :error: -if-error-)
                                                      (xor
                                                       (match :error:.$.error_code 10001
                                                        (null)
                                                       )
                                                       (fail -if-error-)
                                                      )
                                                     )
                                                    )
                                                   )
                                                  )
                                                  (ap ret-320.$.hex ret-320_flat)
                                                 )
                                                 (new -if-error-
                                                  (xor
                                                   (mismatch ret-320_flat []
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (new %DealState_obj-2_map
                                                        (seq
                                                         (ap ("left_boundary" ret-320_flat.$.[0]) %DealState_obj-2_map)
                                                         (canon %init_peer_id% %DealState_obj-2_map  DealState_obj-2)
                                                        )
                                                       )
                                                       (call %init_peer_id% ("json" "stringify") [DealState_obj-2] ret-323)
                                                      )
                                                      (call %init_peer_id% ("op" "concat_strings") ["removed_state:" removed-0.$.deal_id] ret-324)
                                                     )
                                                     (call %init_peer_id% (-spell_id-arg- "set_string") [ret-324 ret-323] ret-325)
                                                    )
                                                   )
                                                   (seq
                                                    (ap :error: -if-error-)
                                                    (xor
                                                     (match :error:.$.error_code 10002
                                                      (null)
                                                     )
                                                     (fail -if-error-)
                                                    )
                                                   )
                                                  )
                                                 )
                                                )
                                               )
                                               (seq
                                                (ap :error: -if-error-)
                                                (xor
                                                 (match :error:.$.error_code 10002
                                                  (null)
                                                 )
                                                 (fail -if-error-)
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                           (seq
                                            (seq
                                             (ap :error: -else-error-)
                                             (xor
                                              (match :error:.$.error_code 10001
                                               (ap -if-error- -if-else-error-)
                                              )
                                              (ap -else-error- -if-else-error-)
                                             )
                                            )
                                            (fail -if-else-error-)
                                           )
                                          )
                                         )
                                        )
                                       )
                                      )
                                     )
                                    )
                                    (seq
                                     (seq
                                      (ap :error: -else-error-)
                                      (xor
                                       (match :error:.$.error_code 10001
                                        (ap -if-error- -if-else-error-)
                                       )
                                       (ap -else-error- -if-else-error-)
                                      )
                                     )
                                     (fail -if-else-error-)
                                    )
                                   )
                                  )
                                 )
                                )
                               )
                              )
                             )
                             (next removed-0)
                            )
                           )
                          )
                          (seq
                           (seq
                            (ap :error: -else-error-)
                            (xor
                             (match :error:.$.error_code 10001
                              (ap -if-error- -if-else-error-)
                             )
                             (ap -else-error- -if-else-error-)
                            )
                           )
                           (fail -if-else-error-)
                          )
                         )
                        )
                       )
                      )
                     )
                    )
                   )
                  )
                  (seq
                   (ap :error: -if-error-)
                   (xor
                    (match :error:.$.error_code 10002
                     (null)
                    )
                    (fail -if-error-)
                   )
                  )
                 )
                )
               )
              )
             )
             (seq
              (ap :error: -if-error-)
              (xor
               (match :error:.$.error_code 10002
                (null)
               )
               (fail -if-error-)
              )
             )
            )
           )
          )
          (null)
         )
        )
        (xor
         (seq
          (seq
           (seq
            (new $known_txs
             (new $unknown_txs
              (seq
               (seq
                (seq
                 (seq
                  (seq
                   (seq
                    (seq
                     (call %init_peer_id% (-spell_id-arg- "list_get_strings") ["worker_registration_txs"] ret-326)
                     (call %init_peer_id% (-spell_id-arg- "list_get_strings") ["worker_registration_txs_statuses"] ret-327)
                    )
                    (fold ret-327.$.value status_str-0
                     (seq
                      (xor
                       (seq
                        (seq
                         (call %init_peer_id% ("json" "parse") [status_str-0] ret-328)
                         (call %init_peer_id% ("json" "stringify") [ret-328.$.tx_info] ret-329)
                        )
                        (ap ret-329 $known_txs)
                       )
                       (seq
                        (seq
                         (seq
                          (new $array-inline-87
                           (seq
                            (seq
                             (seq
                              (seq
                               (ap "can't parse worker tx status:" $array-inline-87)
                               (ap status_str-0 $array-inline-87)
                              )
                              (ap "error:" $array-inline-87)
                             )
                             (ap :error: $array-inline-87)
                            )
                            (canon %init_peer_id% $array-inline-87  #array-inline-87-0)
                           )
                          )
                          (par
                           (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-87-0])
                           (null)
                          )
                         )
                         (call %init_peer_id% ("json" "stringify") [#array-inline-87-0] ret-330)
                        )
                        (call %init_peer_id% (-spell_id-arg- "store_log") [ret-330] ret-331)
                       )
                      )
                      (next status_str-0)
                     )
                    )
                   )
                   (canon %init_peer_id% $known_txs  #known_txs_canon)
                  )
                  (call %init_peer_id% ("array" "diff") [ret-326.$.value #known_txs_canon] ret-332)
                 )
                 (fold ret-332 tx-0
                  (seq
                   (xor
                    (seq
                     (call %init_peer_id% ("json" "parse") [tx-0] ret-333)
                     (ap ret-333 $unknown_txs)
                    )
                    (seq
                     (seq
                      (seq
                       (new $array-inline-88
                        (seq
                         (seq
                          (seq
                           (seq
                            (ap "can't parse worker tx info:" $array-inline-88)
                            (ap tx-0 $array-inline-88)
                           )
                           (ap "error:" $array-inline-88)
                          )
                          (ap :error: $array-inline-88)
                         )
                         (canon %init_peer_id% $array-inline-88  #array-inline-88-0)
                        )
                       )
                       (par
                        (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-88-0])
                        (null)
                       )
                      )
                      (call %init_peer_id% ("json" "stringify") [#array-inline-88-0] ret-334)
                     )
                     (call %init_peer_id% (-spell_id-arg- "store_log") [ret-334] ret-335)
                    )
                   )
                   (next tx-0)
                  )
                 )
                )
                (canon %init_peer_id% $unknown_txs  #-unknown_txs-fix-0)
               )
               (ap #-unknown_txs-fix-0 -unknown_txs-flat-0)
              )
             )
            )
            (ap -unknown_txs-flat-0 -unknown_txs-flat-0_to_functor)
           )
           (ap -unknown_txs-flat-0_to_functor.length -unknown_txs-flat-0_length)
          )
          (new -if-error-
           (xor
            (mismatch -unknown_txs-flat-0_length 0
             (seq
              (seq
               (seq
                (seq
                 (seq
                  (seq
                   (new $array-inline-89
                    (seq
                     (seq
                      (seq
                       (seq
                        (seq
                         (ap -unknown_txs-flat-0 -unknown_txs-flat-0_to_functor-0)
                         (ap -unknown_txs-flat-0_to_functor-0.length -unknown_txs-flat-0_length-0)
                        )
                        (ap "tracking txs for" $array-inline-89)
                       )
                       (ap -unknown_txs-flat-0_length-0 $array-inline-89)
                      )
                      (ap "deals" $array-inline-89)
                     )
                     (canon %init_peer_id% $array-inline-89  #array-inline-89-0)
                    )
                   )
                   (par
                    (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-89-0])
                    (null)
                   )
                  )
                  (call %init_peer_id% ("json" "stringify") [#array-inline-89-0] ret-336)
                 )
                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-336] ret-337)
                )
                (call %init_peer_id% ("chain_connector" "get_tx_statuses") [-chain-arg-.$.api_endpoint -unknown_txs-flat-0] ret-338)
               )
               (xor
                (match ret-338.$.success true
                 (ap false not-25)
                )
                (ap true not-25)
               )
              )
              (new -if-else-error-
               (new -else-error-
                (new -if-error-
                 (xor
                  (match not-25 true
                   (seq
                    (seq
                     (seq
                      (new $array-inline-90
                       (seq
                        (seq
                         (ap "couldn't make batch jsonrpc request:" $array-inline-90)
                         (ap ret-338.$.error $array-inline-90)
                        )
                        (canon %init_peer_id% $array-inline-90  #array-inline-90-0)
                       )
                      )
                      (par
                       (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-90-0])
                       (null)
                      )
                     )
                     (call %init_peer_id% ("json" "stringify") [#array-inline-90-0] ret-339)
                    )
                    (call %init_peer_id% (-spell_id-arg- "store_log") [ret-339] ret-340)
                   )
                  )
                  (seq
                   (ap :error: -if-error-)
                   (xor
                    (match :error:.$.error_code 10001
                     (fold ret-338.$.results status-1
                      (seq
                       (seq
                        (xor
                         (match status-1.$.success true
                          (ap false not-26)
                         )
                         (ap true not-26)
                        )
                        (new -if-else-error-
                         (new -else-error-
                          (new -if-error-
                           (xor
                            (match not-26 true
                             (seq
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (new $array-inline-91
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (ap "couldn't find tx status:" $array-inline-91)
                                        (ap "tx_hash:" $array-inline-91)
                                       )
                                       (ap status-1.$.tx.tx_hash $array-inline-91)
                                      )
                                      (ap "error:" $array-inline-91)
                                     )
                                     (ap status-1.$.error $array-inline-91)
                                    )
                                    (canon %init_peer_id% $array-inline-91  #array-inline-91-0)
                                   )
                                  )
                                  (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" status-1.$.tx.deal_id ": "] ret-341)
                                 )
                                 (par
                                  (call %init_peer_id% ("run-console" "print") [ret-341 #array-inline-91-0])
                                  (null)
                                 )
                                )
                                (call %init_peer_id% ("json" "stringify") [#array-inline-91-0] ret-342)
                               )
                               (call %init_peer_id% ("op" "concat_strings") [ret-341 ret-342] ret-343)
                              )
                              (call %init_peer_id% (-spell_id-arg- "store_log") [ret-343] ret-344)
                             )
                            )
                            (seq
                             (ap :error: -if-error-)
                             (xor
                              (match :error:.$.error_code 10001
                               (new -if-error-
                                (xor
                                 (mismatch status-1.$.status "pending"
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (new %WorkerTxStatus_obj_map
                                        (seq
                                         (seq
                                          (ap ("status" status-1.$.status) %WorkerTxStatus_obj_map)
                                          (ap ("tx_info" status-1.$.tx) %WorkerTxStatus_obj_map)
                                         )
                                         (canon %init_peer_id% %WorkerTxStatus_obj_map  WorkerTxStatus_obj)
                                        )
                                       )
                                       (call %init_peer_id% ("json" "stringify") [WorkerTxStatus_obj] ret-345)
                                      )
                                      (call %init_peer_id% (-spell_id-arg- "list_push_string") ["worker_registration_txs_statuses" ret-345] ret-346)
                                     )
                                     (xor
                                      (match ret-346.$.success true
                                       (ap false not-27)
                                      )
                                      (ap true not-27)
                                     )
                                    )
                                    (new -if-error-
                                     (xor
                                      (match not-27 true
                                       (seq
                                        (seq
                                         (seq
                                          (new $array-inline-92
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (ap "can't store value in list by key" $array-inline-92)
                                               (ap "worker_registration_txs_statuses" $array-inline-92)
                                              )
                                              (ap "error:" $array-inline-92)
                                             )
                                             (ap ret-346.$.error $array-inline-92)
                                            )
                                            (canon %init_peer_id% $array-inline-92  #array-inline-92-0)
                                           )
                                          )
                                          (par
                                           (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-92-0])
                                           (null)
                                          )
                                         )
                                         (call %init_peer_id% ("json" "stringify") [#array-inline-92-0] ret-347)
                                        )
                                        (call %init_peer_id% (-spell_id-arg- "store_log") [ret-347] ret-348)
                                       )
                                      )
                                      (seq
                                       (ap :error: -if-error-)
                                       (xor
                                        (match :error:.$.error_code 10001
                                         (null)
                                        )
                                        (fail -if-error-)
                                       )
                                      )
                                     )
                                    )
                                   )
                                   (new -if-error-
                                    (xor
                                     (match status-1.$.status "failed"
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (new $option-inline
                                                    (seq
                                                     (xor
                                                      (ap status-1.$.tx.tx_hash $option-inline)
                                                      (null)
                                                     )
                                                     (canon %init_peer_id% $option-inline  #option-inline-0)
                                                    )
                                                   )
                                                   (new %TxFailed_obj-0_map
                                                    (seq
                                                     (seq
                                                      (ap ("block_number" status-1.$.block_number) %TxFailed_obj-0_map)
                                                      (ap ("tx_hash" #option-inline-0) %TxFailed_obj-0_map)
                                                     )
                                                     (canon %init_peer_id% %TxFailed_obj-0_map  TxFailed_obj-0)
                                                    )
                                                   )
                                                  )
                                                  (new %FailedDealError_obj-1_map
                                                   (seq
                                                    (seq
                                                     (ap ("content" TxFailed_obj-0) %FailedDealError_obj-1_map)
                                                     (ap ("type" "TxFailed") %FailedDealError_obj-1_map)
                                                    )
                                                    (canon %init_peer_id% %FailedDealError_obj-1_map  FailedDealError_obj-1)
                                                   )
                                                  )
                                                 )
                                                 (new %FailedDeal_obj-1_map
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (ap ("deal_id" status-1.$.tx.deal_id) %FailedDeal_obj-1_map)
                                                     (ap ("message" "transaction failed") %FailedDeal_obj-1_map)
                                                    )
                                                    (ap ("payload" FailedDealError_obj-1) %FailedDeal_obj-1_map)
                                                   )
                                                   (canon %init_peer_id% %FailedDeal_obj-1_map  FailedDeal_obj-1)
                                                  )
                                                 )
                                                )
                                                (call %init_peer_id% ("json" "stringify") [FailedDeal_obj-1] ret-349)
                                               )
                                               (call %init_peer_id% (-spell_id-arg- "list_push_string") ["failed_deals" ret-349] ret-350)
                                              )
                                              (xor
                                               (match ret-350.$.success true
                                                (ap false not-28)
                                               )
                                               (ap true not-28)
                                              )
                                             )
                                             (new -if-error-
                                              (xor
                                               (match not-28 true
                                                (seq
                                                 (seq
                                                  (seq
                                                   (new $array-inline-93
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (ap "can't store value in list by key" $array-inline-93)
                                                        (ap "failed_deals" $array-inline-93)
                                                       )
                                                       (ap "error:" $array-inline-93)
                                                      )
                                                      (ap ret-350.$.error $array-inline-93)
                                                     )
                                                     (canon %init_peer_id% $array-inline-93  #array-inline-93-0)
                                                    )
                                                   )
                                                   (par
                                                    (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-93-0])
                                                    (null)
                                                   )
                                                  )
                                                  (call %init_peer_id% ("json" "stringify") [#array-inline-93-0] ret-351)
                                                 )
                                                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-351] ret-352)
                                                )
                                               )
                                               (seq
                                                (ap :error: -if-error-)
                                                (xor
                                                 (match :error:.$.error_code 10001
                                                  (null)
                                                 )
                                                 (fail -if-error-)
                                                )
                                               )
                                              )
                                             )
                                            )
                                            (new $array-inline-94
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (ap "transaction failed, tx_hash:" $array-inline-94)
                                                 (ap status-1.$.tx.tx_hash $array-inline-94)
                                                )
                                                (ap "block_number:" $array-inline-94)
                                               )
                                               (ap status-1.$.block_number $array-inline-94)
                                              )
                                              (canon %init_peer_id% $array-inline-94  #array-inline-94-0)
                                             )
                                            )
                                           )
                                           (call %init_peer_id% ("op" "concat_strings") ["decider deal_id=" status-1.$.tx.deal_id ": "] ret-353)
                                          )
                                          (par
                                           (call %init_peer_id% ("run-console" "print") [ret-353 #array-inline-94-0])
                                           (null)
                                          )
                                         )
                                         (call %init_peer_id% ("json" "stringify") [#array-inline-94-0] ret-354)
                                        )
                                        (call %init_peer_id% ("op" "concat_strings") [ret-353 ret-354] ret-355)
                                       )
                                       (call %init_peer_id% (-spell_id-arg- "store_log") [ret-355] ret-356)
                                      )
                                     )
                                     (seq
                                      (ap :error: -if-error-)
                                      (xor
                                       (match :error:.$.error_code 10001
                                        (null)
                                       )
                                       (fail -if-error-)
                                      )
                                     )
                                    )
                                   )
                                  )
                                 )
                                 (seq
                                  (ap :error: -if-error-)
                                  (xor
                                   (match :error:.$.error_code 10002
                                    (null)
                                   )
                                   (fail -if-error-)
                                  )
                                 )
                                )
                               )
                              )
                              (seq
                               (seq
                                (ap :error: -else-error-)
                                (xor
                                 (match :error:.$.error_code 10001
                                  (ap -if-error- -if-else-error-)
                                 )
                                 (ap -else-error- -if-else-error-)
                                )
                               )
                               (fail -if-else-error-)
                              )
                             )
                            )
                           )
                          )
                         )
                        )
                       )
                       (next status-1)
                      )
                     )
                    )
                    (seq
                     (seq
                      (ap :error: -else-error-)
                      (xor
                       (match :error:.$.error_code 10001
                        (ap -if-error- -if-else-error-)
                       )
                       (ap -else-error- -if-else-error-)
                      )
                     )
                     (fail -if-else-error-)
                    )
                   )
                  )
                 )
                )
               )
              )
             )
            )
            (seq
             (ap :error: -if-error-)
             (xor
              (match :error:.$.error_code 10002
               (null)
              )
              (fail -if-error-)
             )
            )
           )
          )
         )
         (null)
        )
       )
       (xor
        (seq
         (new $result-16
          (seq
           (seq
            (seq
             (seq
              (call %init_peer_id% (-spell_id-arg- "get_string") ["last_seen_block"] ret-357)
              (xor
               (match ret-357.$.success true
                (ap false not-29)
               )
               (ap true not-29)
              )
             )
             (new -if-else-error-
              (new -else-error-
               (new -if-error-
                (xor
                 (match not-29 true
                  (seq
                   (seq
                    (seq
                     (new $array-inline-95
                      (seq
                       (seq
                        (seq
                         (ap "get_string failed" $array-inline-95)
                         (ap "last_seen_block" $array-inline-95)
                        )
                        (ap ret-357.$.error $array-inline-95)
                       )
                       (canon %init_peer_id% $array-inline-95  #array-inline-95-0)
                      )
                     )
                     (par
                      (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-95-0])
                      (null)
                     )
                    )
                    (call %init_peer_id% ("json" "stringify") [#array-inline-95-0] ret-358)
                   )
                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-358] ret-359)
                  )
                 )
                 (seq
                  (ap :error: -if-error-)
                  (xor
                   (match :error:.$.error_code 10001
                    (seq
                     (xor
                      (match ret-357.$.absent true
                       (ap false not-30)
                      )
                      (ap true not-30)
                     )
                     (new -if-error-
                      (xor
                       (match not-30 true
                        (ap ret-357.$.value $result-16)
                       )
                       (seq
                        (ap :error: -if-error-)
                        (xor
                         (match :error:.$.error_code 10001
                          (null)
                         )
                         (fail -if-error-)
                        )
                       )
                      )
                     )
                    )
                   )
                   (seq
                    (seq
                     (ap :error: -else-error-)
                     (xor
                      (match :error:.$.error_code 10001
                       (ap -if-error- -if-else-error-)
                      )
                      (ap -else-error- -if-else-error-)
                     )
                    )
                    (fail -if-else-error-)
                   )
                  )
                 )
                )
               )
              )
             )
            )
            (canon %init_peer_id% $result-16  #-result-fix-0-4)
           )
           (ap #-result-fix-0-4 -result-flat-0-4)
          )
         )
         (new -if-error-
          (xor
           (mismatch -result-flat-0-4 []
            (seq
             (seq
              (seq
               (seq
                (seq
                 (seq
                  (call %init_peer_id% ("chain_connector" "hex_diff") [-result-flat-0-4.$.[0] -latest-flat-0.$.[0]] ret-360)
                  (new $result-17
                   (seq
                    (seq
                     (call %init_peer_id% (-spell_id-arg- "get_u32") ["counter"] ret-361)
                     (new -if-else-error-
                      (new -else-error-
                       (new -if-error-
                        (xor
                         (match ret-361.$.success true
                          (ap ret-361.$.value $result-17)
                         )
                         (seq
                          (ap :error: -if-error-)
                          (xor
                           (match :error:.$.error_code 10001
                            (ap 0 $result-17)
                           )
                           (seq
                            (seq
                             (ap :error: -else-error-)
                             (xor
                              (match :error:.$.error_code 10001
                               (ap -if-error- -if-else-error-)
                              )
                              (ap -else-error- -if-else-error-)
                             )
                            )
                            (fail -if-else-error-)
                           )
                          )
                         )
                        )
                       )
                      )
                     )
                    )
                    (new $result-17_test
                     (seq
                      (seq
                       (fold $result-17 result-17_fold_var
                        (seq
                         (seq
                          (ap result-17_fold_var $result-17_test)
                          (canon %init_peer_id% $result-17_test  #result-17_iter_canon)
                         )
                         (xor
                          (match #result-17_iter_canon.length 1
                           (null)
                          )
                          (next result-17_fold_var)
                         )
                        )
                        (never)
                       )
                       (canon %init_peer_id% $result-17_test  #result-17_result_canon)
                      )
                      (ap #result-17_result_canon result-17_gate)
                     )
                    )
                   )
                  )
                 )
                 (new %SyncInfo_obj_map
                  (seq
                   (seq
                    (ap ("blocks_diff" ret-360) %SyncInfo_obj_map)
                    (ap ("run_updated" result-17_gate.$.[0]) %SyncInfo_obj_map)
                   )
                   (canon %init_peer_id% %SyncInfo_obj_map  SyncInfo_obj)
                  )
                 )
                )
                (call %init_peer_id% ("json" "stringify") [SyncInfo_obj] ret-362)
               )
               (call %init_peer_id% (-spell_id-arg- "set_string") ["sync_info" ret-362] ret-363)
              )
              (xor
               (match ret-363.$.success true
                (ap false not-31)
               )
               (ap true not-31)
              )
             )
             (new -if-error-
              (xor
               (match not-31 true
                (seq
                 (seq
                  (seq
                   (new $array-inline-96
                    (seq
                     (seq
                      (seq
                       (seq
                        (ap "can't updated sync state" $array-inline-96)
                        (ap SyncInfo_obj $array-inline-96)
                       )
                       (ap "error" $array-inline-96)
                      )
                      (ap ret-363.$.error $array-inline-96)
                     )
                     (canon %init_peer_id% $array-inline-96  #array-inline-96-0)
                    )
                   )
                   (par
                    (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-96-0])
                    (null)
                   )
                  )
                  (call %init_peer_id% ("json" "stringify") [#array-inline-96-0] ret-364)
                 )
                 (call %init_peer_id% (-spell_id-arg- "store_log") [ret-364] ret-365)
                )
               )
               (seq
                (ap :error: -if-error-)
                (xor
                 (match :error:.$.error_code 10001
                  (null)
                 )
                 (fail -if-error-)
                )
               )
              )
             )
            )
           )
           (seq
            (ap :error: -if-error-)
            (xor
             (match :error:.$.error_code 10002
              (null)
             )
             (fail -if-error-)
            )
           )
          )
         )
        )
        (null)
       )
      )
      (xor
       (seq
        (seq
         (seq
          (seq
           (seq
            (call %init_peer_id% (-spell_id-arg- "get_mailbox") [] ret-366)
            (new $array-inline-97
             (seq
              (seq
               (ap "mailbox" $array-inline-97)
               (ap ret-366 $array-inline-97)
              )
              (canon %init_peer_id% $array-inline-97  #array-inline-97-0)
             )
            )
           )
           (par
            (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-97-0])
            (null)
           )
          )
          (call %init_peer_id% ("json" "stringify") [#array-inline-97-0] ret-367)
         )
         (call %init_peer_id% (-spell_id-arg- "store_log") [ret-367] ret-368)
        )
        (new -if-error-
         (xor
          (match ret-366.$.success true
           (fold ret-366.$.messages msg-206-0
            (seq
             (xor
              (seq
               (seq
                (seq
                 (seq
                  (seq
                   (seq
                    (seq
                     (seq
                      (seq
                       (seq
                        (seq
                         (call %init_peer_id% ("json" "parse") [msg-206-0.$.message] ret-369)
                         (new -if-error-
                          (xor
                           (mismatch ret-369.$.remove []
                            (seq
                             (seq
                              (seq
                               (seq
                                (ap ret-369.$.remove ret-369_flat)
                                (new $array-inline-98
                                 (seq
                                  (seq
                                   (seq
                                    (ap "called remove worker via mailbox" $array-inline-98)
                                    (ap ret-369_flat.$.[0].host_id $array-inline-98)
                                   )
                                   (ap ret-369_flat.$.[0].worker_id $array-inline-98)
                                  )
                                  (canon %init_peer_id% $array-inline-98  #array-inline-98-0)
                                 )
                                )
                               )
                               (par
                                (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-98-0])
                                (null)
                               )
                              )
                              (call %init_peer_id% ("json" "stringify") [#array-inline-98-0] ret-370)
                             )
                             (call %init_peer_id% ("decider" "store_log") [ret-370] ret-371)
                            )
                           )
                           (seq
                            (ap :error: -if-error-)
                            (xor
                             (match :error:.$.error_code 10002
                              (null)
                             )
                             (fail -if-error-)
                            )
                           )
                          )
                         )
                        )
                        (par
                         (call %init_peer_id% ("run-console" "print") ["decider" "will pop"])
                         (null)
                        )
                       )
                       (call %init_peer_id% ("json" "stringify") ["will pop"] ret-372)
                      )
                      (call %init_peer_id% (-spell_id-arg- "store_log") [ret-372] ret-373)
                     )
                     (call %init_peer_id% (-spell_id-arg- "pop_mailbox") [] ret-374)
                    )
                    (ap ret-374.$.message ret-374_flat)
                   )
                   (ap ret-374_flat ret-374_flat_to_functor)
                  )
                  (ap ret-374_flat_to_functor.length ret-374_flat_length)
                 )
                 (xor
                  (match ret-374_flat_length 0
                   (ap true eq)
                  )
                  (ap false eq)
                 )
                )
                (xor
                 (match eq true
                  (ap eq or)
                 )
                 (seq
                  (xor
                   (mismatch ret-374.$.message.[0].message msg-206-0.$.message
                    (ap true neq)
                   )
                   (ap false neq)
                  )
                  (ap neq or)
                 )
                )
               )
               (new -if-error-
                (xor
                 (match or true
                  (seq
                   (seq
                    (seq
                     (new $array-inline-99
                      (seq
                       (seq
                        (seq
                         (seq
                          (ap "broken invariant, expected" $array-inline-99)
                          (ap msg-206-0 $array-inline-99)
                         )
                         (ap "popped" $array-inline-99)
                        )
                        (ap ret-374 $array-inline-99)
                       )
                       (canon %init_peer_id% $array-inline-99  #array-inline-99-0)
                      )
                     )
                     (par
                      (call %init_peer_id% ("run-console" "print") ["decider" #array-inline-99-0])
                      (null)
                     )
                    )
                    (call %init_peer_id% ("json" "stringify") [#array-inline-99-0] ret-375)
                   )
                   (call %init_peer_id% (-spell_id-arg- "store_log") [ret-375] ret-376)
                  )
                 )
                 (seq
                  (ap :error: -if-error-)
                  (xor
                   (match :error:.$.error_code 10001
                    (null)
                   )
                   (fail -if-error-)
                  )
                 )
                )
               )
              )
              (null)
             )
             (next msg-206-0)
            )
           )
          )
          (seq
           (ap :error: -if-error-)
           (xor
            (match :error:.$.error_code 10001
             (null)
            )
            (fail -if-error-)
           )
          )
         )
        )
       )
       (null)
      )
     )
    )
    (seq
     (ap :error: -if-error-)
     (xor
      (match :error:.$.error_code 10002
       (null)
      )
      (fail -if-error-)
     )
    )
   )
